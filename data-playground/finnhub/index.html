<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Rotational Labs | Finnhub</title><base href=https://rotational.io/ target=_self><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="FinnHub provides real-time stock market data. Note that the stock market is closed during certain times of days and days of the week."><meta name=keywords content="Rotational Labs,Ensign,Cloud-native,Real-time data streaming platform,Data collaboration,Data automation,Rapid prototyping,Real-time machine learning,Real-time data analytics,Real-time applications,Data streams,Event streams,Event-sourcing databaseEvent log"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="Finnhub"><meta property="og:description" content="FinnHub provides real-time stock market data. Note that the stock market is closed during certain times of days and days of the week."><meta property="og:image" content="https://rotational.io/img/data-playground/finnhub.png"><meta property="og:url" content="https://rotational.io/data-playground/finnhub/"><meta property="og:type" content="website"><meta name=twitter:title content="Finnhub"><meta name=twitter:card content="summary"><meta name=twitter:description content="FinnHub provides real-time stock market data. Note that the stock market is closed during certain times of days and days of the week."><meta name=twitter:image content="https://rotational.io/img/data-playground/finnhub.png"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css><link rel=stylesheet href=https://unpkg.com/@highlightjs/cdn-assets/styles/default.min.css><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script async src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script>
<script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script><script src=https://kit.fontawesome.com/2c36e9b7b1.js crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr/lunr.js></script></head><body class="bg-hexagon bg-center bg-contain"><div class="relative bg-[#1D65A6]"><nav class="relative max-w-7xl mx-auto flex items-center justify-between text-white px-4 sm:px-6 z-[9999] py-5" aria-label=Global><a href=/><img src=img/logo.png alt="Rotational Lab logo" class="h-14 w-auto sm:h-14"></a><div class=topnav id=myTopnav><a href=/ensign/>Ensign</a>
<a href=/data-playground>Data Playground</a>
<a href=/opensource/>Open Source</a>
<a href=/blog/>Blog</a>
<a href=/about/>About</a>
<a href=https://rotational.app>Login</a>
<a class=icon onclick=openMobNav()><i class="fa fa-bars"></i></a></div></nav></div><main><div class="max-w-7xl mx-auto px-4 relative"><div class="w-full bg-[#ECF6FF] flex justify-between my-10 place-items-center h-36 px-10"><div class="flex flex-col font-bold"><h2 class=text-2xl>Finnhub</h2><h3 class=text-lg>Stock Market Data</h3></div><div><a href=https://github.com/rotationalio/data-playground/tree/main/finnhub target=_blank class="bg-black font-bold px-3 sm:px-6 py-4 rounded-md text-sm text-white md:text-base flex items-center gap-4 hover:bg-neutral-900"><span class="text-sm sm:text-base">Get Started</span>
<span class="hidden sm:flex"><img src=img/data-playground/github.png alt="github icon" height=36 width=36></span></a></div></div><div class="w-full flex flex-col gap-4 sm:gap-8 sm:flex-row justify-between px-10"><div class=w-1/2><div class="flex flex-col my-4"><p class="text-xl font-bold mb-5">About This Data Source</p><p class=text-base>FinnHub provides real-time stock market data. Note that the stock market is closed during certain times of days and days of the week.</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Producer</p><p class=text-base><a class="cursor-pointer underline" href=https://finnhub.io/>FinnHub</p></a></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Data</p><p class=text-base>Stock prices, company profiles, company & market news</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Account Required</p><p class=text-base>Yes</p></div><div class="flex flex-col my-4"><div class="flex flex-row gap-2"><p class="text-lg font-bold">License</p><p data-attr=tooltip id=tooltip class=h-6><img src=img/data-playground/tooltip.svg alt=tooltip width=24 height=24></p><div id=tooltip-text class="hidden bg-neutral-200 text-black text-sm rounded-lg p-2 absolute ml-20"><p class="text-xs font-semibold">Warning</p><p>Please review terms and conditions. Access to data sources can change.</p></div></div><p class=text-base>Free, Commercial</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">API Key</p><p class=text-base>Yes</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">API Type</p><p class=text-base>REST, WebSocket</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">SDKS</p><p class=text-base>Python, Go</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Limits</p><p class=text-base>60 API calls/minute for the free tier. Other pricing plans available.</p></div></div><div class=flex-1 id=code-snippets><div class=tab-container><div class="tab-nav flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200"><button onclick='switchTab("default","Python")' data-tab-item=Python data-tab-group=default class='tab-button active inline-block p-4 bg-gray-100 [&.active]:bg-[#192E5B] [&.active]:text-white rounded-t-lg'>Python</button><button onclick='switchTab("default","Go")' data-tab-item=Go data-tab-group=default class='tab-button inline-block p-4 bg-gray-100 [&.active]:bg-[#192E5B] [&.active]:text-white rounded-t-lg'>Go</button></div><div class="tab-content -mt-0"><div data-tab-item=Python data-tab-group=default class='tab-item active'><button id=copy-code-button class="copy-code-button absolute text-white text-xs right-[3.5rem] bg-red-500 p-1 hover:text-red-700 [&.active]:bg-green-600 mt-[0.75rem] mr-[0.75rem]">
Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> asyncio
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> websockets
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyensign.events <span style=color:#f92672>import</span> Event
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyensign.ensign <span style=color:#f92672>import</span> Ensign
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>handle_ack</span>(ack):
</span></span><span style=display:flex><span>    ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>fromtimestamp(ack<span style=color:#f92672>.</span>committed<span style=color:#f92672>.</span>seconds <span style=color:#f92672>+</span> ack<span style=color:#f92672>.</span>committed<span style=color:#f92672>.</span>nanos <span style=color:#f92672>/</span> <span style=color:#ae81ff>1e9</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Event committed at </span><span style=color:#e6db74>{</span>ts<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>handle_nack</span>(nack):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Could not commit event </span><span style=color:#e6db74>{</span>nack<span style=color:#f92672>.</span>id<span style=color:#e6db74>}</span><span style=color:#e6db74> with error </span><span style=color:#e6db74>{</span>nack<span style=color:#f92672>.</span>code<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>nack<span style=color:#f92672>.</span>error<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TradesPublisher</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    TradesPublisher queries an API for trading updates and publishes events to Ensign.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, symbols<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;AAPL&#34;</span>, <span style=color:#e6db74>&#34;MSFT&#34;</span>, <span style=color:#e6db74>&#34;AMZN&#34;</span>], topic<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;trades&#34;</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>symbols <span style=color:#f92672>=</span> symbols
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>topic <span style=color:#f92672>=</span> topic
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>ensign <span style=color:#f92672>=</span> Ensign()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Run the publisher forever.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Load finnhub API key from environment variable.</span>
</span></span><span style=display:flex><span>        token <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;FINNHUB_API_KEY&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> token <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;FINNHUB_API_KEY environment variable not set.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Run the publisher.</span>
</span></span><span style=display:flex><span>        asyncio<span style=color:#f92672>.</span>get_event_loop()<span style=color:#f92672>.</span>run_until_complete(self<span style=color:#f92672>.</span>recv_and_publish(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;wss://ws.finnhub.io?token=</span><span style=color:#e6db74>{</span>token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>recv_and_publish</span>(self, uri):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Receive messages from the websocket and publish events to Ensign.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Ensure that the Ensign topic exists before publishing.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>await</span> self<span style=color:#f92672>.</span>ensign<span style=color:#f92672>.</span>topic_exists(self<span style=color:#f92672>.</span>topic):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> self<span style=color:#f92672>.</span>ensign<span style=color:#f92672>.</span>create_topic(self<span style=color:#f92672>.</span>topic)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>with</span> websockets<span style=color:#f92672>.</span>connect(uri) <span style=color:#66d9ef>as</span> websocket:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> symbol <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>symbols:
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>await</span> websocket<span style=color:#f92672>.</span>send(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>{{</span><span style=color:#e6db74>&#34;type&#34;:&#34;subscribe&#34;,&#34;symbol&#34;:&#34;</span><span style=color:#e6db74>{</span>symbol<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>}}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>                        message <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> websocket<span style=color:#f92672>.</span>recv()
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>for</span> event <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>message_to_events(json<span style=color:#f92672>.</span>loads(message)):
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>await</span> self<span style=color:#f92672>.</span>ensign<span style=color:#f92672>.</span>publish(self<span style=color:#f92672>.</span>topic, event, ack_callback<span style=color:#f92672>=</span>handle_ack, nack_callback<span style=color:#f92672>=</span>handle_nack)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> websockets<span style=color:#f92672>.</span>exceptions<span style=color:#f92672>.</span>ConnectionClosedError <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>                <span style=color:#75715e># TODO: Make sure reconnect is happening for dropped connections.</span>
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Websocket connection closed: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>await</span> asyncio<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>message_to_events</span>(self, message):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Convert a message from the Finnhub API to multiple Ensign events.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        message_type <span style=color:#f92672>=</span> message[<span style=color:#e6db74>&#34;type&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> message_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ping&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> message_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;trade&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> trade <span style=color:#f92672>in</span> message[<span style=color:#e6db74>&#34;data&#34;</span>]:
</span></span><span style=display:flex><span>                data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;price&#34;</span>: trade[<span style=color:#e6db74>&#34;p&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;symbol&#34;</span>: trade[<span style=color:#e6db74>&#34;s&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;timestamp&#34;</span>: trade[<span style=color:#e6db74>&#34;t&#34;</span>],
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;volume&#34;</span>: trade[<span style=color:#e6db74>&#34;v&#34;</span>]
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>yield</span> Event(json<span style=color:#f92672>.</span>dumps(data)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;utf-8&#34;</span>), mimetype<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;application/json&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Unknown message type: </span><span style=color:#e6db74>{</span>message_type<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div></div><div data-tab-item=Go data-tab-group=default class=tab-item><button id=copy-code-button class="copy-code-button absolute text-white text-xs right-[3.5rem] bg-red-500 p-1 hover:text-red-700 [&.active]:bg-green-600 mt-[0.75rem] mr-[0.75rem]">
Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/gorilla/websocket&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ensign</span> <span style=color:#e6db74>&#34;github.com/rotationalio/go-ensign&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>api</span> <span style=color:#e6db74>&#34;github.com/rotationalio/go-ensign/api/v1beta1&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mimetype</span> <span style=color:#e6db74>&#34;github.com/rotationalio/go-ensign/mimetype/v1beta1&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// This is the nickname of the topic, it will get mapped to an ID that actually gets used by Ensign
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Trades</span> = <span style=color:#e6db74>&#34;trades&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// This represents the structure of an individual stock data point that comes back from the Finnhub API
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Data</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Symbol</span>     <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`json:&#34;s&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Price</span>      <span style=color:#66d9ef>float64</span>  <span style=color:#e6db74>`json:&#34;p&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Timestamp</span>  <span style=color:#66d9ef>uint64</span>   <span style=color:#e6db74>`json:&#34;t&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Conditions</span> []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;c&#34; omitempty:&#34;true&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// This represents the entire websocket response that comes back from a single call to the Finnhub Server
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Note that a single Response may contain many Data points
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Response</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Type</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;type&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Data</span> []<span style=color:#a6e22e>Data</span> <span style=color:#e6db74>`json:&#34;data&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Announce is a helper function that takes as input a event chan that gets created by calling sub.Subscribe()
</span></span></span><span style=display:flex><span><span style=color:#75715e>// and ranges over any events that it receives on the chan, unmarshals them, and prints them out
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Announce</span>(<span style=color:#a6e22e>events</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Event</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>tick</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>events</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>trades</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Response</span>{}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>tick</span>.<span style=color:#a6e22e>Data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>trades</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#e6db74>&#34;unable to unmarshal event: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>trades</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create Ensign Client
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>client</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>New</span>() <span style=color:#75715e>// if your credentials are already in your bash profile, you don&#39;t have to pass anything into New()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// client, err := ensign.New(ensign.WithCredentials(&#34;YOUR CLIENT ID HERE!&#34;, &#34;YOUR CLIENT SECRET HERE!&#34;))
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not create client: %s&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Check to see if topic exists, if it does then the variable exists will be True
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>exists</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>TopicExists</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>Trades</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unable to check topic existence: %s&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>topicID</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// If the topic does not exist, create it using the CreateTopic method
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>exists</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>topicID</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>CreateTopic</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>Trades</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unable to create topic: %s&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// The topic does exist, but we need to figure out what the Topic ID is, so we need
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// to query the ListTopics method to get back a list of all the topic nickname : topicID mappings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>topicID</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>TopicID</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>Trades</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unable to get id for topic: %s&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>key</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;FINNHUB_KEY&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;Finnhub key is required: get one at https://finnhub.io/&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Get trades from Finnhub - FYI this Dialer dials the &#34;Trades&#34; endpoint
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// see https://finnhub.io/docs/api/websocket-trades for more details
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>finnhub_url</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprint</span>(<span style=color:#e6db74>&#34;wss://ws.finnhub.io?token=&#34;</span>, <span style=color:#a6e22e>key</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>websocket</span>.<span style=color:#a6e22e>DefaultDialer</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#a6e22e>finnhub_url</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The complete list of options is long! This is a short list, but no guarantee that all will be updated for every tick
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>symbols</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;AAPL&#34;</span>, <span style=color:#e6db74>&#34;AMZN&#34;</span>, <span style=color:#e6db74>&#34;PCG&#34;</span>, <span style=color:#e6db74>&#34;SNAP&#34;</span>}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>symbols</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>msg</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{<span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;subscribe&#34;</span>, <span style=color:#e6db74>&#34;symbol&#34;</span>: <span style=color:#a6e22e>s</span>})
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteMessage</span>(<span style=color:#a6e22e>websocket</span>.<span style=color:#a6e22e>TextMessage</span>, <span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create a subscriber  - the same subscriber should be consuming each event that comes down the pipe
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>sub</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Subscribe</span>(<span style=color:#a6e22e>topicID</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;could not create subscriber: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Loop over each response that is returned by the Finnhub websocket, publish it to the topicID, have the subscriber consume to the events channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// The Response struct is how we will boost the standard json marshalling library to know how to unpack and repackage Finnhub ticks
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>msg</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Response</span>{}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>ReadJSON</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Message from the websocket server is &#34;</span>, <span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>e</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Event</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Mimetype</span>: <span style=color:#a6e22e>mimetype</span>.<span style=color:#a6e22e>ApplicationJSON</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Type</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>Type</span>{
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Name</span>:         <span style=color:#e6db74>&#34;Generic&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>MajorVersion</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>MinorVersion</span>: <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>PatchVersion</span>: <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Data</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>msg</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#e6db74>&#34;could not marshal data to JSON: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Publish the newly received tick event to the Topic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Publishing to topic id: %s\n&#34;</span>, <span style=color:#a6e22e>topicID</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Publish</span>(<span style=color:#a6e22e>topicID</span>, <span style=color:#a6e22e>e</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Goroutine to check the events channel to ensure that subscriber is getting all the ticks!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>Announce</span>(<span style=color:#a6e22e>sub</span>.<span style=color:#a6e22e>C</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div></div><div class=items-center><img src=https://rotational.io/img/data-playground/finnhub_flowchart.png alt='Finnhub integration with Ensign' class="m-auto py-3 w-[1080px]"></div><div class="w-full px-10 text-xl font-bold mt-5"><h2 class=text-xl>Data Products Showcase</h2><article class=prose></article></div><section class=ml-10><table class="table-auto border border-collapse border-slate-600 text-md mt-2 overflow-auto"><thead class="bg-[#1D65A6] text-white text-left"><tr><th class=finnhub-showcase>Creator</th><th class=finnhub-showcase>Description</th><th class=finnhub-showcase>Event Data</th><th class=finnhub-showcase>URL</th><th class=finnhub-showcase>GitHub</th><th class=finnhub-showcase>Date</th></tr></thead><tbody><tr><td class=finnhub-showcase>Prema Roman & Patrick Deziel</td><td class=finnhub-showcase>Stock ticker</td><td class=finnhub-showcase>Stock prices</td><td class="finnhub-showcase underline"><a href=https://trades.rotational.dev/ target=_blank>https://trades.rotational.dev/</a></td><td class="finnhub-showcase underline"><a href=https://github.com/rotationalio/pypredict target=_blank>https://github.com/rotationalio/pypredict</a></td><td class=finnhub-showcase>16-June-2023</td></tr></tbody></table></section></main><div id=footerBackground><footer class="bg-hero-footer bg-cover"><div class="pt-[350px] font-extralight text-white"><div class="max-w-7xl mx-auto px-6"><div class="max-[650px]:text-center sm:grid grid-cols-4"><div><a href=/><img src=img/footer-otter.png alt class="mx-auto mt-28 sm:mt-0"></a></div><div class="my-10 sm:my-0"><h5 class=mb-3>PRODUCT</h5><ul><li class=pb-3><a href=https://rotational.app target=_blank class=font-bold>Ensign</a></li><li class=pb-3><a href=https://ensign.rotational.dev/getting-started/ target=_blank class=font-bold>Documentation</a></li><li class=pb-3><a href=https://ensign.rotational.dev/sdk/ target=_blank class=font-bold>SDKs</a></li></ul></div><div class="mb-10 sm:mb-0"><h5 class=mb-3>COMPANY</h5><ul><li class=pb-3><a href=/services class=font-bold>Services</a></li><li class=pb-3><a href=/blog class=font-bold>Blog</a></li><li class=pb-3><a href=/opensource class=font-bold>Open Source</a></li><li class=pb-3><a href=/about class=font-bold>About</a></li><li class=pb-3><a href=/contact class=font-bold>Contact Us</a></li></ul></div><div><h5 class=mb-3>INFORMATION</h5><ul><li class=pb-3><a href=/privacy class=font-bold>Privacy</a></li><li class=pb-3><a href=/terms class=font-bold>Terms</a></li></ul></div></div><div class="max-w-7xl sm:flex justify-between border-t py-6 mt-12 sm:mt-32"><div class="mx-auto xl:ml-5 sm:mt-0 mt-8"><div><ul class="mx-auto grid grid-cols-2 gap-x-20 md:gap-x-32 lg:grid-cols-4 xl:ml-20"><li class="pb-8 mt-1"><a href=https://twitter.com/rotationalio class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/twitter.svg alt class=scale-75>
<span class=ml-4>Twitter</span></a></li><li class="pb-8 mt-1"><a href=https://github.com/rotationalio class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/github.svg alt class=scale-[.8]>
<span class=ml-4>GitHub</span></a></li><li class=pb-8><a href=https://www.linkedin.com/company/rotational class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/linkedin.svg alt class=scale-75>
<span class="mt-2 ml-4">LinkedIn</span></a></li><li class="pb-8 mt-2"><a href=mailto:info@rotational.io class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/email.svg alt class=scale-[.8]>
<span class=ml-4>Email</span></a></li></ul></div></div></div><div class="sm:flex justify-between py-6"><p>Copyright © Rotational Labs, Inc. 2021–2023 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex"><li class="border-r pr-4 mr-4"><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></div></footer></div><script src=https://rotational.io/js/app.js></script>
<script src=https://rotational.io/js/playground-search.js></script>
<script src=https://rotational.io/js/copy-code-button.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js></script>
<script src=https://unpkg.com/@highlightjs/cdn-assets/highlight.min.js></script></body></html>