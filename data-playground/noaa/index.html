<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Rotational Labs | NOAA</title><base href=https://rotational.io/ target=_self><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="The National Oceanic and Atmospheric Administration's (NOAA's) National Weather Service offers critical real-time data. Get forecasts, alerts, observations, and other weather data."><meta name=keywords content="Rotational Labs,Ensign,Cloud-native,Real-time data streaming platform,Data collaboration,Data automation,Rapid prototyping,Real-time machine learning,Real-time data analytics,Real-time applications,Data streams,Event streams,Event-sourcing databaseEvent log"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="NOAA"><meta property="og:description" content="The National Oceanic and Atmospheric Administration's (NOAA's) National Weather Service offers critical real-time data. Get forecasts, alerts, observations, and other weather data."><meta property="og:image" content="https://rotational.io/img/data-playground/noaa.png"><meta property="og:url" content="https://rotational.io/data-playground/noaa/"><meta property="og:type" content="website"><meta name=twitter:title content="NOAA"><meta name=twitter:card content="summary"><meta name=twitter:description content="The National Oceanic and Atmospheric Administration's (NOAA's) National Weather Service offers critical real-time data. Get forecasts, alerts, observations, and other weather data."><meta name=twitter:image content="https://rotational.io/img/data-playground/noaa.png"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css><link rel=stylesheet href=https://unpkg.com/@highlightjs/cdn-assets/styles/default.min.css><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script async src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script>
<script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script><script src=https://kit.fontawesome.com/2c36e9b7b1.js crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr/lunr.js></script></head><body class="bg-hexagon bg-center bg-contain"><div class="relative bg-[#1D65A6]"><nav class="relative max-w-7xl mx-auto flex items-center justify-between text-white px-4 sm:px-6 z-[9999] py-5" aria-label=Global><a href=/><img src=img/logo.png alt="Rotational Lab logo" class="h-14 w-auto sm:h-14"></a><div class=topnav id=myTopnav><a href=/ensign/>Ensign</a>
<a href=/data-playground>Data Playground</a>
<a href=/opensource/>Open Source</a>
<a href=/blog/>Blog</a>
<a href=/about/>About</a>
<a href=https://rotational.app>Login</a>
<a class=icon onclick=openMobNav()><i class="fa fa-bars"></i></a></div></nav></div><main><div class="max-w-7xl mx-auto px-4 relative"><div class="w-full bg-[#ECF6FF] flex justify-between my-10 place-items-center h-36 px-10"><div class="flex flex-col font-bold"><h2 class=text-2xl>NOAA</h2><h3 class=text-lg>Weather Data</h3></div><div><a href=https://github.com/rotationalio/data-playground/tree/main/weather target=_blank class="bg-black font-bold px-3 sm:px-6 py-4 rounded-md text-sm text-white md:text-base flex items-center gap-4 hover:bg-neutral-900"><span class="text-sm sm:text-base">Get Started</span>
<span class="hidden sm:flex"><img src=img/data-playground/github.png alt="github icon" height=36 width=36></span></a></div></div><div class="w-full flex flex-col gap-4 sm:gap-8 sm:flex-row justify-between px-10"><div class=w-1/2><div class="flex flex-col my-4"><p class="text-xl font-bold mb-5">About This Data Source</p><p class=text-base>The National Oceanic and Atmospheric Administration's (NOAA's) National Weather Service offers critical real-time data. Get forecasts, alerts, observations, and other weather data.</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Producer</p><p class=text-base><a class="cursor-pointer underline" href=https://www.weather.gov/documentation/services-web-api>NOAA</p></a></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Data</p><p class=text-base>Weather forecasts, alerts, and observations</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Account Required</p><p class=text-base>No</p></div><div class="flex flex-col my-4"><div class="flex flex-row gap-2"><p class="text-lg font-bold">License</p><p data-attr=tooltip id=tooltip class=h-6><img src=img/data-playground/tooltip.svg alt=tooltip width=24 height=24></p><div id=tooltip-text class="hidden bg-neutral-200 text-black text-sm rounded-lg p-2 absolute ml-20"><p class="text-xs font-semibold">Warning</p><p>Please review terms and conditions. Access to data sources can change.</p></div></div><p class=text-base>Free</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">API Key</p><p class=text-base>No</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">API Type</p><p class=text-base>REST, JSON-LD, GeoJSON, OXML</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">SDKS</p><p class=text-base>N/A</p></div><div class="flex flex-col my-4"><p class="text-lg font-bold">Limits</p><p class=text-base>The rate limit is not public information, but allows a generous amount for typical use. If the rate limit is exceeded, the request will return with an error, and may be retried after the limit clears (typically within 5 seconds). Proxies are more likely to reach the limit, whereas requests directly from clients are not likely.</p></div></div><div class=flex-1 id=code-snippets><div class=tab-container><div class="tab-nav flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200"><button onclick='switchTab("default","Python")' data-tab-item=Python data-tab-group=default class='tab-button active inline-block p-4 bg-gray-100 [&.active]:bg-[#192E5B] [&.active]:text-white rounded-t-lg'>Python</button><button onclick='switchTab("default","Go")' data-tab-item=Go data-tab-group=default class='tab-button inline-block p-4 bg-gray-100 [&.active]:bg-[#192E5B] [&.active]:text-white rounded-t-lg'>Go</button></div><div class="tab-content -mt-0"><div data-tab-item=Python data-tab-group=default class='tab-item active'><button id=copy-code-button class="copy-code-button absolute text-white text-xs right-[3.5rem] bg-red-500 p-1 hover:text-red-700 [&.active]:bg-green-600 mt-[0.75rem] mr-[0.75rem]">
Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> asyncio
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> warnings
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyensign.events <span style=color:#f92672>import</span> Event
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyensign.ensign <span style=color:#f92672>import</span> Ensign
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># TODO Python&gt;3.10 needs to ignore DeprecationWarning: There is no current event loop</span>
</span></span><span style=display:flex><span>warnings<span style=color:#f92672>.</span>filterwarnings(<span style=color:#e6db74>&#34;ignore&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># TODO: replace with YOU - your email and app details :)</span>
</span></span><span style=display:flex><span>ME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(https://rotational.io/data-playground/noaa/, weather@rotational.io)&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># TODO: these are memorable for ME. Replace with the locations of interest to YOU</span>
</span></span><span style=display:flex><span>LOCS <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;north_pole&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;lat&#34;</span>: <span style=color:#e6db74>&#34;64.7511&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;long&#34;</span>: <span style=color:#e6db74>&#34;-147.3494&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;cafe_du_monde&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;lat&#34;</span>: <span style=color:#e6db74>&#34;29.957684&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;long&#34;</span>: <span style=color:#e6db74>&#34;-90.061892&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WeatherPublisher</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    WeatherPublisher queries an API for weather updates and publishes events to Ensign.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, topic<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;noaa-reports-json&#34;</span>, interval<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>, locations<span style=color:#f92672>=</span>LOCS, user<span style=color:#f92672>=</span>ME):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Initialize a WeatherPublisher by specifying a topic, locations, and other user-
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        defined parameters.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ----------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        topic : string, default: &#34;noaa-reports-json&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            The name of the topic you wish to publish to. If the topic doesn&#39;t yet
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            exist, Ensign will create it for you. Tips on topic naming conventions can
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            be found at https://ensign.rotational.dev/getting-started/topics/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        interval : int, default: 60
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            The number of seconds to wait between API calls so that you do not anger
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            the weather API gods
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        locations : dict
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            A dictionary expressing the locations to retrieve weather details for.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            Note that these should all be in the USA since NOAA is located in the US :)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        user : str
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            When querying the NOAA API, as a courtesy, they like you to identify your
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            app and contact info (aka User Agent details)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>topic <span style=color:#f92672>=</span> topic
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>interval <span style=color:#f92672>=</span> interval
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>locations <span style=color:#f92672>=</span> locations
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://api.weather.gov/points/&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>user <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;User-Agent&#34;</span>: user}
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>datatype <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;application/json&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># NOTE: If you need a client_id and client_secret, register for a free account</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># at: https://rotational.app/register</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Start a connection to the Ensign server. If you do not supply connection</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># details, PyEnsign will read them from your environment variables.</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>ensign <span style=color:#f92672>=</span> Ensign()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Alternatively you can supply `client_id` &amp; `client_secret` as string args, eg</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># self.ensign = Ensign(client_id=&#34;your_client_id&#34;, client_secret=&#34;your_secret&#34;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_ack</span>(self, ack):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Enable the Ensign server to notify the Publisher the event has been acknowledged
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        This is optional for you, but can be very helpful for communication in
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        asynchronous contexts!
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        ts <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>fromtimestamp(
</span></span><span style=display:flex><span>            ack<span style=color:#f92672>.</span>committed<span style=color:#f92672>.</span>seconds <span style=color:#f92672>+</span> ack<span style=color:#f92672>.</span>committed<span style=color:#f92672>.</span>nanos <span style=color:#f92672>/</span> <span style=color:#ae81ff>1e9</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Event committed at </span><span style=color:#e6db74>{</span>ts<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_nack</span>(self, nack):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Enable the Ensign server to notify the Publisher the event has NOT been
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        acknowledged
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        This is optional for you, but can be very helpful for communication in
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        asynchronous contexts!
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Event was not committed with error </span><span style=color:#e6db74>{</span>nack<span style=color:#f92672>.</span>code<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>nack<span style=color:#f92672>.</span>error<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>compose_query</span>(self, location):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Combine the base URI with the lat/long query params
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ----------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        location : dict
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            A dictionary expressing a location to retrieve weather details for.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            Note that it should all be in the USA since NOAA is located in the US :)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            For example: {&#34;lat&#34;: &#34;64.7511&#34;, &#34;long&#34;: &#34;-147.3494&#34;}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        lat <span style=color:#f92672>=</span> location<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;lat&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        long <span style=color:#f92672>=</span> location<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;long&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> lat <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> long <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;unable to parse latitude/longitude from location&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>url <span style=color:#f92672>+</span> lat <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;,&#34;</span> <span style=color:#f92672>+</span> long
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Run the publisher forever.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        asyncio<span style=color:#f92672>.</span>get_event_loop()<span style=color:#f92672>.</span>run_until_complete(self<span style=color:#f92672>.</span>recv_and_publish())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>recv_and_publish</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        At some interval (`self.interval`), ping the api.weather.com to get
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        weather reports for the `self.locations`.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        NOTE: this requires 2 calls to the NOAA API, per location:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - the first request provides a lat/long and retrieves forecast URL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - the second request provides the forecast URL and gets forecast details
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Publish report data to the `self.topic`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> self<span style=color:#f92672>.</span>ensign<span style=color:#f92672>.</span>ensure_topic_exists(self<span style=color:#f92672>.</span>topic)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> location <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>locations<span style=color:#f92672>.</span>values():
</span></span><span style=display:flex><span>                <span style=color:#75715e># Note that we&#39;re making a different API call for each location</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># TODO: can these be bundled so that we can make fewer calls?</span>
</span></span><span style=display:flex><span>                query <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>compose_query(location)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># If successful, the initial response returns a link you can use to</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># retrieve the full hourly forecast</span>
</span></span><span style=display:flex><span>                response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(query)<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>                forecast_url <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>parse_forecast_link(response)
</span></span><span style=display:flex><span>                forecast <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(forecast_url)<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># After we retrieve and unpack the full hourly forecast, we can publish</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># each period of the forecast as a new event</span>
</span></span><span style=display:flex><span>                events <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>unpack_noaa_response(forecast)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> event <span style=color:#f92672>in</span> events:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>await</span> self<span style=color:#f92672>.</span>ensign<span style=color:#f92672>.</span>publish(
</span></span><span style=display:flex><span>                        self<span style=color:#f92672>.</span>topic,
</span></span><span style=display:flex><span>                        event,
</span></span><span style=display:flex><span>                        on_ack<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>print_ack,
</span></span><span style=display:flex><span>                        on_nack<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>print_nack,
</span></span><span style=display:flex><span>                    )
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>await</span> asyncio<span style=color:#f92672>.</span>sleep(self<span style=color:#f92672>.</span>interval)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>parse_forecast_link</span>(self, message):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Parse a preliminary forecast response from the NOAA API to get a forecast URL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ----------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        message : dict
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            JSON formatted response from the NOAA API containing a forecast URL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Returns
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        -------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        forecast_link : string
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            Specific API-generated URL with the link to get the detailed forecast for
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            the requested location
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        properties <span style=color:#f92672>=</span> message<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;properties&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> properties <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;unexpected response from api call, no properties&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        forecast_link <span style=color:#f92672>=</span> properties<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;forecast&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> forecast_link <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;unexpected response from api call, no forecast&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> forecast_link
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>unpack_noaa_response</span>(self, message):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Convert a message from the NOAA API to potentially multiple Ensign events,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        and yield each.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ----------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        message : dict
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            JSON formatted response from the NOAA API containing forecast details
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        properties <span style=color:#f92672>=</span> message<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;properties&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> properties <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;unexpected response from forecast request, no properties&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        periods <span style=color:#f92672>=</span> properties<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;periods&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> periods <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;unexpected response from forecast request, no periods&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> period <span style=color:#f92672>in</span> periods:
</span></span><span style=display:flex><span>            <span style=color:#75715e># There&#39;s a lot available! For this example, we&#39;ll just parse out a few</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># fields from the NOAA API response:</span>
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;name&#34;</span>: period<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;summary&#34;</span>: period<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;shortForecast&#34;</span>, <span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;temperature&#34;</span>: period<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;temperature&#34;</span>, <span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;units&#34;</span>: period<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;temperatureUnit&#34;</span>, <span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;daytime&#34;</span>: period<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;isDaytime&#34;</span>, <span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;start&#34;</span>: period<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;startTime&#34;</span>, <span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;end&#34;</span>: period<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;endTime&#34;</span>, <span style=color:#66d9ef>None</span>),
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> Event(json<span style=color:#f92672>.</span>dumps(data)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;utf-8&#34;</span>), mimetype<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>datatype)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    publisher <span style=color:#f92672>=</span> WeatherPublisher()
</span></span><span style=display:flex><span>    publisher<span style=color:#f92672>.</span>run()
</span></span></code></pre></div></div><div data-tab-item=Go data-tab-group=default class=tab-item><button id=copy-code-button class="copy-code-button absolute text-white text-xs right-[3.5rem] bg-red-500 p-1 hover:text-red-700 [&.active]:bg-green-600 mt-[0.75rem] mr-[0.75rem]">
Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;bytes&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http/cookiejar&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/url&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/rs/zerolog/log&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// NOTE: A User Agent is required to identify your application.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// This string can be anything, and should be unique to your application
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Include contact information (website or email) so NOAA can contact you
</span></span></span><span style=display:flex><span><span style=color:#75715e>// if your string is associated to a security event.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>UserAgent</span>      = <span style=color:#e6db74>&#34;(myweatherapp.com, contact@myweatherapp.com)&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>BaseWeatherURL</span> = <span style=color:#e6db74>&#34;https://api.weather.gov&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Weather</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>client</span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Client</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>baseURL</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>URL</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewWeatherAPI</span>() (<span style=color:#a6e22e>api</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Weather</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>api</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Weather</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>client</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Client</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Transport</span>:     <span style=color:#66d9ef>nil</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>CheckRedirect</span>: <span style=color:#66d9ef>nil</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Timeout</span>:       <span style=color:#ae81ff>30</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>,
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Jar</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>cookiejar</span>.<span style=color:#a6e22e>New</span>(<span style=color:#66d9ef>nil</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not create cookiejar: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>baseURL</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>BaseWeatherURL</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>api</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Weather</span>) <span style=color:#a6e22e>Alerts</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#a6e22e>_</span> []<span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>NewRequest</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>MethodGet</span>, <span style=color:#e6db74>&#34;/alerts/active&#34;</span>, <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rep</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Response</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>alerts</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rep</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>alerts</span>, <span style=color:#66d9ef>true</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>logctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>With</span>().<span style=color:#a6e22e>Err</span>(<span style=color:#a6e22e>err</span>).<span style=color:#a6e22e>Logger</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rep</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Get the NOAA request headers to log the error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>correlationID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;X-Correlation-Id&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>requestID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;X-Request-Id&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>serverID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;X-Server-Id&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>logctx</span> = <span style=color:#a6e22e>logctx</span>.<span style=color:#a6e22e>With</span>().
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Str</span>(<span style=color:#e6db74>&#34;correlation_id&#34;</span>, <span style=color:#a6e22e>correlationID</span>).
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Str</span>(<span style=color:#e6db74>&#34;request_id&#34;</span>, <span style=color:#a6e22e>requestID</span>).
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Str</span>(<span style=color:#e6db74>&#34;server_id&#34;</span>, <span style=color:#a6e22e>serverID</span>).
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Logger</span>()
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>logctx</span>.<span style=color:#a6e22e>Error</span>().<span style=color:#a6e22e>Msg</span>(<span style=color:#e6db74>&#34;could not fetch active alerts&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>features</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>alerts</span>[<span style=color:#e6db74>&#34;features&#34;</span>]; <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>features</span>.([]<span style=color:#66d9ef>interface</span>{}), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;no alerts returned&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>accept</span>      = <span style=color:#e6db74>&#34;application/geo+json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>acceptLang</span>  = <span style=color:#e6db74>&#34;en-US,en&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>contentType</span> = <span style=color:#e6db74>&#34;application/json; charset=utf-8&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Weather</span>) <span style=color:#a6e22e>NewRequest</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>method</span>, <span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>data</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>params</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>Values</span>) (<span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Resolve the URL reference from the path
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>url</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>baseURL</span>.<span style=color:#a6e22e>ResolveReference</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>URL</span>{<span style=color:#a6e22e>Path</span>: <span style=color:#a6e22e>path</span>})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>params</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>&amp;&amp;</span> len(<span style=color:#f92672>*</span><span style=color:#a6e22e>params</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>RawQuery</span> = <span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>Encode</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>body</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>ReadWriter</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>switch</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span>:
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>body</span> = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>body</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>{}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#a6e22e>body</span>).<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>data</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not serialize request data as json: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create the http request
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewRequestWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>method</span>, <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>String</span>(), <span style=color:#a6e22e>body</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not create request: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Set the headers on the request
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;User-Agent&#34;</span>, <span style=color:#a6e22e>UserAgent</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;Accept&#34;</span>, <span style=color:#a6e22e>accept</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;Accept-Language&#34;</span>, <span style=color:#a6e22e>acceptLang</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>body</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#a6e22e>contentType</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Add CSRF protection if its available
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Jar</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>cookies</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Jar</span>.<span style=color:#a6e22e>Cookies</span>(<span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>cookie</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>cookies</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cookie</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;csrf_token&#34;</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;X-CSRF-TOKEN&#34;</span>, <span style=color:#a6e22e>cookie</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>req</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Do executes an http request against the server, performs error checking, and
</span></span></span><span style=display:flex><span><span style=color:#75715e>// deserializes the response data into the specified struct.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Weather</span>) <span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#a6e22e>data</span> <span style=color:#66d9ef>interface</span>{}, <span style=color:#a6e22e>checkStatus</span> <span style=color:#66d9ef>bool</span>) (<span style=color:#a6e22e>rep</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Response</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rep</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>rep</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not execute request: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Body</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Detect http status errors if they&#39;ve occurred
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>checkStatus</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>StatusCode</span> &lt; <span style=color:#ae81ff>200</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>StatusCode</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>rep</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;[%d] %s&#34;</span>, <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>StatusCode</span>, <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Status</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Deserialize the JSON data from the body
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>StatusCode</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>200</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>StatusCode</span> &lt; <span style=color:#ae81ff>300</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>StatusCode</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusNoContent</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Check the content type to ensure data deserialization is possible
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ct</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>); <span style=color:#a6e22e>ct</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>accept</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>rep</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unexpected content type: %q&#34;</span>, <span style=color:#a6e22e>ct</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Body</span>).<span style=color:#a6e22e>Decode</span>(<span style=color:#a6e22e>data</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not deserialize response data: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>rep</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Weather</span>) <span style=color:#a6e22e>SetBaseURL</span>(<span style=color:#a6e22e>u</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>URL</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>baseURL</span> = <span style=color:#a6e22e>u</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></div></div></div></div><div class="w-full px-10 text-xl font-bold mt-5"><h2 class=text-xl>Data Products Showcase</h2><article class=prose></article></div><div class="mt-2 ml-10"><p>Coming soon!</p></div><script src=https://rotational.io/js/copy-code-button.js></script></main><div id=footerBackground><footer class="bg-hero-footer bg-cover"><div class="pt-[350px] font-extralight text-white"><div class="max-w-7xl mx-auto px-6"><div class="max-[650px]:text-center sm:grid grid-cols-4"><div><a href=/><img src=img/footer-otter.png alt class="mx-auto mt-28 sm:mt-0"></a></div><div class="my-10 sm:my-0"><h5 class=mb-3>PRODUCT</h5><ul><li class=pb-3><a href=https://rotational.app target=_blank class=font-bold>Ensign</a></li><li class=pb-3><a href=https://ensign.rotational.dev/getting-started/ target=_blank class=font-bold>Documentation</a></li><li class=pb-3><a href=https://ensign.rotational.dev/sdk/ target=_blank class=font-bold>SDKs</a></li></ul></div><div class="mb-10 sm:mb-0"><h5 class=mb-3>COMPANY</h5><ul><li class=pb-3><a href=/services class=font-bold>Services</a></li><li class=pb-3><a href=/blog class=font-bold>Blog</a></li><li class=pb-3><a href=/opensource class=font-bold>Open Source</a></li><li class=pb-3><a href=/about class=font-bold>About</a></li><li class=pb-3><a href=/contact class=font-bold>Contact Us</a></li></ul></div><div><h5 class=mb-3>INFORMATION</h5><ul><li class=pb-3><a href=/privacy class=font-bold>Privacy</a></li><li class=pb-3><a href=/terms class=font-bold>Terms</a></li></ul></div></div><div class="max-w-7xl sm:flex justify-between border-t py-6 mt-12 sm:mt-32"><div class="mx-auto xl:ml-5 sm:mt-0 mt-8"><div><ul class="mx-auto grid grid-cols-2 gap-x-20 md:gap-x-32 lg:grid-cols-4 xl:ml-20"><li class="pb-8 mt-1"><a href=https://twitter.com/rotationalio class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/twitter.svg alt class=scale-75>
<span class=ml-4>Twitter</span></a></li><li class="pb-8 mt-1"><a href=https://github.com/rotationalio class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/github.svg alt class=scale-[.8]>
<span class=ml-4>GitHub</span></a></li><li class=pb-8><a href=https://www.linkedin.com/company/rotational class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/linkedin.svg alt class=scale-75>
<span class="mt-2 ml-4">LinkedIn</span></a></li><li class="pb-8 mt-2"><a href=mailto:info@rotational.io class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/email.svg alt class=scale-[.8]>
<span class=ml-4>Email</span></a></li></ul></div></div></div><div class="sm:flex justify-between py-6"><p>Copyright  Rotational Labs, Inc. 20212023  All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex"><li class="border-r pr-4 mr-4"><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></div></footer></div><script src=https://rotational.io/js/app.js></script>
<script src=https://rotational.io/js/playground-search.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js></script>
<script src=https://unpkg.com/@highlightjs/cdn-assets/highlight.min.js></script></body></html>