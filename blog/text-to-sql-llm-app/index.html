<!doctype html><html lang=en-us><head><meta charset=UTF-8><title>Rotational Labs | How to build a text-to-sql LLM application</title>
<base href=https://rotational.io/ target=_self><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="Accelerate data analysis by leveraging LLMs to build text-to-sql applications"><meta name=keywords content="AI solutions for mid-market companies,AI-driven tools,Business automation solutions,AI-powered interfaces,Intelligent agents,Natural language processing (NLP),Computer vision AI,Streamline operations with AI,machine learning,Boost business performance with AI,AI for business growth,Tailored AI solutions,Trusted AI solutions,AI for operational efficiency,Secure AI tools,AI expertise for mid-market businesses,Endeavor"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="How to build a text-to-sql LLM application"><meta property="og:description" content="Accelerate data analysis by leveraging LLMs to build text-to-sql applications"><meta property="og:image" content="https://rotational.io/img/blog/2024-06-07-text-to-sql-llm-app/dashboard.webp"><meta property="og:url" content="https://rotational.io/blog/text-to-sql-llm-app/"><meta property="og:type" content="website"><meta name=twitter:title content="How to build a text-to-sql LLM application"><meta name=twitter:card content="summary"><meta name=twitter:description content="Accelerate data analysis by leveraging LLMs to build text-to-sql applications"><meta name=twitter:image content="https://rotational.io/img/blog/2024-06-07-text-to-sql-llm-app/dashboard.webp"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW" defer></script><script type=module>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-2FKX6CWJHW');
</script><script src=https://kit.fontawesome.com/fea17a4e21.js crossorigin=anonymous></script></head><body><div class="relative bg-[#1D65A6]"><nav class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-5" aria-label=Global><div class="relative max-w-7xl w-full flex flex-wrap lg:flex-nowrap items-center justify-between mx-auto"><a href=/><img src=/img/rototational-white-text-only_hu15583614935666962927.webp alt=Rotational class="h-6 w-auto">
</a><button data-collapse-toggle=navbar-dropdown type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls=navbar-dropdown aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="fa fa-bars text-xl text-white"></i></button><div class="hidden absolute z-[9999] lg:static top-16 w-[92%] md:w-[96%] lg:w-auto lg:block bg-white lg:bg-transparent text-[#192E5B] lg:text-[#F2F2F2] py-2 rounded-md" id=navbar-dropdown><ul class="flex flex-col lg:gap-2 xl:gap-4 md:flex-row font-semibold w-full md:justify-between"><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/about/>About</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><button id=dropdownNavbarLink data-dropdown-toggle=dropdownNavbar class="uppercase flex items-center justify-between gap-x-2 w-full px-3 rounded md:border-0 md:p-0 md:w-auto hover:text-black">
Services
<i class="fa fa-angle-down pt-1"></i></button><div id=dropdownNavbar class="z-10 hidden font-normal bg-[#192E5B] divide-y divide-[#192E5B] rounded-lg shadow w-44"><ul class="py-2 text-sm text-[#F2F2F2]" aria-labelledby=dropdownLargeButton><li><a href=/services/ai-assessments/ class="block px-3 py-2 hover:font-bold">AI Assessments</a></li><li><a href=/services/ai-product-development/ class="block px-3 py-2 hover:font-bold">AI Product Development</a></li><li><a href=/services/ai-ops-and-data-foundations/ class="block px-3 py-2 hover:font-bold">AI Ops & Data Foundations</a></li></ul></div></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/case-studies>Case Studies</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/blog/>Blog</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/learning/>Learning</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/endeavor/>Endeavor</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/contact/>Contact</a></li></ul></div></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=/img/blog/2024-06-07-text-to-sql-llm-app/dashboard_hu10486745171311772637.webp alt="How to build a text-to-sql LLM application" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="How to build a text-to-sql LLM application"><b class=text-[#1D65A6]>How </b>to build a text-to-sql LLM application</h3><div class="flex flex-wrap justify-center items-center my-4"><a href=/authors/prema-roman><img src=img/team/prema-roman.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span><a href=/authors/prema-roman>Prema Roman</a> | Friday, Jun 7, 2024 |&nbsp;
</span><span><a href=/tags/ai>AI</a>,&nbsp;
</span><a href=/tags/ml>ML</a>,&nbsp;
</span><a href=/tags/llm>LLM</a>,&nbsp;
</span><a href=/tags/python>Python</a></span></div><article class="max-w-[800px] mx-auto prose"><p>As industry races for use cases of Large Language Models, software devs have emerged as early adopters. Can LLMs help us translate between tech and talk? Let&rsquo;s build a text-to-SQL application with Vanna and Streamlit!</p><p>How many of us have struggled to communicate with non-technical audiences about data? So much of what we do as software engineers doesn&rsquo;t translate to our users and our counterparts on the business side. If your customer wants to understand why their account has been flagged, they can&rsquo;t query the database directly. Admittedly, that would be a bad idea for many reasons, but even if you were to give them readonly credentials, they&rsquo;d have to write a valid query in order to answer their question. That&rsquo;s pretty unlikely unless they somehow already know SQL!</p><p>Most applications include web-based user interfaces with drop-down menus which enable the customer to compose parameters for a valid query, which can then be executed on the back end. With the rise of Large Language Models (LLMs), many businesses are starting to wonder if it might be possible to streamline with simple chat interfaces, which use a text-to-SQL language model on the back end to translate between the natural language questions of the user to valid SQL queries that can be directly executed against the database.</p><p>In this post, we&rsquo;ll explore the technical feasibility of such an approach.</p><p>Just here for the code? Check out this <a href=https://github.com/pdamodaran/vanna-text-to-sql>repo</a> for the full example.</p><h2 id=getting-started>Getting Started</h2><p>Vanna is an open source Python library developed by <a href=https://vanna.ai>Vanna.AI</a>. It uses Retrieval Augmented Generation (RAG), which is a technique that is used to improve the accuracy of LLMs. The idea is to provide data to an LLM that it was not previously trained on to ensure that it can generate reasonable responses to questions related to this data. In this case, the data provided is the knowledge about the internals of your database. The process will be covered later in this post.</p><h3 id=step-1-create-a-free-vannaai-account>Step 1: Create a free Vanna.AI account</h3><p>Follow the instructions in the <a href=https://vanna.ai>Vanna.AI</a> website to create an account. Once you are logged in, you will need to do the following:</p><ul><li>Get an API key (click on <code>API Keys</code> on the left side of the page)</li><li>Create a new RAG model (click on <code>RAG Models</code> on the left side of the page and choose a unique name for your model and click on the <code>Create Model</code> button)</li></ul><h3 id=step-2-create-and-activate-a-virtual-environment>Step 2: Create and activate a virtual environment</h3><p>Run the following on the command line to create a fresh new Python virtual environment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virtualenv venv
</span></span><span style=display:flex><span>source venv/bin/activate
</span></span></code></pre></div><h3 id=step-3-install-the-requirements>Step 3: Install the requirements</h3><p>In order to run the code, the following Python libraries are required:</p><ul><li><a href=https://streamlit.io>streamlit</a></li><li>vanna</li><li>vanna[postgres]</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install -r requirements.txt
</span></span></code></pre></div><h2 id=train-the-rag-model>Train the RAG model</h2><p>The following is a code snippet of the <code>DatabaseTrainer</code> class:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> vanna.remote <span style=color:#f92672>import</span> VannaDefault
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>INFO_SCHEMA_QUERY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT * FROM INFORMATION_SCHEMA.COLUMNS&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseTrainer</span>:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    DatabaseTrainer uses Vanna AI to learn in the internals of a Postgres database
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    to enable users to use natural language to generate and execute SQL queries
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, api_key<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, model<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, db_creds<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ----------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        api_key : string
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            The API key used to connect to Vanna AI
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        model : string
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            The name of the model that will be trained; the model needs
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            to be set up in your Vanna AI account prior to use
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        db_creds : dict
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            Credentials to connect to a Postgres database.  The dictionary
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            must contain the following keys: host, port, user, password, dbname
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> api_key <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> api_key <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;api_key must be a valid non-empty string&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> model <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> model <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;model must be valid non-empty string&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> db_creds <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;db_creds must be a valid non-empty dictionary&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Initialize vanna</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>vn <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>_init_vanna(api_key<span style=color:#f92672>=</span>api_key, model<span style=color:#f92672>=</span>model)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Connect to the Postgres database</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_connect_db(db_creds)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_init_vanna</span>(self, api_key, model):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Initialize the VannaDefault class by using the API key to connect to
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        the model set up in your Vanna AI account
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        vn <span style=color:#f92672>=</span> VannaDefault(api_key<span style=color:#f92672>=</span>api_key, model<span style=color:#f92672>=</span>model)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> vn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_connect_db</span>(self, db_creds):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Connect Vanna to the postgres database
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>vn<span style=color:#f92672>.</span>connect_to_postgres(host<span style=color:#f92672>=</span>db_creds[<span style=color:#e6db74>&#34;host&#34;</span>], port<span style=color:#f92672>=</span>db_creds[<span style=color:#e6db74>&#34;port&#34;</span>], user<span style=color:#f92672>=</span>db_creds[<span style=color:#e6db74>&#34;user&#34;</span>], password<span style=color:#f92672>=</span>db_creds[<span style=color:#e6db74>&#34;password&#34;</span>], dbname<span style=color:#f92672>=</span>db_creds[<span style=color:#e6db74>&#34;dbname&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>train</span>(self, ddl<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Train the model
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        Parameters
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ----------
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ddl : string
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;CREATE TABLE&#34; SQL statements of the tables in your database.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ddl <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span> <span style=color:#f92672>or</span> ddl <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>:
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;ddl must be a valid non-empty string&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># query the information_schema to get the table and column information from the database</span>
</span></span><span style=display:flex><span>        db_info_schema <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>vn<span style=color:#f92672>.</span>run_sql(INFO_SCHEMA_QUERY)
</span></span><span style=display:flex><span>        <span style=color:#75715e># break up the information schema into bite-sized chunks that will be referenced by the LLM</span>
</span></span><span style=display:flex><span>        plan <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>vn<span style=color:#f92672>.</span>get_training_plan_generic(db_info_schema)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>vn<span style=color:#f92672>.</span>train(plan<span style=color:#f92672>=</span>plan)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>vn<span style=color:#f92672>.</span>train(ddl<span style=color:#f92672>=</span>ddl)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Training complete!&#34;</span>)
</span></span></code></pre></div><p>Let’s break it down step by step.</p><p>To initialize the <code>DatabaseTrainer</code>, you need to pass in the following parameters:</p><ul><li><code>api_key</code>: Vanna API Key</li><li><code>model</code>: RAG model name</li><li><code>db_creds</code>: Credentials to connect to your Postgres database (this is a dictionary with the following keys: host, port, user, password, dbname)</li></ul><p>The <code>__init__</code> method does the following:</p><ul><li>Initialize the <code>VannaDefault</code> class by using the API key to connect to the model set up in your Vanna AI account.</li><li>Connect Vanna to your Postgres database using the database credentials.</li></ul><p>The <code>train</code> method requires a <code>ddl</code> parameter. This parameter is a string that contains all the <code>CREATE TABLE</code> SQL statements of the tables in your database. This method does the following:</p><ul><li>Run the following query to retrieve the table and column information from the database: <code>SELECT * FROM INFORMATION_SCHEMA.COLUMNS</code>.</li><li>Train the RAG model on the information schema and the ddl.</li></ul><p>The following code snippet is an example of how you can execute the training process:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> src.database_trainer <span style=color:#f92672>import</span> DatabaseTrainer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>database_trainer <span style=color:#f92672>=</span> DatabaseTrainer(api_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your Vanna API key&#34;</span>,
</span></span><span style=display:flex><span>    model<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your Vanna RAG model&#34;</span>,
</span></span><span style=display:flex><span>    db_creds<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your database credentials&#34;</span>)
</span></span><span style=display:flex><span>database_trainer<span style=color:#f92672>.</span>train(ddl<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your database DDL&#34;</span>)
</span></span></code></pre></div><h2 id=run-the-streamlit-text-to-sql-llm-application>Run the Streamlit text-to-sql LLM application</h2><p>Now that the RAG model has been trained, it’s time to integrate it into an application. Vanna has a few boilerplate examples on its website that you can use to get started. The code to run the application is based off Vanna’s streamlit example. You will need to add the following secrets in the <code>.streamlit/secrets.toml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>VANNA_API_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your Vanna API key&#34;</span>
</span></span><span style=display:flex><span>MODEL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Your Vanna RAG model&#34;</span>
</span></span><span style=display:flex><span>POSTGRES_HOST<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Database host&#34;</span>
</span></span><span style=display:flex><span>POSTGRES_PORT<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Database port&#34;</span>
</span></span><span style=display:flex><span>POSTGRES_USER<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Database user&#34;</span>
</span></span><span style=display:flex><span>POSTGRES_PWD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Database password&#34;</span>
</span></span><span style=display:flex><span>POSTGRES_DB<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Database name&#34;</span>
</span></span></code></pre></div><p>To run the application, simply run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python -m streamlit run sql_app.py
</span></span></code></pre></div><p>The following is a screenshot of the application. It provides the following functionality:</p><ul><li>View suggested questions</li><li>Display and execute the SQL code</li><li>See a table of the results</li><li>If applicable, show and execute Plotly code and display a chart</li><li>Show follow up questions</li></ul><p><img alt=screenshot src=/img/blog/2024-06-07-text-to-sql-llm-app/sql_app.webp></p><p>The <a href=https://github.com/pdamodaran/vanna-text-to-sql>repo</a> includes a demo of the application.</p><h2 id=conclusion>Conclusion</h2><p>As this post demonstrated, LLMs can be used to accelerate data analysis tasks by training a RAG model to build a text-to-sql application. This post just scratches the surface on how to build these types of applications.</p><p>Two important things to keep in mind&mldr;</p><h3 id=data-privacy>Data Privacy</h3><p>Vanna supports many databases including Postgres, SQLite, BigQuery, Snowflake, etc. You can start experimenting with a Jupyter Notebook or create applications using Streamlit, Flask, Slackbot, or integrate it within your own front end application. The pricing options are as follows:</p><ul><li><strong>Open source</strong>: You use your own LLM, set up a local metadata storage using ChromaDB or any other vector database, and deploy via self-hosted Streamlit, Flask app, etc. You also have the ability to customize as you see fit.</li><li><strong>Free tier</strong>: This tier uses the GPT 3.5 foundational model, hosted metadata storage and rate-limited usage of the LLM. <em>Note: This example uses the free tier plan for Vanna and a Postgres database.</em></li><li><strong>Paid tier</strong>: This tier costs $30/ 1 million tokens, uses the GPT-4 with a load-balanced fallback to other LLMs. It also provides SLA guarantees.</li><li><strong>Enterprise tier</strong>: Contact Vanna AI for a pricing plan that gives you access to developers who can help you customize your application based on your enterprise needs.</li></ul><p>Depending on the sensitivity of the data in your database, carefully consider the above options when you are building the application. This particular example uses a hosted LLM solution, which means that the data will be sent externally to the LLM. If you do not want to share your internal data with Vanna, you have the option to use Vanna with your own custom LLM, vector database, and RAG process and host the application on your own server. Vanna AI provides documentation on how to set this up. More details about Vanna&rsquo;s data security policy can be found <a href=https://vanna.ai/data-security-faq.html>here.</a></p><h3 id=accuracy>Accuracy</h3><p>One of the major drawbacks of LLMs is their tendency to hallucinate and produce inaccurate results. According to the <a href=https://bird-bench.github.io>BIRD</a> benchmark, the best performing text-to-SQL LLM in its leaderboard has an accuracy rate of <strong>67.86%</strong>. The BIRD paper stated that in spite of advances in LLMs and creative use of prompt engineering, they still struggle to outperform human beings. On some level, it makes sense, foundation LLMs are trained on a broader data set and struggle to perform well on a niche use case such as converting text to SQL.</p><p>However, the paper also notes that &ldquo;external knowledge evidence in BIRD is effective and instructive for models to better understand the database values&rdquo;. In fact, the accuracy of one of the models in the tests it conducted went up from <strong>34.88%</strong> to <strong>54.89%</strong>. What this means is that providing the LLM with more knowledge and context about your database and the underlying data will help improve the quality of the text-to-SQL application. In fact, Vanna also published an <a href=https://vanna.ai/blog/ai-sql-accuracy.html>article</a> that demonstrates how it tested different LLMs and context strategies to maximize accuracy.</p><p>They recommend the following suggestions to reduce errors:</p><ul><li>Train the model on documentation about your tables. For example, you can describe the type of data the table holds and possible values for fields in those tables. The way to train on documentation is as follows: <code>vn.train(documentation="insert documentation here")</code></li><li>Train the model on commonly run SQL queries: <code>vn.train(sql="insert sql here")</code></li><li>Train the model on question-sql pairs: <code>vn.train(question="insert question here", sql="insert sql here")</code></li></ul><p>Furthermore, the accuracy of the model can be improved over time by incorporating user feedback. For example, you can ask users to indicate whether a result was correct or not and have an input section where they can provide the correct answer. This feedback can be turned into new question-SQL pairs that can be used to train the model.</p><p>All of this highlights a salient point: using LLMs to completely automate data analysis tasks is not advisable. What we have seen in practice is that the best use case for LLM applications is to streamline a end user&rsquo;s workflow, not to replace the workflow entirely with an automated solution. <em>Think of these applications as intelligent agents or copilots rather than replacements.</em></p><div class="border-t my-12"></div><p>Photo by <a href="https://unsplash.com/photos/graphs-of-performance-analytics-on-a-laptop-screen-JKUTrJ4vK00?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Luke Chesser on Unsplash</a></p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About </span>This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">Accelerate data analysis by leveraging LLMs to build text-to-sql applications</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/prema-roman><img src=img/team/prema-roman.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span class="flex flex-wrap"><a href=/authors/prema-roman class="lg:w-[20ch] mx-2">Prema Roman</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><div class="flex items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span class=text-[#1D65A6]>Recommended</span>
&nbsp;Rotations</h2></div><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:mt-16"><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/starting-simple-with-ai/><img loading=lazy src=/img/blog/2024-05-08-to-llm-or-not-to-llm-that-is-the-question-part-2/cover-photo_hu3708469912556123294.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/llms>LLMs</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ai>AI</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ml>ML</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/data>Data</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/starting-simple-with-ai/ class=block>To LLM or Not to LLM (Part 2): Starting Simple</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">Sick of hearing about hyped up AI solutions that sound like hot air? 🧐 Let&rsquo;s use boring old ML to detect hype in AI marketing text and see why starting with a simple ML approach is still your best bet 90% of the time.</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/butterfly_hu15199609243802860600.webp alt class=rounded-full><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/danielle-maxwell>Danielle Maxwell</a>,&nbsp;</li><li class=font-extralight><a href=/authors/prema-roman>Prema Roman</a></li></ul></div><div class=font-extralight>May 20, 2024</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/responsible-innovation/><img loading=lazy src=/img/blog/2024-05-08-to-llm-or-not-to-llm-that-is-the-question-part-1/elena-mozhvilo-unsplash_hu7164420345709980639.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/llms>LLMs</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ai>AI</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ml>ML</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/data>Data</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/responsible-innovation/ class=block>To LLM or Not to LLM: Tips for Responsible Innovation</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">We&rsquo;re seeing a proliferation of Large Language Models (LLMs) as companies seek to replicate OpenAI&rsquo;s success. In this post, two AI engineers respond to LLM FAQs and offer tips for responsible innovation.</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/butterfly_hu15199609243802860600.webp alt class=rounded-full><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/danielle-maxwell>Danielle Maxwell</a>,&nbsp;</li><li class=font-extralight><a href=/authors/prema-roman>Prema Roman</a></li></ul></div><div class=font-extralight>May 8, 2024</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/how-to-plan-and-scope-llm-projects/><img loading=lazy src=/img/blog/2024-02-01-how-to-plan-and-scope-llm-projects/project-plan_hu2583290299854169669.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ai>AI</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ml>ML</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/llm>LLM</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/strategy>Strategy</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/how-to-plan-and-scope-llm-projects/ class=block>How to Plan and Scope LLM Projects</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">Move over ChatGPT, here come the Large Language Models (LLMs). More and more companies are incorporating LLMs into their operations. Are you ready? Here&rsquo;s the guide to how Rotational plans and scopes our LLM projects.</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/prema-roman_hu6170885996538485670.webp alt class=rounded-full><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/prema-roman>Prema Roman</a></li></ul></div><div class=font-extralight>Feb 1, 2024</div></div></div></li></ul></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start gap-x-2"><input type=checkbox id=checkbox required class="mt-1 w-4 h-4 block border-0">
<label for=checkbox><span>I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><footer class="relative mt-40 md:mt-56 bg-[#192E5B]"><div class="relative w-full pt-36 md:pt-16 lg:pt-24 2xl:pt-20 font-extralight text-white"><div class="-mt-52 w-full mx-auto max-w-screen-xl px-4"><section class="bg-[#72A2C0] w-full p-6 md:py-20 md:px-16"><h2 class="my-4 text-2xl sm:text-3xl md:text-5xl text-white font-extrabold">LET'S ENVISION & BUILD THE FUTURE TOGETHER.</h2><div class=py-6><a href=/contact class="p-3 md:p-4 md:px-6 bg-[#2F4858] font-bold md:text-lg text-white text-center hover:bg-[#2F4858]/80">CONTACT US</a></div></section></div><div class="max-w-7xl mx-auto px-6"><div class="mt-12 flex flex-col md:flex-row lg:justify-between gap-x-8"><div class="my-4 max-w-xs"><h5 class="mb-3 font-extrabold">OUR PRESENCE</h5><p>We share because we care, about topics, tools, and technologies that we believe impact the AI economy.</p><div class=py-4><ul class="flex justify-between items-center gap-x-8"><li><a href=https://twitter.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-x-twitter"></i><p class=sr-only>Twitter</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-linkedin"></i><p class=sr-only>LinkedIn</p></a></li><li><a href=https://github.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-github"></i><p class=sr-only>GitHub</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-youtube"></i><p class=sr-only>YouTube</p></a></li><li><a href=https://www.twitch.tv/rotationallabs target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-twitch"></i><p class=sr-only>Twitch</p></a></li></ul></div></div><div class=my-4><h5 class="mb-3 font-extrabold">COMPANY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/about>About Us</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/case-studies>Case Studies</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/endeavor>Endeavor</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/blog>Blog</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">COMMUNITY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/learning>Learning</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/opensource>Open Source</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">CONTACT US</h5><ul><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-map-marker-alt text-[#757575]"></i>
St. Paul, MN & Washington, DC</li><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-envelope text-[#757575]"></i>
info@rotational.io</li></ul><div class=py-8><a href=/contact class="p-3 bg-[#ECF6FF] font-bold text-black text-center hover:bg-[#ECF6FF]/80">CONTACT US</a></div></div></div><div class="sm:flex justify-between py-6 border-t mt-4"><p>Copyright © Rotational Labs, Inc. 2021–2024 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex gap-x-8"><li><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/24168101.js></script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script><script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script><script src=https://rotational.io/js/blogSingle.js></script></body></html>