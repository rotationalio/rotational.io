<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Using Google's Secret Manager API with Go</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="In this post, we'll dive into Google's Secret Manager service, walk through the setup steps, and explore some Go code to interact with the API."><meta name=author content="Rotational Labs, LLC"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://rotational.io/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://rotational.io/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://rotational.io/plugins/magnific-popup/magnific-popup.css><link rel=stylesheet href=https://rotational.io/plugins/slick/slick.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Anaheim%7cQuattrocento+Sans:400,700&display=swap"><link rel=stylesheet href=https://rotational.io/css/style.min.css media=screen><link rel=stylesheet href=https://rotational.io/css/custom.min.css media=screen><link rel="shortcut icon" href=https://rotational.io/images/assets/icons/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/images/assets/icons/favicon.png type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-2FKX6CWJHW')</script></head><body id=body data-spy=scroll data-target=.navbar data-offset=55><div id=content><section class="sticky-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-dark"><a class="navbar-brand p-0" href=/><img class=lozad data-src=https://rotational.io/images/assets/logos/logo.png alt="Rotational Labs" height=42></a>
<button class="navbar-toggler rounded-0" type=button data-toggle=collapse data-target=#navigation>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://rotational.io/#about>about</a></li><li class=nav-item><a class=nav-link href=https://rotational.io/#services>services</a></li><li class=nav-item><a class=nav-link href=https://rotational.io/#team>team</a></li><li class=nav-item><a class=nav-link href=https://rotational.io/blog>blog</a></li><li class=nav-item><a class=nav-link href=https://rotational.io/#contact>contact</a></li></ul><select id=select-language onchange="location=this.value"><option id=en value=https://rotational.io/blog/secrets-manager-with-go/ selected>En</option><option id=zh value=https://rotational.io/zh/blog/secrets-manager-with-go/>Zh</option></select></div></nav></div></section><section class=section><div class=container><div class=row><div class="col-lg-8 offset-lg-2 text-center"><h1>Using Google's Secret Manager API with Go</h1><ul class="list-inline mb-50"><li class=list-inline-item><a href=/author/rebecca-bilbro/>Rebecca Bilbro</a></li><li class=list-inline-item>Tuesday, Jun 1, 2021</li></ul><img class="img-fluid mb-50 lozad" data-src=https://rotational.io/images/media/2021-06-01-secrets-manager-with-go/doorknocker.jpg alt=blog-image></div><div class="col-lg-8 offset-lg-2"><div class=post-single-content><p>Security is by definition an inconvenience. At the very least, it&rsquo;s about making access to data as challenging as possible for the baddies, conveniently measured in computation time. But good security also requires us good folks to go above and beyond — adopting architectural and engineering practices that involve more forethought, more effort, and more testing than are strictly required to get a basic application running on the web. If you&rsquo;re here already, we don&rsquo;t need to convince you that the effort is well worth it; good security pays for itself in customer trust, not to mention helping to preclude the kinds of breaches that can get careless folks in hot water. In this post, we&rsquo;ll dive into Google&rsquo;s Secret Manager service, walk through the setup steps, and explore some Go code to interact with the API.</p><p>The example code can be found at: <a href=https://github.com/rotationalio/knock>github.com/rotationalio/knock</a>.</p><h2 id=what-is-google-secret-manager>What is Google Secret Manager?</h2><p><a href=https://cloud.google.com/secret-manager>Google Secret Manager</a> is a hosted service that allows users to store, manage, and access secure information. Information stored in Secret Manager is encrypted by default, and can only be accessed by an application if it has been granted valid credentials. Access can be granted (and revoked) on a very granular level, meaning that you can give out <a href=https://cloud.google.com/secret-manager/docs/access-control>role-based permissions</a> for individual secrets using the <a href=https://cloud.google.com/secret-manager/docs/access-control#least-privilege>principle of least privilege</a>.</p><p>One big advantage of the Secret Manager implementation is its flexibility in terms of what can be stored. &ldquo;Secrets&rdquo; can be text or arbitrary bytes (well, almost; there is a <a href=https://cloud.google.com/secret-manager/quotas>64KiB limit</a>); meaning they can be passwords, API keys, or certificates.</p><p>Secrets are stored using a namespace-like convention, where the key that references the payload value takes the form of a path, e.g.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>projects/projectID/secrets/exampleSecret
</code></pre></div><p>Rather than storing encrypted payload data on the secret itself, Secret Manager exposes <code>versions</code> that store the actual secret data. When retrieving payloads, you retrieve them from the version, which is immutable, e.g.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>projects/projectID/secrets/exampleSecret/versions/2
</code></pre></div><h2 id=getting-started-with-google-secret-manager>Getting Started with Google Secret Manager</h2><p>The setup requires you to navigate between the Google Console UI and the command line.</p><ul><li>First, <a href=https://cloud.google.com/sdk/docs/install>download and install the SDK</a> that matches your os, and make sure to add it to your <code>PATH</code>.</li><li>Next, navigate to the Console UI and <a href=https://cloud.google.com/secret-manager/docs/configuring-secret-manager>configure</a> your Google Cloud project to use Secret Manager. You&rsquo;ll use the UI to do both of the following:<ul><li>create a new project (e.g. in this example, we&rsquo;ll use &ldquo;knock-knock&rdquo;)</li><li>enable the Google Secrets API (via the <a href=https://console.cloud.google.com/apis/dashboard>API Console</a>) for that project</li></ul></li><li>Now, return to the command line and run <code>gcloud init</code> to authenticate. This will open a browser window, where you&rsquo;ll select the correct gcloud account. Back on the command line, select the new project you just made.</li><li>Next we&rsquo;ll assign IAM privileges. Using the Google Console UI, navigate to the <a href=https://console.cloud.google.com/iam-admin/iam>IAM page</a>, select the correct project, and select your name from the members list. You&rsquo;ll need to add a role, e.g. &ldquo;Secret Manager Secret Version Manager&rdquo;, that will allow you to create and manage secrets.</li><li>Now, back in the command line, we&rsquo;ll make a Service Account, which will generate a local JSON file containing the service account credentials for a hypothetical user named Jeeves.<div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gcloud iam service-accounts create jeeves
gcloud projects add-iam-policy-binding knock-knock --member=<span style=color:#ed9d13>&#34;serviceAccount:jeeves@knock-knock.iam.gserviceaccount.com&#34;</span> --role=<span style=color:#ed9d13>&#34;roles/secretmanager.secretVersionManager&#34;</span>
gcloud iam service-accounts keys create knock.json --iam-account=jeeves@knock-knock.iam.gserviceaccount.com
</code></pre></div></li><li>Next we&rsquo;ll add the path to those credentials to our PATH so that we can access them as environment variables; let&rsquo;s also add the project name as an environment variable.<div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#24909d>export</span> <span style=color:#40ffff>GOOGLE_APPLICATION_CREDENTIALS</span>=<span style=color:#ed9d13>&#34;/home/user/knock.json&#34;</span>
<span style=color:#24909d>export</span> <span style=color:#40ffff>GOOGLE_PROJECT_NAME</span>=<span style=color:#ed9d13>&#34;knock-knock&#34;</span>
</code></pre></div></li></ul><p>Ok, now we&rsquo;re ready to start creating secrets!</p><h2 id=interacting-with-the-secret-manager-api-in-go>Interacting with the Secret Manager API in Go</h2><p>There are a few good tutorials for interacting with the Secret Manager using languages like <a href=https://codelabs.developers.google.com/codelabs/secret-manager-python#0>Python</a> and <a href=https://github.com/googleapis/nodejs-secret-manager/tree/master/samples>Node</a>. Since there&rsquo;s not much available that demonstrates Golang examples, this post will focus on Go.</p><p>The example implementation can be seen in full <a href=https://github.com/rotationalio/knock>here</a>; it takes the following imports:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#6ab825;font-weight:700>import</span> (
	<span style=color:#ed9d13>&#34;context&#34;</span>
	<span style=color:#ed9d13>&#34;errors&#34;</span>
	<span style=color:#ed9d13>&#34;fmt&#34;</span>

	secretmanager <span style=color:#ed9d13>&#34;cloud.google.com/go/secretmanager/apiv1&#34;</span>
	<span style=color:#ed9d13>&#34;google.golang.org/api/iterator&#34;</span>
	secretmanagerpb <span style=color:#ed9d13>&#34;google.golang.org/genproto/googleapis/cloud/secretmanager/v1&#34;</span>
)
</code></pre></div><h3 id=create-a-new-secret>Create a New Secret</h3><p>First let&rsquo;s write a function to create a new secret. This function will take as input two parameters:</p><ul><li>a <code>parent</code>, which should be a string path, e.g. &ldquo;projects/project-name&rdquo;.</li><li>a <code>secretID</code>, which should be a string name to uniquely refer to the secret (though not the same as the key for the payload; that will come later when we create a secret version).</li></ul><p>Our function will return a string representation of the path where the new secret is stored, e.g &ldquo;projects/projectID/secrets/secretID&rdquo;, and an error if any occurs.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#999;font-style:italic>// CreateSecret creates a new secret in the Google Cloud Manager top-
</span><span style=color:#999;font-style:italic>// level directory, specified as `parent`, using the `secretID` provided
</span><span style=color:#999;font-style:italic>// as the name.
</span><span style=color:#999;font-style:italic></span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>CreateSecret</span>(parent <span style=color:#6ab825;font-weight:700>string</span>, secretID <span style=color:#6ab825;font-weight:700>string</span>) (<span style=color:#6ab825;font-weight:700>string</span>, <span style=color:#6ab825;font-weight:700>error</span>) {

	<span style=color:#999;font-style:italic>// Create the client.
</span><span style=color:#999;font-style:italic></span>	ctx := context.<span style=color:#447fcf>Background</span>()
	client, err := secretmanager.<span style=color:#447fcf>NewClient</span>(ctx)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#999;font-style:italic>// The most likely causes of the error are:
</span><span style=color:#999;font-style:italic></span>		<span style=color:#999;font-style:italic>//     1 - google application creds failed
</span><span style=color:#999;font-style:italic></span>		<span style=color:#999;font-style:italic>//     2 - secret already exists
</span><span style=color:#999;font-style:italic></span>		<span style=color:#6ab825;font-weight:700>return</span> <span style=color:#ed9d13>&#34;&#34;</span>, fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to create secretmanager client: %v&#34;</span>, err)
	}
	<span style=color:#6ab825;font-weight:700>defer</span> client.<span style=color:#447fcf>Close</span>()

	<span style=color:#999;font-style:italic>// Build the request.
</span><span style=color:#999;font-style:italic></span>	req := &amp;secretmanagerpb.CreateSecretRequest{
		Parent:   parent,
		SecretId: secretID,
		Secret: &amp;secretmanagerpb.Secret{
			Replication: &amp;secretmanagerpb.Replication{
				Replication: &amp;secretmanagerpb.Replication_Automatic_{
					Automatic: &amp;secretmanagerpb.Replication_Automatic{},
				},
			},
		},
	}

	<span style=color:#999;font-style:italic>// Call the API.
</span><span style=color:#999;font-style:italic></span>	result, err := client.<span style=color:#447fcf>CreateSecret</span>(ctx, req)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> <span style=color:#ed9d13>&#34;&#34;</span>, fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to create secret: %v&#34;</span>, err)
	}
	fmt.<span style=color:#447fcf>Printf</span>(<span style=color:#ed9d13>&#34;created secret: %s\n&#34;</span>, result.Name)
	<span style=color:#6ab825;font-weight:700>return</span> result.Name, <span style=color:#6ab825;font-weight:700>nil</span>
}
</code></pre></div><h3 id=add-a-new-secret-version>Add a New Secret Version</h3><p>To store a payload, we need to create a version inside the secret namespace we&rsquo;ve just created. Let&rsquo;s write a new function for creating versions that takes as input the full path to the secret, e.g. &ldquo;projects/projectID/secrets/secretID&rdquo; and the payload as a slice of bytes. It will return the path to the secret version, e.g. &ldquo;projects/projectID/secrets/secretID/versions/1&rdquo; and an error if one occurs.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#999;font-style:italic>// AddSecretVersion adds a new secret version to the given secret path with the
</span><span style=color:#999;font-style:italic>// provided payload.
</span><span style=color:#999;font-style:italic></span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>AddSecretVersion</span>(path <span style=color:#6ab825;font-weight:700>string</span>, payload []<span style=color:#6ab825;font-weight:700>byte</span>) (<span style=color:#6ab825;font-weight:700>string</span>, <span style=color:#6ab825;font-weight:700>error</span>) {

	<span style=color:#999;font-style:italic>// Create the client.
</span><span style=color:#999;font-style:italic></span>	ctx := context.<span style=color:#447fcf>Background</span>()
	client, err := secretmanager.<span style=color:#447fcf>NewClient</span>(ctx)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> <span style=color:#ed9d13>&#34;&#34;</span>, fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to create secretmanager client: %v&#34;</span>, err)
	}
	<span style=color:#6ab825;font-weight:700>defer</span> client.<span style=color:#447fcf>Close</span>()

	<span style=color:#999;font-style:italic>// Build the request.
</span><span style=color:#999;font-style:italic></span>	req := &amp;secretmanagerpb.AddSecretVersionRequest{
		Parent: path,
		Payload: &amp;secretmanagerpb.SecretPayload{
			Data: payload,
		},
	}

	<span style=color:#999;font-style:italic>// Call the API.
</span><span style=color:#999;font-style:italic></span>	result, err := client.<span style=color:#447fcf>AddSecretVersion</span>(ctx, req)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> <span style=color:#ed9d13>&#34;&#34;</span>, fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to add secret version: %v&#34;</span>, err)
	}

	fmt.<span style=color:#447fcf>Printf</span>(<span style=color:#ed9d13>&#34;added secret version: %s\n&#34;</span>, result.Name)
	<span style=color:#6ab825;font-weight:700>return</span> result.Name, <span style=color:#6ab825;font-weight:700>nil</span>
}
</code></pre></div><h3 id=access-an-existing-secret>Access an Existing Secret</h3><p>To access a secret version, we need the full path to the secret version, which can reference the version number as a string (e.g. &ldquo;5&rdquo;) or an alias (e.g. &ldquo;latest&rdquo;), i.e. &ldquo;projects/projectID/secrets/secretID/versions/latest&rdquo; or &ldquo;projects/projectID/secrets/secretID/versions/5&rdquo;.</p><p>Our <code>AccessSecretVersion</code> will use this path to return the payload, else an error:</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#999;font-style:italic>// AccessSecretVersion returns the payload for the given secret version if one
</span><span style=color:#999;font-style:italic>// exists.
</span><span style=color:#999;font-style:italic></span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>AccessSecretVersion</span>(version <span style=color:#6ab825;font-weight:700>string</span>) ([]<span style=color:#6ab825;font-weight:700>byte</span>, <span style=color:#6ab825;font-weight:700>error</span>) {

	<span style=color:#999;font-style:italic>// Create the client.
</span><span style=color:#999;font-style:italic></span>	ctx := context.<span style=color:#447fcf>Background</span>()
	client, err := secretmanager.<span style=color:#447fcf>NewClient</span>(ctx)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>, fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to create secretmanager client: %v&#34;</span>, err)
	}
	<span style=color:#6ab825;font-weight:700>defer</span> client.<span style=color:#447fcf>Close</span>()

	<span style=color:#999;font-style:italic>// Build the request.
</span><span style=color:#999;font-style:italic></span>	req := &amp;secretmanagerpb.AccessSecretVersionRequest{
		Name: version,
	}

	<span style=color:#999;font-style:italic>// Call the API.
</span><span style=color:#999;font-style:italic></span>	result, err := client.<span style=color:#447fcf>AccessSecretVersion</span>(ctx, req)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>, fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to access secret version: %v&#34;</span>, err)
	}

	fmt.<span style=color:#447fcf>Printf</span>(<span style=color:#ed9d13>&#34;retrieved payload for: %s\n&#34;</span>, result.Name)
	<span style=color:#6ab825;font-weight:700>return</span> result.Payload.Data, <span style=color:#6ab825;font-weight:700>nil</span>
}
</code></pre></div><h3 id=get-all-secrets>Get All Secrets</h3><p>If you try to add a secret to a project when that secret already exists, you&rsquo;ll get an error. For that reason, it will be useful to list out the secrets (again, these are the namespace keys, not the actual versions that store the encrypted payload). Our <code>ListSecrets</code> function will take as input the path to the <code>parent</code>, e.g. &ldquo;projects/my-project&rdquo;, and returns a slice of strings representing the paths to the retrieved secrets, and a matching slice of errors for each failed retrieval.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#999;font-style:italic>// ListSecrets retrieves the names of all secrets in the project,
</span><span style=color:#999;font-style:italic>// given the `parent` (string).
</span><span style=color:#999;font-style:italic></span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>ListSecrets</span>(parent <span style=color:#6ab825;font-weight:700>string</span>) (secrets []<span style=color:#6ab825;font-weight:700>string</span>, errors []<span style=color:#6ab825;font-weight:700>error</span>) {

	<span style=color:#999;font-style:italic>// Create the client.
</span><span style=color:#999;font-style:italic></span>	ctx := context.<span style=color:#447fcf>Background</span>()
	client, err := secretmanager.<span style=color:#447fcf>NewClient</span>(ctx)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> secrets, <span style=color:#24909d>append</span>(errors, err)
	}
	<span style=color:#6ab825;font-weight:700>defer</span> client.<span style=color:#447fcf>Close</span>()

	<span style=color:#999;font-style:italic>// Build the request.
</span><span style=color:#999;font-style:italic></span>	req := &amp;secretmanagerpb.ListSecretsRequest{
		Parent: parent,
	}

	<span style=color:#999;font-style:italic>// Call the API.
</span><span style=color:#999;font-style:italic></span>	it := client.<span style=color:#447fcf>ListSecrets</span>(ctx, req)

	<span style=color:#6ab825;font-weight:700>for</span> {
		resp, err := it.<span style=color:#447fcf>Next</span>()
		<span style=color:#6ab825;font-weight:700>if</span> err == iterator.Done {
			<span style=color:#6ab825;font-weight:700>break</span>
		}

		<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
			errors = <span style=color:#24909d>append</span>(errors, err)
			secrets = <span style=color:#24909d>append</span>(secrets, <span style=color:#ed9d13>&#34;&#34;</span>)
			<span style=color:#6ab825;font-weight:700>continue</span>
		}
		secrets = <span style=color:#24909d>append</span>(secrets, resp.Name)
		errors = <span style=color:#24909d>append</span>(errors, <span style=color:#6ab825;font-weight:700>nil</span>)
	}
	<span style=color:#6ab825;font-weight:700>return</span> secrets, errors
}
</code></pre></div><h3 id=delete-a-secret>Delete a Secret</h3><p>Secrets can be configured to automatically expire after a certain amount of time (<a href=https://github.com/rotationalio/knock/blob/main/knock.go#L58-L72>example here</a>), but you can also delete them explicitly (assuming your <a href=https://cloud.google.com/secret-manager/docs/access-control>role permissions</a> allow you delete access). Note that deletion is irreversible, and deleting a secret will delete all of the versions inside the namespace for that secret. Any service or workload that attempts to access a deleted secret receives a Not Found error.</p><p>Here&rsquo;s an example function that deletes a secret given the path to the secret, e.g. &ldquo;projects/projectID/secrets/secretID&rdquo;.</p><div class=highlight><pre style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#999;font-style:italic>// DeleteSecret deletes the secret with the given `name`, and all of its versions.
</span><span style=color:#999;font-style:italic></span><span style=color:#6ab825;font-weight:700>func</span> <span style=color:#447fcf>DeleteSecret</span>(name <span style=color:#6ab825;font-weight:700>string</span>) <span style=color:#6ab825;font-weight:700>error</span> {

	<span style=color:#999;font-style:italic>// Create the client.
</span><span style=color:#999;font-style:italic></span>	ctx := context.<span style=color:#447fcf>Background</span>()
	client, err := secretmanager.<span style=color:#447fcf>NewClient</span>(ctx)
	<span style=color:#6ab825;font-weight:700>if</span> err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to create secretmanager client: %v&#34;</span>, err)
	}
	<span style=color:#6ab825;font-weight:700>defer</span> client.<span style=color:#447fcf>Close</span>()

	<span style=color:#999;font-style:italic>// Build the request.
</span><span style=color:#999;font-style:italic></span>	req := &amp;secretmanagerpb.DeleteSecretRequest{
		Name: name,
	}

	<span style=color:#999;font-style:italic>// Call the API.
</span><span style=color:#999;font-style:italic></span>	<span style=color:#6ab825;font-weight:700>if</span> err := client.<span style=color:#447fcf>DeleteSecret</span>(ctx, req); err != <span style=color:#6ab825;font-weight:700>nil</span> {
		<span style=color:#6ab825;font-weight:700>return</span> fmt.<span style=color:#447fcf>Errorf</span>(<span style=color:#ed9d13>&#34;failed to delete secret: %v&#34;</span>, err)
	}
	<span style=color:#6ab825;font-weight:700>return</span> <span style=color:#6ab825;font-weight:700>nil</span>
}
</code></pre></div><p>With the ability to create, list, and delete secrets, and to add and access versions we&rsquo;re getting close to a complete Golang implementation that would allow you to systematically interact with the Secret Manager API from an application!</p><h2 id=conclusion>Conclusion</h2><p>The everyday systems we interact with increasingly store our private data, so the need to raise the bar on data encryption has never been stronger. The flexibility of tools like the Google Secret Manager API means that we can and should be securing all kinds of information; not just passwords and credentials, but other types of information such as personally identifiable information (PII), as well.</p><p>When it comes to security in big data systems, it&rsquo;s not about <em>if</em> there will be a breach, but <em>when</em>. Prevention methods become out-of-date as soon as new attack vectors are devised, and there are no silver bullets. That&rsquo;s why security is (and should be!) hard. Thankfully, as we&rsquo;ve seen in this post, with tools like Secret Manager, and its IAM controls, default encryption, and developer API, building software with a security-first principle can become more straightforward and programmatic.</p><h2 id=further-reading>Further Reading</h2><ul><li><a href=https://cloud.google.com/sdk/docs/install>Installing Google Cloud SDK</a></li><li><a href=https://cloud.google.com/sdk/docs/initializing>Initializing Cloud SDK</a></li><li><a href=https://cloud.google.com/docs/authentication/production>Authenticating as a service account</a></li><li><a href=https://cloud.google.com/docs/authentication/production#create_service_account>Creating a service account</a></li><li><a href=https://cloud.google.com/secret-manager/docs/creating-and-accessing-secrets>Creating and Accessing Secrets</a></li><li><a href=https://codelabs.developers.google.com/codelabs/secret-manager-python#0>Using Secret Manager with Python by Katie McLaughlin</a></li><li><a href=https://github.com/googleapis/nodejs-secret-manager>NodeJS Secret Manager</a></li><li><a href=https://github.com/kioie/gsm>A Go GCP Secret Manager by kioie</a></li></ul></div><div class="social-share pt-4"><h4>Share:</h4><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frotational.io%2fblog%2fsecrets-manager-with-go%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=Using%20Google%27s%20Secret%20Manager%20API%20with%20Go&url=https%3a%2f%2frotational.io%2fblog%2fsecrets-manager-with-go%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5.0-4.55 2.04-4.55 4.54.0.36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3.0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35.0 12.92-6.92 12.92-12.93.0-.2.0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://plus.google.com/share?url=https%3a%2f%2frotational.io%2fblog%2fsecrets-manager-with-go%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.37 12.93c-.73-.52-1.4-1.27-1.4-1.5.0-.43.03-.63.98-1.37 1.23-.97 1.9-2.23 1.9-3.57.0-1.22-.36-2.3-1-3.05h.5c.1.0.2-.04.28-.1l1.36-.98c.16-.12.23-.34.17-.54-.07-.2-.25-.33-.46-.33H7.6c-.66.0-1.34.12-2 .35-2.23.76-3.78 2.66-3.78 4.6.0 2.76 2.13 4.85 5 4.9-.07.23-.1.45-.1.66.0.43.1.83.33 1.22h-.08c-2.72.0-5.17 1.34-6.1 3.32-.25.52-.37 1.04-.37 1.56.0.5.13.98.38 1.44.6 1.04 1.84 1.86 3.55 2.28.87.23 1.82.34 2.8.34.88.0 1.7-.1 2.5-.34 2.4-.7 3.97-2.48 3.97-4.54.0-1.97-.63-3.15-2.33-4.35zm-7.7 4.5c0-1.42 1.8-2.68 3.9-2.68h.05c.45.0.9.07 1.3.2l.42.28c.96.66 1.6 1.1 1.77 1.8.05.16.07.33.07.5.0 1.8-1.33 2.7-3.96 2.7-1.98.0-3.54-1.23-3.54-2.8zM5.54 3.9c.33-.38.75-.58 1.23-.58h.05c1.35.05 2.64 1.55 2.88 3.35.14 1.02-.08 1.97-.6 2.55-.32.37-.74.56-1.23.56h-.03c-1.32-.04-2.63-1.6-2.87-3.4-.13-1 .08-1.92.58-2.5zM23.5 9.5h-3v-3h-2v3h-3v2h3v3h2v-3h3"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=Using%20Google%27s%20Secret%20Manager%20API%20with%20Go&body=https%3a%2f%2frotational.io%2fblog%2fsecrets-manager-with-go%2f" target=_self rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2frotational.io%2fblog%2fsecrets-manager-with-go%2f&resubmit=true&title=Using%20Google%27s%20Secret%20Manager%20API%20with%20Go" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96.0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65.0 3-1.35 3-3s-1.35-3-3-3c-1.38.0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65.0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66.0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64.0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4.0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6.0.23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1.0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1.0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=Using%20Google%27s%20Secret%20Manager%20API%20with%20Go%20https%3a%2f%2frotational.io%2fblog%2fsecrets-manager-with-go%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.1 3.9C17.9 1.7 15 .5 12 .5 5.8.5.7 5.6.7 11.9c0 2 .5 3.9 1.5 5.6L.6 23.4l6-1.6c1.6.9 3.5 1.3 5.4 1.3 6.3.0 11.4-5.1 11.4-11.4-.1-2.8-1.2-5.7-3.3-7.8zM12 21.4c-1.7.0-3.3-.5-4.8-1.3l-.4-.2-3.5 1 1-3.4L4 17c-1-1.5-1.4-3.2-1.4-5.1.0-5.2 4.2-9.4 9.4-9.4 2.5.0 4.9 1 6.7 2.8s2.8 4.2 2.8 6.7c-.1 5.2-4.3 9.4-9.5 9.4zm5.1-7.1c-.3-.1-1.7-.9-1.9-1-.3-.1-.5-.1-.7.1-.2.3-.8 1-.9 1.1-.2.2-.3.2-.6.1s-1.2-.5-2.3-1.4c-.9-.8-1.4-1.7-1.6-2s0-.5.1-.6.3-.3.4-.5c.2-.1.3-.3.4-.5s0-.4.0-.5C10 9 9.3 7.6 9 7c-.1-.4-.4-.3-.5-.3h-.6s-.4.1-.7.3c-.3.3-1 1-1 2.4s1 2.8 1.1 3c.1.2 2 3.1 4.9 4.3.7.3 1.2.5 1.6.6.7.2 1.3.2 1.8.1.6-.1 1.7-.7 1.9-1.3.2-.7.2-1.2.2-1.3-.1-.3-.3-.4-.6-.5z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=Using%20Google%27s%20Secret%20Manager%20API%20with%20Go&url=https%3a%2f%2frotational.io%2fblog%2fsecrets-manager-with-go%2f" target=_blank rel=noopener aria-label><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M.707 8.475C.275 8.64.0 9.508.0 9.508s.284.867.718 1.03l5.09 1.897 1.986 6.38a1.102 1.102.0 001.75.527l2.96-2.41a.405.405.0 01.494-.013l5.34 3.87a1.1 1.1.0 001.046.135 1.1 1.1.0 00.682-.803l3.91-18.795A1.102 1.102.0 0022.5.075L.706 8.475z"/></svg></div></div></a></div><div class=mt-5></div></div></div></div></section></div><footer id=footer class=section-bg><div class=container><div class="row wow fadeInUp" data-wow-duration=500ms><div class=col-xl-12><div class=social-icon><ul class=list-inline><li class=list-inline-item><a href=https://twitter.com/rotationalio><i class=ti-twitter-alt></i></a></li><li class=list-inline-item><a href=https://github.com/rotational.io><i class=ti-github></i></a></li><li class=list-inline-item><a href=https://www.linkedin.com/company/rotational/><i class=ti-linkedin></i></a></li></ul></div><div class="copyright text-center"><a href=https://rotational.io/><img src=https://rotational.io/images/assets/logos/logo.png alt="Rotational Labs" height=42></a><br><p>Copyright © 2021 Rotational Labs, LLC, All Rights Reserved</p></div></div></div></div></footer><script src=https://rotational.io/plugins/jquery/jquery.min.js></script><script src=https://rotational.io/plugins/bootstrap/bootstrap.min.js></script><script src=https://rotational.io/plugins/slick/slick.min.js></script><script src=https://rotational.io/plugins/shuffle/shuffle.min.js></script><script src=https://rotational.io/plugins/magnific-popup/jquery.magnific-popup.min.js></script><script src=https://rotational.io/plugins/lazy-load/lozad.min.js></script><script src=https://rotational.io/plugins/google-map/map.js></script><script src=https://rotational.io/js/script.min.5db5ae6f88052715e823d7c52f3fa7a832565352b0f76c1d2cee2a3b564a0716fa9d51878a9965389c3d856f2d7c6330.js integrity=sha384-XbWub4gFJxXoI9fFLz+nqDJWU1Kw92wdLO4qO1ZKBxb6nVGHipllOJw9hW8tfGMw></script></body></html>