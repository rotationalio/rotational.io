<!doctype html><html lang=en-us><head><meta charset=UTF-8><title>Rotational Labs | Building Real-Time Apps in Python with Ensign and Streamlit</title>
<base href=https://rotational.io/ target=_self><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="If you want to build data web applications but have struggled with HTML and Javascript, Ensign and Streamlit is a powerful combination of tools that enable you to build an application in minutes!"><meta name=keywords content="AI solutions for mid-market companies,AI-driven tools,Business automation solutions,AI-powered interfaces,Intelligent agents,Natural language processing (NLP),Computer vision AI,Streamline operations with AI,machine learning,Boost business performance with AI,AI for business growth,Tailored AI solutions,Trusted AI solutions,AI for operational efficiency,Secure AI tools,AI expertise for mid-market businesses,Endeavor"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="Building Real-Time Apps in Python with Ensign and Streamlit"><meta property="og:description" content="If you want to build data web applications but have struggled with HTML and Javascript, Ensign and Streamlit is a powerful combination of tools that enable you to build an application in minutes!"><meta property="og:image" content="https://rotational.io/img/blog/2023-11-22-ensign-streamlit/stock-price.jpg"><meta property="og:url" content="https://rotational.io/blog/ensign-streamlit/"><meta property="og:type" content="website"><meta name=twitter:title content="Building Real-Time Apps in Python with Ensign and Streamlit"><meta name=twitter:card content="summary"><meta name=twitter:description content="If you want to build data web applications but have struggled with HTML and Javascript, Ensign and Streamlit is a powerful combination of tools that enable you to build an application in minutes!"><meta name=twitter:image content="https://rotational.io/img/blog/2023-11-22-ensign-streamlit/stock-price.jpg"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW" defer></script><script type=module>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-2FKX6CWJHW');
</script><script src=https://kit.fontawesome.com/fea17a4e21.js crossorigin=anonymous></script></head><body><div class="relative bg-[#1D65A6]"><nav class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-5" aria-label=Global><div class="relative max-w-7xl w-full flex flex-wrap lg:flex-nowrap items-center justify-between mx-auto"><a href=/><img src=/img/rototational-white-text-only_hu15583614935666962927.webp alt=Rotational class="h-6 w-auto">
</a><button data-collapse-toggle=navbar-dropdown type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls=navbar-dropdown aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="fa fa-bars text-xl text-white"></i></button><div class="hidden absolute z-[9999] lg:static top-16 w-[92%] md:w-[96%] lg:w-auto lg:block bg-white lg:bg-transparent text-[#192E5B] lg:text-[#F2F2F2] py-2 rounded-md" id=navbar-dropdown><ul class="flex flex-col lg:gap-2 xl:gap-4 md:flex-row font-semibold w-full md:justify-between"><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/about/>About</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><button id=dropdownNavbarLink data-dropdown-toggle=dropdownNavbar class="uppercase flex items-center justify-between gap-x-2 w-full px-3 rounded md:border-0 md:p-0 md:w-auto hover:text-black">
Services
<i class="fa fa-angle-down pt-1"></i></button><div id=dropdownNavbar class="z-10 hidden font-normal bg-[#192E5B] divide-y divide-[#192E5B] rounded-lg shadow w-44"><ul class="py-2 text-sm text-[#F2F2F2]" aria-labelledby=dropdownLargeButton><li><a href=/services/ai-assessments/ class="block px-3 py-2 hover:font-bold">AI Assessments</a></li><li><a href=/services/ai-product-development/ class="block px-3 py-2 hover:font-bold">AI Product Development</a></li><li><a href=/services/ai-ops-and-data-foundations/ class="block px-3 py-2 hover:font-bold">AI Ops & Data Foundations</a></li></ul></div></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/case-studies>Case Studies</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/blog/>Blog</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/learning/>Learning</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/endeavor/>Product</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/contact/>Contact</a></li></ul></div></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=/img/blog/2023-11-22-ensign-streamlit/stock-price_hu8640006429266123094.webp alt="Building Real-Time Apps in Python with Ensign and Streamlit" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="Building Real-Time Apps in Python with Ensign and Streamlit"><b class=text-[#1D65A6]>Building </b>Real-Time Apps in Python with Ensign and Streamlit</h3><div class="flex flex-wrap justify-center items-center my-4"><a href=/authors/prema-roman><img src=img/team/prema-roman.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span><a href=/authors/prema-roman>Prema Roman</a> | Monday, Nov 20, 2023 |&nbsp;
</span><span><a href=/tags/python>Python</a>,&nbsp;
</span><a href=/tags/data>Data</a></span></div><article class="max-w-[800px] mx-auto prose"><p>Python may be the 2nd best language for everything, but it&rsquo;s a favorite of data scientists worldwide, and delivers a world of functionality. Did you know you can even build customer-facing AI/ML apps with Python now? Learn how&mldr;</p><p>In this post we&rsquo;ll see how to combine the streaming database <a href=https://rotational.io/ensign/>Ensign</a> with the new Python library <a href=https://streamlit.io>Streamlit</a> to build customer-facing, interactive, data-intensive applications easier than ever, with no Javascript or database experience required.</p><p>Just here for the code? Check out this <a href=https://github.com/rotationalio/ensign-examples/blob/main/python/stock_market_trades>repo</a> for the full example.</p><h2 id=tools-should-let-you-do-what-you-do-best>Tools Should Let You Do What <em>You</em> Do Best</h2><p>There&rsquo;s a lot to learn when you decide to become a data scientist — from data ingestion to wrangling to modeling and evaluation, and a host of &ldquo;data science 2.0&rdquo; tasks related to application development, such as containerization and orchestration, MLOps, and observability.</p><p>It can be overwhelming.</p><p>The only way to stay afloat is to identify tasks you can delegate, whether to another teammate (less and less likely these days, with the recent tech layoffs 😢) or to some tool or managed solution (as long as it doesn&rsquo;t break the budget). If you&rsquo;re on a small, scrappy team and you know Python, here are two tools you can&rsquo;t afford to ignore:</p><ol><li><a href=https://ensign.rotational.dev/>Ensign</a> is a database purpose-built for creating real-time data applications without the need for devOps experience.</li><li><a href=https://streamlit.io>Streamlit</a> is a Python library that enables you to build data-intensive web applications without the need to learn HTML and Javascript.</li></ol><p>The end result? We data scientists can focus on what <strong>we</strong> do best: working with data to deliver insights and stimulate growth.</p><h2 id=getting-started>Getting Started</h2><p>In this tutorial we&rsquo;ll start small by building a simple stock market chart that displays prices in real-time. You can then expand on this tutorial to perform more complex data transformations and analytics, and build more sophisticated dashboards.</p><h3 id=step-1-get-an-api-key-from-finnhub>Step 1: Get an API Key from Finnhub</h3><p>First, you will need to get a Finnhub API key from <a href=https://finnhub.io>FinnHub</a>. Finnhub provides RESTful APIs and websocket for stocks, currency, and crypto. Once you have your Finnhub key, add it as an environment variable as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export FINNHUB_API_KEY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your key here&#34;</span>
</span></span></code></pre></div><h3 id=step-2-create-a-free-ensign-account>Step 2: Create a free Ensign account</h3><p>Create a free Ensign account at <a href=https://rotational.app>rotational.app</a>. Check out this step-by-step <a href=https://rotational.io/blog/pubsub-101---creating-your-project/>tutorial</a> on how to set it up. At the end of the tutorial, you will have downloaded your Ensign API keys, which you will also need to add as environment variables.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export ENSIGN_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your client id here&#34;</span>
</span></span><span style=display:flex><span>export ENSIGN_CLIENT_SECRET<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your client secret here&#34;</span>
</span></span></code></pre></div><h3 id=step-3-create-and-activate-a-virtual-environment>Step 3: Create and activate a virtual environment</h3><p>Run the following on the command line to create a fresh new Python virtual environment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virtualenv venv
</span></span><span style=display:flex><span>source venv/bin/activate
</span></span></code></pre></div><h3 id=step-4-install-the-requirements>Step 4: Install the requirements</h3><p>In order to run the code, the following Python libraries are required:</p><ul><li><code>websockets</code>: Used to connect to the FinnHub API</li><li><code>streamlit</code>: Used to build the web application</li><li><code>pyensign</code>: The Python SDK to interact with Ensign</li><li><code>plotly</code>: Used to create the real-time line chart</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install -r requirements.txt
</span></span></code></pre></div><h2 id=working-with-ensign>Working with Ensign</h2><p>The idea behind working with Ensign is as follows:</p><ul><li>You write code that <strong>publishes</strong> data to a topic. This is the equivalent of the data engineer&rsquo;s task of creating an ETL job that pulls data from an API and inserts it into a table.</li><li>You write code that <strong>subscribes</strong> to the same topic. If you are a data analyst or a data scientist, this is the equivalent of querying a table to get the data that you need for your analytics or machine learning project.</li></ul><p>The Ensign database provides some powerful advantages:</p><ul><li>There is no need to define a schema ahead of time like you need to in a relational database.</li><li>You can store data in many common formats such as CSV, JSON, Avro, and Parquet. You can even store Pickles, which gives you the ability to version control models with ease!</li><li>You can perform real-time analytics - and it is easier than you think!</li><li>There is no custom tooling required. Once you set up an Ensign account and download your API keys, you can install and use <code>pyensign</code> just like you would any standard Python library to write and run your code.</li></ul><h2 id=building-the-application>Building the application</h2><p>The application consists of two major components:</p><ul><li>The publisher code that uses the websockets library to ingest stock market prices from FinnHub and publish the price data into the Ensign database.</li><li>The subscriber code that retrieves the stock market price data from the Ensign database and updates a chart in real-time in a web application built using Streamlit.</li></ul><h3 id=global-variables>Global variables</h3><p>We will create the following global variables:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># The topic that will store the stock price data</span>
</span></span><span style=display:flex><span>TOPIC <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;trades&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The Ensign client -- used to connect to the</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ensign server to publish and subscribe to topics</span>
</span></span><span style=display:flex><span>ENSIGN <span style=color:#f92672>=</span> Ensign()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># List of symbols for which we will collect prices</span>
</span></span><span style=display:flex><span>SYMBOLS <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;AAPL&#34;</span>, <span style=color:#e6db74>&#34;META&#34;</span>, <span style=color:#e6db74>&#34;NFLX&#34;</span>, <span style=color:#e6db74>&#34;AMZN&#34;</span>, <span style=color:#e6db74>&#34;GOOGL&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># A pandas dataframe that will be used to generate the line chart</span>
</span></span><span style=display:flex><span>DF <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;symbol&#34;</span>, <span style=color:#e6db74>&#34;time&#34;</span>, <span style=color:#e6db74>&#34;price&#34;</span>])
</span></span></code></pre></div><h3 id=create-the-publisher>Create the publisher</h3><p>As you can see below, with just a few lines of code, you can set up a websocket connection to the FinnHub API to receive stock market prices that you encode as JSON before publishing to the <code>trades</code> topic.</p><p>The <code>uri</code> parameter is websocket url used to connect to FinnHub. Once you establish the connection with the FinnHub server and send the list of symbols that you want to get prices for, the server will send prices through this connection as they become available.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>recv_and_publish</span>(uri):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Receive messages from the websocket and publish events to Ensign.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e># establish connection with the FinnHub</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>with</span> websockets<span style=color:#f92672>.</span>connect(uri) <span style=color:#66d9ef>as</span> websocket:
</span></span><span style=display:flex><span>                <span style=color:#75715e># send the symbols you would like the prices for</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> symbol <span style=color:#f92672>in</span> SYMBOLS:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>await</span> websocket<span style=color:#f92672>.</span>send(
</span></span><span style=display:flex><span>                        <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>{{</span><span style=color:#e6db74>&#34;type&#34;:&#34;subscribe&#34;,&#34;symbol&#34;:&#34;</span><span style=color:#e6db74>{</span>symbol<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>}}</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>                    <span style=color:#75715e># receive prices asynchronously</span>
</span></span><span style=display:flex><span>                    message <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> websocket<span style=color:#f92672>.</span>recv()
</span></span><span style=display:flex><span>                    <span style=color:#75715e># convert the message to an Ensign event</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> event <span style=color:#f92672>in</span> message_to_events(json<span style=color:#f92672>.</span>loads(message)):
</span></span><span style=display:flex><span>                        <span style=color:#75715e># publish the event to the topic</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>await</span> ENSIGN<span style=color:#f92672>.</span>publish(
</span></span><span style=display:flex><span>                            TOPIC, event, on_ack<span style=color:#f92672>=</span>handle_ack, on_nack<span style=color:#f92672>=</span>handle_nack
</span></span><span style=display:flex><span>                        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> websockets<span style=color:#f92672>.</span>exceptions<span style=color:#f92672>.</span>ConnectionClosedError <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Websocket connection closed: </span><span style=color:#e6db74>{</span>e<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span></code></pre></div><p>Let&rsquo;s examine the call to <code>publish</code> in further detail.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>await</span> ENSIGN<span style=color:#f92672>.</span>publish(TOPIC, event, on_ack<span style=color:#f92672>=</span>handle_ack, on_nack<span style=color:#f92672>=</span>handle_nack)
</span></span></code></pre></div><p>Here the Ensign client is asynchronously sending an event to the Ensign server (the function call is preceded with the <code>await</code> keyword).</p><p>In synchronous communication between clients and servers, it is expected that a call to a function will return immediately, but in this example, it is not necessary, and in fact, the client can perform other work while waiting.</p><p>In asynchronous communication, clients need to know if the server received their messages. The <code>on_ack</code> parameter is an optional parameter that the client can specify to invoke a method when the server sends an <code>ack</code> message. Similarly, if there was an issue on the server side in receiving or processing the message, the server will send a <code>nack</code> message, which can then trigger a method to be called when the <code>nack</code> response is received by the client.</p><p>The following code snippet shows how to convert a message from the FinnHub API into an Ensign event. The price, symbol, timestamp, and volume data is extracted from the message and converted into a JSON object. Note the use of the <code>mimetype</code> parameter. This is important as subscribers need to know the mimetype in order to be able to decode and parse the event.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>message_to_events</span>(message):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Convert a message from the Finnhub API to an Ensign event.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    message_type <span style=color:#f92672>=</span> message[<span style=color:#e6db74>&#34;type&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> message_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ping&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> message_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;trade&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> trade <span style=color:#f92672>in</span> message[<span style=color:#e6db74>&#34;data&#34;</span>]:
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;price&#34;</span>: trade[<span style=color:#e6db74>&#34;p&#34;</span>],
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;symbol&#34;</span>: trade[<span style=color:#e6db74>&#34;s&#34;</span>],
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;timestamp&#34;</span>: trade[<span style=color:#e6db74>&#34;t&#34;</span>],
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;volume&#34;</span>: trade[<span style=color:#e6db74>&#34;v&#34;</span>],
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#75715e># convert data to a JSON object and specify the mimetype</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> Event(
</span></span><span style=display:flex><span>                json<span style=color:#f92672>.</span>dumps(data)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;utf-8&#34;</span>), mimetype<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;application/json&#34;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Unknown message type: </span><span style=color:#e6db74>{</span>message_type<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h3 id=create-the-subscriber>Create the subscriber</h3><p>In the following method, we set up the Ensign client to subscribe to the <code>trades</code> topic.</p><p>As soon as a new event arrives in the topic, the event gets converted into a dictionary object that is then loaded into a pandas dataframe. This dataframe gets passed to plotly to create a plotly <code>fig</code> object on which a line chart is drawn. Finally, the chart is rendered by calling <code>st.write(fig)</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>subscribe</span>():
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Subscribe to topic and populate line chart in a Streamlit app
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>for</span> event <span style=color:#f92672>in</span> ENSIGN<span style=color:#f92672>.</span>subscribe(topic):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>global</span> DF
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(event<span style=color:#f92672>.</span>data)
</span></span><span style=display:flex><span>        <span style=color:#75715e># convert unix epoch to datetime</span>
</span></span><span style=display:flex><span>        timestamp <span style=color:#f92672>=</span> get_timestamp(data[<span style=color:#e6db74>&#34;timestamp&#34;</span>])
</span></span><span style=display:flex><span>        message <span style=color:#f92672>=</span> dict()
</span></span><span style=display:flex><span>        message[<span style=color:#e6db74>&#34;symbol&#34;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#34;symbol&#34;</span>]
</span></span><span style=display:flex><span>        message[<span style=color:#e6db74>&#34;time&#34;</span>] <span style=color:#f92672>=</span> timestamp<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%H:%M:%S&#34;</span>)
</span></span><span style=display:flex><span>        message[<span style=color:#e6db74>&#34;price&#34;</span>] <span style=color:#f92672>=</span> str(data[<span style=color:#e6db74>&#34;price&#34;</span>])
</span></span><span style=display:flex><span>        <span style=color:#75715e># add new data to dataframe</span>
</span></span><span style=display:flex><span>        DF <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat([DF, pd<span style=color:#f92672>.</span>DataFrame([message])], ignore_index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Create a plotly line chart</span>
</span></span><span style=display:flex><span>        fig <span style=color:#f92672>=</span> px<span style=color:#f92672>.</span>line(DF, x<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;time&#34;</span>, y<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;price&#34;</span>, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;symbol&#34;</span>, markers<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Add the figure to the container</span>
</span></span><span style=display:flex><span>        st<span style=color:#f92672>.</span>write(fig)
</span></span></code></pre></div><h3 id=combining-the-publish-and-subscribe-functions>Combining the publish and subscribe functions</h3><p>Since the publisher and subscriber components are independent of each other, we will use the <code>asyncio</code> library to run them asynchronously.</p><p>We will first grab the Finnhub API key and add it to the websocket URL to call the API. Next we will use <code>asyncio.create_task</code> to create the publish and subscribe tasks. We will then run both of these tasks concurrently using <code>asyncio.gather</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># Load FINNHUB_API_KEY from environment variable</span>
</span></span><span style=display:flex><span>    token <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;FINNHUB_API_KEY&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> token <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;FINNHUB_API_KEY environment variable not set.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Create the subscribe and publish tasks and run them asynchronously</span>
</span></span><span style=display:flex><span>    subscribe_task <span style=color:#f92672>=</span> asyncio<span style=color:#f92672>.</span>create_task(subscribe())
</span></span><span style=display:flex><span>    publish_task <span style=color:#f92672>=</span> asyncio<span style=color:#f92672>.</span>create_task(recv_and_publish(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;wss://ws.finnhub.io?token=</span><span style=color:#e6db74>{</span>token<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> asyncio<span style=color:#f92672>.</span>gather(subscribe_task, publish_task)
</span></span></code></pre></div><h3 id=running-the-application>Running the application</h3><p>We start by creating an empty streamlit container by calling <code>with st.empty</code>. The container is like a canvas on which you draw elements. Next we create an async event loop that will be used to execute the <code>main</code> function that we defined above by calling <code>asyncio.run(main())</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Start with an empty container</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> st<span style=color:#f92672>.</span>empty():
</span></span><span style=display:flex><span>        <span style=color:#75715e># Create an event loop that will be used to run the publish and subscribe tasks</span>
</span></span><span style=display:flex><span>        loop <span style=color:#f92672>=</span> asyncio<span style=color:#f92672>.</span>new_event_loop()
</span></span><span style=display:flex><span>        asyncio<span style=color:#f92672>.</span>set_event_loop(loop)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            asyncio<span style=color:#f92672>.</span>run(main())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyboardInterrupt</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>finally</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Closing Loop&#34;</span>)
</span></span><span style=display:flex><span>            loop<span style=color:#f92672>.</span>close()
</span></span></code></pre></div><h3 id=conclusion>Conclusion</h3><p>As this post demonstrates, all it takes is a few lines of Python code to get a real-time web application up and running! There is no need to learn new programming languages or to set up complicated DevOps infrastructure. This frees up your time to focus on the most important aspect of your job: <em>converting data into dollars.</em> 🤑</p><div class="border-t my-12"></div><p>Photo by Markus Spiske on Unsplash</p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About </span>This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">If you want to build data web applications but have struggled with HTML and Javascript, Ensign and Streamlit is a powerful combination of tools that enable you to build an application in minutes!</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/prema-roman><img src=img/team/prema-roman.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span class="flex flex-wrap"><a href=/authors/prema-roman class="lg:w-[20ch] mx-2">Prema Roman</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><div class="flex items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span class=text-[#1D65A6]>Recommended</span>
&nbsp;Rotations</h2></div><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:mt-16"><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/starting-simple-with-ai/><img loading=lazy src=/img/blog/2024-05-08-to-llm-or-not-to-llm-that-is-the-question-part-2/cover-photo_hu3708469912556123294.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/llms>LLMs</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ai>AI</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ml>ML</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/data>Data</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/starting-simple-with-ai/ class=block>To LLM or Not to LLM (Part 2): Starting Simple</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">Sick of hearing about hyped up AI solutions that sound like hot air? 🧐 Let&rsquo;s use boring old ML to detect hype in AI marketing text and see why starting with a simple ML approach is still your best bet 90% of the time.</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=img/butterfly.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/danielle-maxwell>Danielle Maxwell</a>,&nbsp;</li><li class=font-extralight><a href=/authors/prema-roman>Prema Roman</a></li></ul></div><div class=font-extralight>May 20, 2024</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/responsible-innovation/><img loading=lazy src=/img/blog/2024-05-08-to-llm-or-not-to-llm-that-is-the-question-part-1/elena-mozhvilo-unsplash_hu7164420345709980639.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/llms>LLMs</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ai>AI</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ml>ML</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/data>Data</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/responsible-innovation/ class=block>To LLM or Not to LLM: Tips for Responsible Innovation</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">We&rsquo;re seeing a proliferation of Large Language Models (LLMs) as companies seek to replicate OpenAI&rsquo;s success. In this post, two AI engineers respond to LLM FAQs and offer tips for responsible innovation.</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=img/butterfly.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/danielle-maxwell>Danielle Maxwell</a>,&nbsp;</li><li class=font-extralight><a href=/authors/prema-roman>Prema Roman</a></li></ul></div><div class=font-extralight>May 8, 2024</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/introduction-to-polars/><img loading=lazy src=/img/blog/2023-08-18-introduction-to-polars/polar-bears-unsplash_hu402717581125423187.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/data>Data</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/introduction-to-polars/ class=block>Intro to Polars: A Pandas Alternative for Efficiently Working with Large Datasets</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">Dataframes are a powerful data structure for data processing, analytics, and ML. For many years, Pandas has been my go-to. But it can really slow you down when you&rsquo;re working with big or high-dimensional data. Enter Polars!</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=img/team/prema-roman.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/prema-roman>Prema Roman</a></li></ul></div><div class=font-extralight>Aug 22, 2023</div></div></div></li></ul></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start gap-x-2"><input type=checkbox id=checkbox required class="mt-1 w-4 h-4 block border-0">
<label for=checkbox><span>I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><footer class="relative mt-40 md:mt-56 bg-[#192E5B]"><div class="relative w-full pt-36 md:pt-16 lg:pt-24 2xl:pt-20 font-extralight text-white"><div class="-mt-52 w-full mx-auto max-w-screen-xl px-4"><section class="bg-[#72A2C0] w-full p-6 md:py-20 md:px-16"><h2 class="my-4 text-2xl sm:text-3xl md:text-5xl text-white font-extrabold">LET'S ENVISION & BUILD THE FUTURE TOGETHER.</h2><div class=py-6><a href=/contact class="p-3 md:p-4 md:px-6 bg-[#2F4858] font-bold md:text-lg text-white text-center hover:bg-[#2F4858]/80">CONTACT US</a></div></section></div><div class="max-w-7xl mx-auto px-6"><div class="mt-12 flex flex-col md:flex-row lg:justify-between gap-x-8"><div class="my-4 max-w-xs"><h5 class="mb-3 font-extrabold">OUR PRESENCE</h5><p>We share because we care, about topics, tools, and technologies that we believe impact the AI economy.</p><div class=py-4><ul class="flex justify-between items-center gap-x-8"><li><a href=https://twitter.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-x-twitter"></i><p class=sr-only>Twitter</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-linkedin"></i><p class=sr-only>LinkedIn</p></a></li><li><a href=https://github.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-github"></i><p class=sr-only>GitHub</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-youtube"></i><p class=sr-only>YouTube</p></a></li><li><a href=https://www.twitch.tv/rotationallabs target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-twitch"></i><p class=sr-only>Twitch</p></a></li></ul></div></div><div class=my-4><h5 class="mb-3 font-extrabold">COMPANY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/about>About Us</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/case-studies>Case Studies</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/endeavor>Endeavor</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/blog>Blog</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">COMMUNITY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/learning>Learning</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/opensource>Open Source</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">CONTACT US</h5><ul><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-map-marker-alt text-[#757575]"></i>
St. Paul, MN & Washington, DC</li><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-envelope text-[#757575]"></i>
info@rotational.io</li></ul><div class=py-8><a href=/contact class="p-3 bg-[#ECF6FF] font-bold text-black text-center hover:bg-[#ECF6FF]/80">CONTACT US</a></div></div></div><div class="sm:flex justify-between py-6 border-t mt-4"><p>Copyright © Rotational Labs, Inc. 2021–2024 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex gap-x-8"><li><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/24168101.js></script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script><script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script><script src=https://rotational.io/js/blogSingle.js></script></body></html>