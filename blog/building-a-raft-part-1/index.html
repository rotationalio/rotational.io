<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=twitter:card content="summary"><meta property="og:image" content="https://rotational.io/img/blog/2022-12-19-building-a-raft-part-1/otterRaftOne.png"><meta name=twitter:image content="https://rotational.io/img/blog/2022-12-19-building-a-raft-part-1/otterRaftOne.png"><meta property="og:title" content="Building a Raft (Part 1)"><meta name=twitter:title content="Building a Raft (Part 1)"><meta property="og:description" content="In the first part of our series on the Raft consensus algorithm we'll give an overview and introduction of the algorithm."><meta name=twitter:description content="In the first part of our series on the Raft consensus algorithm we'll give an overview and introduction of the algorithm."><meta name=author content="Rotational Labs, LLC"><base href=https://rotational.io/><title>Rotational Labs | Building a Raft (Part 1)</title><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,600;1,700;1,800&display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script async src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script src=https://kit.fontawesome.com/2c36e9b7b1.js crossorigin=anonymous></script>
<script src="https://www.google.com/recaptcha/enterprise.js?render="></script>
<script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script></head><body class="bg-hexagon bg-center bg-contain"><div class="sm:pt-5 pb-6 relative bg-[#1D65A6]"><nav class="relative max-w-7xl mx-auto flex items-center justify-between text-white px-4 sm:px-6" aria-label=Global><a href=/ class=pt-3><img src=img/logo.png alt="Rotational Lab logo" class="h-14 w-auto sm:h-14"></a><div class=topnav id=myTopnav><a href=https://rotational.app>Ensign</a>
<a href=/services/>Services</a>
<a href=/opensource/>Open Source</a>
<a href=/blog/>Blog</a>
<a href=/about/>About</a>
<a href=/contact/>Contact Us</a>
<a class="icon mt-4" onclick=openMobNav()><i class="fa fa-bars"></i></a></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=https://rotational.io/img/blog/2022-12-19-building-a-raft-part-1/otterRaftOne.png alt="Building a Raft (Part 1)" class=mx-auto></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="Building a Raft (Part 1)"><b class=text-[#1D65A6]>Building</b>
a Raft (Part 1)</h3><div class="flex justify-center items-center mt-4 mb-6"><img src=img/team/daniel-sollis.png alt class="border-4 border-white rounded-full h-11 drop-shadow-lg"><span class=ml-3>Daniel Sollis |
Monday, Dec 19, 2022 | Distributed Systems</span></div><div class="max-w-[800px] mx-auto prose prose-blue"><p>With all the <a href=http://localhost:1313/blog/six-things-you-didnt-know-about-crypto/>blockchain breaches</a> and <a href=https://rotational.io/blog/twitter-wont-disappear-overnight/>social media escapades</a>, there&rsquo;s been an awful lot of buzz about distributed systems lately. But how many of us really understand how they work? Let&rsquo;s dive in together&mldr;</p><p>As the focus of modern applications becomes global, distributed systems are becoming a more and more routine part of software engineering. The question comes down to this: &ldquo;How can we maintain availability with our applications and prevent data loss when servers inevitably crash?&rdquo;</p><p>This brings us to the topic of consensus algorithms, and in particular, the focus of this series of blog posts: the <strong>Raft</strong> consensus algorithm.</p><p>Consensus allows for the data contained in globally distributed servers to be replicated across multiple machines to prevent losses of either availability or data. Consensus algorithms are a class of provably safe, algorithmic mechanisms for enabling multiple servers to agree on a single value or a series of values (i.e. a log). They can be used for any generic data-generating process we might want to <a href=https://rotational.io/blog/a-distributed-systems-maze/>keep consistent</a>, whether that’s a file system, an event broker or any other kind of storage mechanism. Raft is perhaps the most popular of the consensus algorithms, and a perfect way to start learning about consensus!</p><h2 id=introducing-raft>Introducing Raft</h2><p><a href=https://lamport.azurewebsites.net/pubs/lamport-paxos.pdf>First published in 1989</a>, Leslie Lamport&rsquo;s <strong>Paxos</strong> algorithm was the first widely known mechanism for enabling state machine replication in a distributed context. This means that it can be used to enable a group of servers to remain in a consistent state by collectively producing a single, totally ordered, log of operations on which they all agree.</p><p>Strong consistency is a critical feature for many applications (think: banking, voting, etc.), because it engenders a high degree of trust across all users that the data will be the same no matter where they are geographically. By contrast, high availability systems frequently allow some to see stale data in return for quicker application response times.</p><p>Paxos has a reputation for being difficult to understand and implement. Raft is a similar protocol (technically an optimization/reframing of Paxos) <a href=https://web.stanford.edu/~ouster/cgi-bin/papers/raft-atc14>published in 2014</a> by Diego Ongaro and John Ousterhout, and is designed to alleviate these difficulties. Because of this, it makes for a good place to start learning about the wide world of consensus algorithms.</p><h2 id=the-basics>The Basics</h2><p>A Raft peer set is a group of servers that cooperate to keep their logs consistent with each other; a subset of these peers play an active role in the process (the quorum).</p><h3 id=a-shareable-log>A Shareable Log</h3><p>The core data structure in consensus is the <strong>Log</strong>, an ordered sequence of operations that each peer applies to update its state. Each member of the peer set maintains a local copy of the log, but in a distributed context, the log generally refers to a peer set&rsquo;s collective understanding of the sequence of events &ndash; including which events have occurred and the order in which they occurred.</p><h3 id=follow-the-leader>Follow the Leader</h3><p>Each server in a Raft quorum is at any time in one of three states. These roles may seem simple enough, but much of the complexity in implementing Raft is in writing code to effectively detect which of these states a given server is in (and the source of most bugs).</p><ul><li><strong>Leader</strong></li><li><strong>Follower</strong></li><li><strong>Candidate</strong></li></ul><p>Raft is a leader-driven algorithm. In a Raft quorum there can only be one leader at a given time and that leader is responsible for accepting requests and determining when the log should be updated. Raft is based on the principle that requests flow one way. When a new client request comes in, it should be routed to the Leader, which will take action and then pass on the new information to the rest of the Followers. The Leader is also responsible for sending periodic heartbeats to its Followers to let them know it is still active.</p><p>Followers are in charge of two things, responding to the leader’s requests (such as to append new entries to their log) and, in the case that a Follower hasn’t heard from the Leader in a long enough time, starting an election to assume the Leader role.</p><p>A Candidate is a Follower who, finding that it has not received a heartbeat from the Leader for a certain amount of time, is attempting to become the new Leader.</p><h3 id=in-terms-of-time>In Terms of Time</h3><p>Time in Raft is divided into what it calls <strong>Terms</strong> (or <strong>Epochs</strong>). Terms in Raft are equivalent to each leader&rsquo;s reign (as in a president&rsquo;s term in office); if an election is triggered and a new leader is decided on, a new term begins. Each peer in a Raft quorum is responsible for keeping track of the current term. Terms are used in Raft to allow servers to correctly order entries in the log and ensure that there is only one leader at a given time.</p><p><img src=/img/blog/2022-12-19-building-a-raft-part-1/raftTerms.png alt="&amp;ldquo;Terms in Raft&amp;rdquo;"></p><p>It should be noted that leaders also keep track of which log entries are considered committed. An entry is committed if the leader has received confirmation that it has been replicated to a majority of servers. Once an entry is committed Raft guarantees that that entry is durable and will eventually be replicated to all other servers.</p><h2 id=next-time>Next Time&mldr;</h2><p>That&rsquo;s it for the basics of Raft. In the next part of our series we&rsquo;ll start peeking into the inner workings of Raft&rsquo;s log replication by learning about the first of its two remote procedure calls. If you want a preview, check out this experimental implementation of the Raft algorithm done as a continuous learning <a href=https://github.com/rotationalio/Raft>exercise</a>.</p><h2 id=resources>Resources</h2><p>Lamport (1998) <a href=https://lamport.azurewebsites.net/pubs/lamport-paxos.pdf>The Part-Time Parliament</a></p><p>Ongaro and Ousterhout (2014) <a href=https://web.stanford.edu/~ouster/cgi-bin/papers/raft-atc14>In Search of an Understandable Consensus Algorithm</a></p></div></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><div class=text-center><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl"><b class=text-[#1D65A6]>About</b>
This Post</h3></div><p class="mt-4 text-base mx-auto text-center sm:mt-5 lg:mt-7 lg:text-base max-w-2xl">In the first part of our series on the Raft consensus algorithm we'll give an overview and introduction of the algorithm.</p><div class="md:flex text-center max-w-[600px] mx-auto border-t pt-6 mt-6 align-center justify-between"><div><div class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</div><div class="flex items-center mt-4 mb-6"><img src=img/team/daniel-sollis.png alt class="border-4 border-white rounded-full h-11 drop-shadow-lg"><span class=ml-3>Daniel Sollis</span></div></div><div class="sm:ml-10 sm:mt-0 mt-12"><div class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</div><ul class="grid grid-cols-3 gap-6 mt-4"><li><a onclick=shareByEmail() class="flex items-center"><img src=img/email.png alt class="p-3 bg-white rounded-lg mr-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class="flex items-center"><img src=img/twitter.png alt class="p-3 bg-white rounded-lg mr-4"></a></li><li><a onclick=shareOnLinkedIn() class="flex items-center"><img src=img/linkedin.png alt class="p-3 bg-white rounded-lg mr-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span><b class=text-[#1D65A6]>Recent</b>
Rotations</span>
<img src=img/butterfly.png alt=butterfly class="ml-4 h-6 sm:h-8 relative top-1"></h2><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><div class="sm:grid grid-cols-3 gap-8 sm:mt-16"><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/disrupt-managed-services/><img src=https://rotational.io/img/blog/dandelion.jpg alt class=rounded-t-xl style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><h4 class="text-base font-bold text-[#1D65A6]">Managed Services</h4><h3 class="text-xl font-extrabold mt-3"><a class="block h-24" href=https://rotational.io/blog/disrupt-managed-services/>3 Trends that Will Disrupt Managed Services in 2023</a></h3><div class=art-s><p class="mt-3 text-base font-extralight"><p>If nothing else, the last year has brought the winds of change to the tech sector. From high-visibility <a href=https://layoffs.fyi/>layoff cycles</a> at FAANGs and crypto companies, to turbulence in our <a href=https://rotational.io/blog/twitter-wont-disappear-overnight/>social media infrastructure</a>, to pop culture&rsquo;s discovery of deep …</p></p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6"><div class="flex items-center"><img src=img/team/rebecca-bilbro.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Rebecca Bilbro</span></div><div class=font-extralight>Dec 23, 2022</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/building-a-raft-part-1/><img src=https://rotational.io/img/blog/2022-12-19-building-a-raft-part-1/otterRaftOne.png alt class=rounded-t-xl style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><h4 class="text-base font-bold text-[#1D65A6]">Distributed Systems</h4><h3 class="text-xl font-extrabold mt-3"><a class="block h-24" href=https://rotational.io/blog/building-a-raft-part-1/>Building a Raft (Part 1)</a></h3><div class=art-s><p class="mt-3 text-base font-extralight"><p>With all the <a href=http://localhost:1313/blog/six-things-you-didnt-know-about-crypto/>blockchain breaches</a> and <a href=https://rotational.io/blog/twitter-wont-disappear-overnight/>social media escapades</a>, there&rsquo;s been an awful lot of buzz about distributed systems lately. But how many of us really understand how they work? Let&rsquo;s dive in together&mldr;</p></p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6"><div class="flex items-center"><img src=img/team/daniel-sollis.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Daniel Sollis</span></div><div class=font-extralight>Dec 19, 2022</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/go-serialization-formats/><img src=https://rotational.io/img/blog/serialization.png alt class=rounded-t-xl style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><h4 class="text-base font-bold text-[#1D65A6]">Serialization</h4><h3 class="text-xl font-extrabold mt-3"><a class="block h-24" href=https://rotational.io/blog/go-serialization-formats/>Choosing Serialization Formats in Go</a></h3><div class=art-s><p class="mt-3 text-base font-extralight"><p>Serialization format is an often-overlooked engineering step that could make your application as slow as a turtle or as speedy as a cheetah!</p></p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6"><div class="flex items-center"><img src=img/butterfly.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Daniel Sollis & Danielle Maxwell</span></div><div class=font-extralight>Dec 5, 2022</div></div></div></div></div></div></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start"><input type=checkbox id=checkbox required class="w-6 h-6 block border-0">
<label for=checkbox><span class="ml-2 text-left">I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><footer class="bg-hero-footer bg-cover"><div class="relative pt-[350px] font-extralight"><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="lg:grid grid-cols-3 text-white"><div><a href=/><img src=img/logo-white.png alt="Rotational Labs logo" class="mt-10 sm:mt-0 mx-auto sm:pb-5"></a></div><div class="mx-auto mt-5 sm:mt-0 max-w-lg pb-8 xl:mr-5"><h5 class="text-center lg:text-start font-bold text-lg">Contact Details</h5><p class="mt-3 ml-10 sm:ml-0 text-lg">We love to talk through complex scaling and performance issues. What’s slowing you down? Drop us a line for a friendly chat. We’ll make it worth your while.</p></div><div class="ml-10 xl:ml-5 sm:mt-0 mt-8"><ul class="sm:grid grid-cols-2 lg:flex flex-col gap-0 mr-5 xl:grid gap-x-32 gap-y-4"><li class=pb-8><a href=mailto:info@rotational.io class="flex items-center" target=_blank><img src=img/email.png alt class="p-4 bg-white rounded-lg mr-4">
<span>info@rotational.io</span></a></li><li class=pb-8><a href=https://github.com/rotationalio class="flex items-center" target=_blank><img src=img/github.png alt class="p-4 bg-white rounded-lg mr-4">
<span>rotationalio</span></a></li><li class=pb-8><a href=https://twitter.com/rotationalio class="flex items-center" target=_blank><img src=img/twitter.png alt class="p-4 bg-white rounded-lg mr-4">
<span>@rotationalio</span></a></li><li class=pb-8><a href=https://www.linkedin.com/company/rotational class="flex items-center" target=_blank><img src=img/linkedin.png alt class="p-4 bg-white rounded-lg mr-4">
<span>Rotational</span></a></li></ul></div></div><div class="sm:flex justify-between border-t py-6 text-white mt-12 sm:mt-32"><p>Copyright © 2022 Rotational Labs, LLC · All Rights Reserved</p><ul class="sm:mt-0 mt-4 flex"><li class="border-r pr-4 mr-4"><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></footer><script src=https://rotational.io/js/app.js></script></body></html>