<!doctype html><html lang=en-us><head><meta charset=UTF-8><title>Rotational Labs | Contexts in Go Microservice Chains</title>
<base href=https://rotational.io/ target=_self><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="Contexts are a critical part of services implemented in Golang, but although we see them often in server interfaces, they can be a bit mysterious to developers implementing request handlers. In this post, we look at a specific example where contexts shine: handlers that have to call multiple internal microservices to serve their response."><meta name=keywords content="ai for companies,ai software,ai consulting,ai solutions,ai development,enterprise ai,ai services,ai platform,ai applications,ai for business,artificial intelligence solutions,artificial intelligence consulting"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="Contexts in Go Microservice Chains"><meta property="og:description" content="Contexts are a critical part of services implemented in Golang, but although we see them often in server interfaces, they can be a bit mysterious to developers implementing request handlers. In this post, we look at a specific example where contexts shine: handlers that have to call multiple internal microservices to serve their response."><meta property="og:image" content="https://rotational.io/img/blog/2021-05-02-contexts-in-go-microservice-chains/arboreal.jpg"><meta property="og:url" content="https://rotational.io/blog/contexts-in-go-microservice-chains/"><meta property="og:type" content="website"><meta name=twitter:title content="Contexts in Go Microservice Chains"><meta name=twitter:card content="summary"><meta name=twitter:description content="Contexts are a critical part of services implemented in Golang, but although we see them often in server interfaces, they can be a bit mysterious to developers implementing request handlers. In this post, we look at a specific example where contexts shine: handlers that have to call multiple internal microservices to serve their response."><meta name=twitter:image content="https://rotational.io/img/blog/2021-05-02-contexts-in-go-microservice-chains/arboreal.jpg"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css><link rel=stylesheet href=https://rotational.io/output.css media=screen><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/24168101.js></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("consent","default",{ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied",functionality_storage:"denied",personalization_storage:"denied"});const hspConsent=window._hsp=window._hsp||[];hspConsent.push(["addPrivacyConsentListener",function(e){const s=e&&(e.allowed||e.categories&&e.categories.analytics),t=e&&(e.allowed||e.categories&&e.categories.advertisement),n=e&&(e.allowed||e.categories&&e.categories.functionality);gtag("consent","update",{ad_storage:t?"granted":"denied",ad_user_data:t?"granted":"denied",ad_personalization:t?"granted":"denied",analytics_storage:s?"granted":"denied",functionality_storage:n?"granted":"denied",personalization_storage:n?"granted":"denied"})}])</script><script src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW" async defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script async defer src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script><script src></script></head><body><div class="relative bg-[#1D65A6]"><nav class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-5" aria-label=Global><div class="relative max-w-7xl w-full flex flex-wrap lg:flex-nowrap items-center justify-between mx-auto"><a href=/><img src=/img/rototational-white-text-only_hu15583614935666962927.webp alt=Rotational class="h-6 w-auto">
</a><button data-collapse-toggle=navbar-dropdown type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls=navbar-dropdown aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="fa fa-bars text-xl text-white"></i></button><div class="hidden absolute z-[9999] lg:static top-16 w-[92%] md:w-[96%] lg:w-auto lg:block bg-white lg:bg-transparent text-[#192E5B] lg:text-[#F2F2F2] py-2 rounded-md" id=navbar-dropdown><ul class="flex flex-col lg:gap-2 xl:gap-4 md:flex-row font-semibold w-full md:justify-between"><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/about/>About</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><button id=dropdownNavbarLink data-dropdown-toggle=dropdownNavbar class="uppercase flex items-center justify-between gap-x-2 w-full px-3 rounded md:border-0 md:p-0 md:w-auto hover:text-black">
Services
<i class="fa fa-angle-down pt-1"></i></button><div id=dropdownNavbar class="z-10 hidden font-normal bg-[#192E5B] divide-y divide-[#192E5B] rounded-lg shadow w-44"><ul class="py-2 text-sm text-[#F2F2F2]" aria-labelledby=dropdownLargeButton><li><a href=/services/ai-assessments/ class="block px-3 py-2 hover:font-bold">AI Assessments</a></li><li><a href=/services/ai-product-development/ class="block px-3 py-2 hover:font-bold">AI Product Development</a></li><li><a href=/services/ai-ops-and-data-foundations/ class="block px-3 py-2 hover:font-bold">AI Ops & Data Foundations</a></li></ul></div></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/case-studies>Case Studies</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/blog/>Blog</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/learning/>Learning</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/endeavor/>Product</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/contact/>Contact</a></li></ul></div></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=/img/blog/2021-05-02-contexts-in-go-microservice-chains/arboreal_hu13970464913307738074.webp alt="Contexts in Go Microservice Chains" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="Contexts in Go Microservice Chains"><b class=text-[#1D65A6]>Contexts </b>in Go Microservice Chains</h3><div class="flex flex-wrap justify-center items-center my-6"><a href=/authors/benjamin-bengfort><img src=img/team/benjamin-bengfort.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a> | Sunday, May 2, 2021 |&nbsp;
</span><span><a href=/tags/microservices>Microservices</a>,&nbsp;
</span><a href=/tags/golang>Golang</a>,&nbsp;
</span><a href=/tags/programming>Programming</a></span></div><article class="max-w-[800px] mx-auto prose mt-12"><p>Contexts are a critical part of services implemented in Golang. Although we see them often in server interfaces, they can be mysterious to developers implementing request handlers. In this post, we&rsquo;ll discuss what contexts are and take a look at a specific example where contexts shine: services that are implemented as a series of microservice requests. Then we&rsquo;ll dive into the tl;dr of contexts — namely, the two crucial rules that all service handlers should implement. Finally, we&rsquo;ll demonstrate a quick experiment using gRPC to show how context deadlines are propagated to downstream microservices during request processing, enabling effective coordination.</p><p>The code for the experiment can be found at: <a href=https://github.com/rotationalio/ctxms>github.com/rotationalio/ctxms</a>.</p><h2 id=contexts-in-service-handlers>Contexts in Service Handlers</h2><p>If you&rsquo;ve implemented a gRPC API you&rsquo;ll know that the RPC interface for a request handler has a function signature that looks something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Server</span>) <span style=color:#a6e22e>MyRPC</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span> <span style=color:#a6e22e>in</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Request</span>) (<span style=color:#a6e22e>out</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Reply</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {}
</span></span></code></pre></div><p>The first argument is always a <code>context.Context</code>, which if you&rsquo;re like me, you think of as &ldquo;the thing with the deadline for the client&rdquo;. However, if you&rsquo;re also like me, 90% of the time you simply ignore it and implement the request handler without using that argument at all.</p><p>If most of the time, ignoring the context is fine, then what <em>are</em> contexts?</p><h2 id=what-are-contexts>What are Contexts?</h2><p>The <a href=https://golang.org/pkg/context/><code>context</code></a> package in the Go standard library provides a type <code>Context</code> that contains request-scoped values and signals that are safe for simultaneous use by multiple go routines and which facilitates communication across API boundaries and between processes.</p><p>So what <em>should</em> you do with the context? Here&rsquo;s what the documentation suggests:</p><blockquote><p>Incoming requests to a server should create a Context, and outgoing calls to servers should accept a Context. The chain of function calls between them must propagate the Context, optionally replacing it with a derived Context created using WithCancel, WithDeadline, WithTimeout, or WithValue. When a Context is canceled, all Contexts derived from it are also canceled.</p></blockquote><p>Two important rules follow from the statement above, which we&rsquo;ll explore more fully in the next few sections of this post. In summary:</p><ol><li>If you implement a long-running computation, you should run it in a go routine and <code>select</code> from either <code>ctx.Done()</code> or the result channel.</li><li>If you call a downstream contextual function, e.g. a database or a follow-on microservice, you should pass it the same context.</li></ol><h2 id=using-contexts-in-long-running-computations>Using Contexts in Long-Running Computations</h2><p>Say you have some work to do that may take a long time. What&rsquo;s a good threshold?</p><p>Frontier API responses need to be returned in a second or less. That means you get approximately:</p><ul><li>500ms for processing</li><li>250ms in either direction for network traffic</li></ul><p>Therefore &ldquo;a long time&rdquo; is likely anything that takes more than 450ms, though your needs may vary.</p><p>As for database requests, as a rule of thumb, responses should take around 20-50ms. If you&rsquo;re composing transactions programatically and not in SQL, this is another estimation point. Different systems will have different response times, so it&rsquo;s a best practice to measure and know for sure.</p><p>In addition, the client is likely going to set some kind of timeout on the request e.g. it will wait 5 seconds before retrying or displaying a message to the user. What happens if the client timeout is exceeded while you&rsquo;re processing? The client is going to stop waiting for a response, but the server will continue handling the request (most likely a wasted effort), <em>unless</em> we can detect the deadline exceeded. This is where the context comes in and is crtical.</p><p>Therefore, we follow Rule #1 as follows:</p><p>If you have a function <code>hardWork</code>, simply move it into a go routine and return the result in a channel:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>asyncHardWork</span>() <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>result</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>done</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>done</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>result</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>hardWork</span>()
</span></span><span style=display:flex><span>    }(<span style=color:#a6e22e>done</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>done</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then in your service handler, select either from <code>ctx.Done()</code> or the result channel as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>asyncHardWork</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this code, if the client deadline is exceeded, then the error will be returned immediately and the request handler routine will stop. While the <code>asyncHardWork</code> routine will continue until it&rsquo;s finished, any steps after <code>hardWork</code> won&rsquo;t continue, because the request has terminated early. Alternatively, you could create a contextual hard work. For example, if <code>hardWork</code> is iterative, you could check if the context is done on every pass, using a default to ensure the select is non-blocking:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>hardWork</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#a6e22e>result</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Check to ensure the context isn&#39;t canceled
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span>: <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Keep processing the for loop
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Computation here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=using-contexts-to-share-attention-span-across-microservices>Using Contexts to Share Attention Span Across Microservices</h2><p>This brings us to Rule #2:</p><p>If the downstream function is contextual e.g. accepts a context as the first argument, you should <em>always pass the <strong>same context</strong> to it</em>.</p><p>This may seem a little unnatural. For example, you may want to give a shorter deadline to a database transaction, but you don&rsquo;t know how long the client context is, which may have been passed to you from upstream processing that also took a long time. The key is to rely on the client to specify their context.</p><p>We can see this especially with database transactions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Server</span>) <span style=color:#a6e22e>MyRPC</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span> <span style=color:#a6e22e>in</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Request</span>) (<span style=color:#a6e22e>out</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Reply</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Begin a database transaction assuming we have a global variable, conn, that&#39;s a
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// database connection pool -- pass in the same context.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>Tx</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tx</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>conn</span>.<span style=color:#a6e22e>BeginTx</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#66d9ef>nil</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>FailedPrecondition</span>, <span style=color:#e6db74>&#34;could not start tx: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>Rollback</span>() <span style=color:#75715e>// Ignore rollback if tx is committed later in function.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Do transaction work here.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>If the context is done, then any <code>tx</code> calls (e.g. <code>tx.Query()</code> or <code>tx.Commit()</code>) will return a &ldquo;deadline exceeded&rdquo; error, allowing the transaction to stop processing and be rolled back to ensure that the database state is not left inconsistent.</p><h2 id=microservice-chains-and-context-handling-an-example>Microservice Chains and Context Handling: An Example</h2><p>Let&rsquo;s imagine that we&rsquo;re building a recommender system that takes incoming data from clients, and engages a series of microservices (represented as different terminal windows below) to return a prediction.</p><p><a href=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-context-terminals.png><img alt="Microservice Context Terminals" src=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-context-terminals.png></a></p><p>For instance, the first service (9000) is likely our API server, which might pass data to an authentication microservice (9001) to ensure the client is allowed to access the service. The authenticator then passes the data to a data preprocessor (9002) to properly encode the values, and the result is then passed to the global modeling service (9003) for the preliminary prediction. This prediction is then passed to a personalization microservice (9004), which filters the results, before finally passing them to the metrics logging microservice (9005).</p><p>In this scenario, in order to respond to the client, each of the microservices must in turn perform some work before firing off a message to the next microservice in the loop, and triggering the next phase of work. Once the final message makes it all the way back to the API server, only then can we properly respond to the client:</p><p><a href=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-chain-success.png><img alt="Microservice Chain Success" src=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-chain-success.png></a></p><p>If we engineer our chain of microservices to have independent contexts, they will have no way of sharing information, such as a timeout from the client. In this case, the subsequent microservices in the chain (9003, 9004, and 9005) go on to perform hard work that is no longer needed, since the client is no longer waiting for the response:</p><p><a href=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-chain-timeout.png><img alt="Microservice Chain Timeout" src=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-chain-timeout.png></a></p><p>However, if our chain shares a single context, as soon as the active microservice (9002) identifies the client timeout, it breaks the chain, saving the subsequent services the trouble of performing unneeded hard work:</p><p><a href=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-chain-timeout-with-context.png><img alt="Microservice Chain Timeout with Shared Context" src=/img/blog/2021-05-02-contexts-in-go-microservice-chains/2021-05-02-microservice-chain-timeout-with-context.png></a></p><h2 id=the-value-of-shared-context>The Value of Shared Context</h2><p>In summary, the two rules of contexts provide three distinct advantages:</p><p>(1) Contexts are the critical mechanism that allow your server implementations to be better behaved;
(2) Contexts result in less processing time and memory;
(3) Contexts allow your services to be more robust and effective.</p><p>Through this modest experiment, we see the value of <em>shared context</em>, especially as services become more complex and increasingly serve a more geographically dispersed customer base.</p><p>The code for experiment can be found at: <a href=https://github.com/rotationalio/ctxms>github.com/rotationalio/ctxms</a>.</p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About </span>This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">Contexts are a critical part of services implemented in Golang, but although we see them often in server interfaces, they can be a bit mysterious to developers implementing request handlers. In this post, we look at a specific example where contexts shine: handlers that have to call multiple internal microservices to serve their response.</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/benjamin-bengfort><img src=img/team/benjamin-bengfort.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span class="flex flex-wrap"><a href=/authors/benjamin-bengfort class="lg:w-[20ch] mx-2">Benjamin Bengfort</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><div class="flex items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span class=text-[#1D65A6]>Recommended</span>
&nbsp;Rotations</h2></div><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:my-8"><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/ranges-of-integer-data-types/><img loading=lazy src=/img/blog/num215_hu17749557558912417782.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/ranges-of-integer-data-types/ class=block>Ranges of Integer Data Types</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">The data type choices we make when building data systems or metrics is critically important: as our systems run for long periods of time it can be easy to overflow the integers that we use (Y2K bug anyone?). As a result, I find myself …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>Sep 7, 2022</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/marshaling-go-enums-to-and-from-json/><img loading=lazy src=/img/blog/fireworks_star_hu7528471189281910091.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/marshaling-go-enums-to-and-from-json/ class=block>Marshaling Go Enums to and from JSON</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">Customizing JSON serialization for your data types seems relatively straightforward on the surface, but it&rsquo;s easy to get turned around in receiver, value, pointer, and indirection confusion. Many of the patterns and rules-of-thumb you …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>May 26, 2022</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/><img loading=lazy src=/img/blog/2021-02-12-grpc-openapi-docs/gateway_hu12922882535480469414.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/grpc>gRPC</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/ class=block>Documenting a gRPC API with OpenAPI</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">gRPC makes the specification and implementation of networked APIs a snap. But what is the simplest way to <em>document</em> a gRPC API? There seem to be some hosted providers by Google, e.g. <a href=https://cloud.google.com/endpoints/docs/grpc/dev-portal-update-ref-docs>SmartDocs</a>, but I have yet to find a gRPC-specific tool. …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>Feb 12, 2021</div></div></div></li></ul></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-8 px-12 md:px-16 text-white md:rounded-lg"><input type=hidden id=newsletterFormID value=8aeeb77b-a5e0-4772-b726-44e1fc2eb6e1><form action=newsletter method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><div class="bg-teal-100 border-t-4 border-teal-500 mt-3 rounded-b text-teal-900 p-4 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for joining the Rotational Labs newsletter!</p></div></div></div><div id=newsletter-error class="hidden mt-3 bg-red-200 border-t-4 border-red-600 text-red-900 rounded-b p-4 shadow-md" role=alert><div><p class=text-sm>Your request did not go through, please try again. If you need immediate assistance, please email support@rotational.io.</p></div></div><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start gap-x-2"><input type=checkbox id=checkbox required name=consent class="mt-1 w-4 h-4 block border-0">
<label for=checkbox><span id=consentText>I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="flex justify-center"><button id=newsletter-bttn type=submit data-sitekey=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk data-action=newsletter class="bg-[#192E5B] px-10 py-3 mt-8 rounded-lg text-sm text-white uppercase md:text-base hover:bg-[#192E5B]/80">
Submit</button></div></form></div></main><footer class="relative mt-40 md:mt-56 bg-[#192E5B]"><div class="relative w-full pt-36 md:pt-16 lg:pt-24 2xl:pt-20 font-extralight text-white"><div class="-mt-52 w-full mx-auto max-w-screen-xl px-4"><section class="bg-[#72A2C0] w-full p-6 md:py-20 md:px-16"><h2 class="my-4 text-2xl sm:text-3xl md:text-5xl text-white font-extrabold">LET'S ENVISION & BUILD THE FUTURE TOGETHER.</h2><div class=py-6><a href=/contact class="p-3 md:p-4 md:px-6 bg-[#2F4858] font-bold md:text-lg text-white text-center hover:bg-[#2F4858]/80">CONTACT US</a></div></section></div><div class="max-w-7xl mx-auto px-6"><div class="mt-12 flex flex-col md:flex-row lg:justify-between gap-x-8"><div class="my-4 max-w-xs"><h5 class="mb-3 font-extrabold">OUR PRESENCE</h5><p>We share because we care, about topics, tools, and technologies that we believe impact the AI economy.</p><div class=py-4><ul class="flex justify-between items-center gap-x-8"><li><a href=https://twitter.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-x-twitter"></i><p class=sr-only>Twitter</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-linkedin"></i><p class=sr-only>LinkedIn</p></a></li><li><a href=https://github.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-github"></i><p class=sr-only>GitHub</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-youtube"></i><p class=sr-only>YouTube</p></a></li><li><a href=https://www.twitch.tv/rotationallabs target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-twitch"></i><p class=sr-only>Twitch</p></a></li></ul></div></div><div class=my-4><h5 class="mb-3 font-extrabold">COMPANY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/about>About Us</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/case-studies>Case Studies</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/endeavor>Endeavor</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/blog>Blog</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">COMMUNITY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/learning>Learning</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/opensource>Open Source</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">CONTACT US</h5><ul><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-map-marker-alt text-[#757575]"></i>
St. Paul, MN & Washington, DC</li><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-envelope text-[#757575]"></i>
info@rotational.io</li></ul><div class=py-8><a href=/contact class="p-3 bg-[#ECF6FF] font-bold text-black text-center hover:bg-[#ECF6FF]/80">CONTACT US</a></div></div></div><div class="sm:flex justify-between py-6 border-t mt-4"><p>Copyright © Rotational Labs, Inc. 2021–2025 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex gap-x-8"><li><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li><li><button id=hs_show_banner_button type=button onclick='(()=>{const e=window._hsp=window._hsp||[];e.push(["showBanner"])})()'>
Manage Cookies</button></li></ul></div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js></script><script src=https://rotational.io/js/blogSingle.js></script><script type=module src=https://rotational.io/js/newsletterForm.js></script></body></html>