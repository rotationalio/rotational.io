<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Rotational Labs | Async or Swim: A Developer's Guide to Wading into Asynchronous Processing</title><base href=https://rotational.io/ target=_self><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="A technical dive into asynchronous processing in Go."><meta name=keywords content="Rotational Labs,Ensign,Cloud-native,Real-time data streaming platform,Data collaboration,Data automation,Rapid prototyping,Real-time machine learning,Real-time data analytics,Real-time applications,Data streams,Event streams,Event-sourcing databaseEvent log"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="Async or Swim: A Developer's Guide to Wading into Asynchronous Processing"><meta property="og:description" content="A technical dive into asynchronous processing in Go."><meta property="og:image" content="https://rotational.io/img/blog/mississippi.jpg"><meta property="og:url" content="https://rotational.io/blog/async-or-swim/"><meta property="og:type" content="website"><meta name=twitter:title content="Async or Swim: A Developer's Guide to Wading into Asynchronous Processing"><meta name=twitter:card content="summary"><meta name=twitter:description content="A technical dive into asynchronous processing in Go."><meta name=twitter:image content="https://rotational.io/img/blog/mississippi.jpg"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css><link rel=stylesheet href=https://unpkg.com/@highlightjs/cdn-assets/styles/default.min.css><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script async src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script>
<script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script><script src=https://kit.fontawesome.com/2c36e9b7b1.js crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr/lunr.js></script></head><body class="bg-hexagon bg-center bg-contain"><div class="relative bg-[#1D65A6]"><nav class="relative max-w-7xl mx-auto flex items-center justify-between text-white px-4 sm:px-6 z-[9999] py-5" aria-label=Global><a href=/><img src=img/logo.png alt="Rotational Lab logo" class="h-14 w-auto sm:h-14"></a><div class=topnav id=myTopnav><a href=/ensign/>Ensign</a>
<a href=/services/>Services</a>
<a href=/blog/>Blog</a>
<a href=/about/>About</a>
<a href=/contact/>Request a Demo</a>
<a href=https://rotational.app/register>Get Ensign Free</a>
<a class=icon onclick=openMobNav()><i class="fa fa-bars"></i></a></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=https://rotational.io/img/blog/mississippi.jpg alt="Async or Swim: A Developer's Guide to Wading into Asynchronous Processing" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="Async or Swim: A Developer's Guide to Wading into Asynchronous Processing"><b class=text-[#1D65A6]>Async</b>
or Swim: A Developer's Guide to Wading into Asynchronous Processing</h3><div class="flex flex-wrap justify-center items-center my-4"><a href=/authors/patrick-deziel><img src=img/team/patrick-deziel.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg"></a>
<span class=blog-date><a href=/authors/patrick-deziel class=single-multi-author>Patrick Deziel</a> | Monday, Jun 5, 2023 |&nbsp;</span>
<span><a href=/tags/eventing class=blog-tag>Eventing</a></span>
<a href=/tags/golang class=blog-tag>Golang</a></span></div><article class="max-w-[800px] mx-auto prose"><p>The Go programming language provides powerful tools for managing concurrency, but robust asynchronous code requires us as developers to design around uncertain tasks and manifold queues. Step through an async codebase with us in this post!</p><h2 id=whats-an-async-task>What&rsquo;s an Async Task?</h2><p>If you&rsquo;re a developer like me, you avoid introducing concurrency when it&rsquo;s not necessary.</p><p>Concurrency is a double-edged sword that enables things like vector processing on graphics cards and eventing systems, but is <strong>notoriously</strong> difficult to understand, debug, and maintain. Unfortunately, if you&rsquo;re building services for users, being able to service simultaneous requests is unavoidable. Hopefully you&rsquo;re using a database equipped to handle concurrent updates and resolve consistency issues. (If you aren&rsquo;t sure, it may be time to <a href=https://rotational.io/blog/age-of-postsql/>get a bit more familiar with your data layer.</a>)</p><p>While building <a href=https://rotational.app/register>Ensign</a>, we needed a way to not just service user requests, but schedule tasks to happen &ldquo;sometime in the near future&rdquo;. For example, if a user logs into the system, we want to update their <code>last_login</code> timestamp in a database. This doesn&rsquo;t need to happen immediately since it&rsquo;s not a critical step for giving a user access to the system, but it should happen <em>eventually</em>. In distributed systems terminology, that&rsquo;s eventual consistency. (Looking for <a href=https://youtu.be/69NHCONuCDU>an entertaining introduction to distributed systems?</a>.)</p><p>So let&rsquo;s build an asynchronous task manager in Go!</p><h2 id=the-minimal-task-manager>The Minimal Task Manager</h2><p>The task manager should provide an interface for the programmer to execute code without blocking the current thread. We should also consider the following points if we have to run this in production:</p><ol><li>The amount of concurrency should be limited to avoid overloading the server.</li><li>The number of tasks should be limited to avoid running up the memory usage.</li></ol><p>Fortunately, Go has some great concurrency builtins, which are probably why you&rsquo;re using Go in the first place. We can create a buffered channel, which acts as a bounded queue — writing to the queue only blocks if the queue is full, and reading from the queue only blocks if the queue is empty. This is similar to Python&rsquo;s <code>asyncio.Queue</code> but allows us to send &ldquo;tasks&rdquo; between go routines.</p><p>To limit the amount of concurrency, we can employ a worker pool pattern and only run the configured number of worker routines. The job of a worker is to pull tasks off the queue and execute them. The beauty of Go channels is that we don&rsquo;t have to worry about synchronizing the workers with a global lock.</p><div class=items-center><img src=https://rotational.io/img/blog/2023-06-01-async-or-swim/minimal.png alt='Minimal Task Workflow' class="m-auto py-3 h-[100px]"></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>tasks</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Task</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// TaskFunc is an adapter to allow ordinary functions to be used as tasks.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TaskFunc</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#a6e22e>TaskFunc</span>) <span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>t</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// TaskManagers execute Tasks using a fixed number of workers that operate in their own
</span></span></span><span style=display:flex><span><span style=color:#75715e>// go routines.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TaskManager</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wg</span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>queue</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// TaskHandler wraps a Task with a context.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TaskHandler</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>task</span> <span style=color:#a6e22e>Task</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span>  <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// New returns TaskManager, running the specified number of workers in their own Go
</span></span></span><span style=display:flex><span><span style=color:#75715e>// routines and creating a queue of the specified size. The task manager is now ready
</span></span></span><span style=display:flex><span><span style=color:#75715e>// to perform routine tasks!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>workers</span>, <span style=color:#a6e22e>queueSize</span> <span style=color:#66d9ef>int</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskManager</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wg</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>{}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>queue</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>, <span style=color:#a6e22e>queueSize</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>workers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>TaskWorker</span>(<span style=color:#a6e22e>wg</span>, <span style=color:#a6e22e>queue</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>TaskManager</span>{<span style=color:#a6e22e>wg</span>, <span style=color:#a6e22e>queue</span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Stop the task manager waiting for all workers to stop their tasks before returning.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>tm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskManager</span>) <span style=color:#a6e22e>Stop</span>() {
</span></span><span style=display:flex><span>	close(<span style=color:#a6e22e>tm</span>.<span style=color:#a6e22e>queue</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tm</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Queue a task with a background context. Blocks if the queue is full.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>tm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskManager</span>) <span style=color:#a6e22e>Queue</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>task</span> <span style=color:#a6e22e>Task</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tm</span>.<span style=color:#a6e22e>queue</span> <span style=color:#f92672>&lt;-</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>TaskHandler</span>{<span style=color:#a6e22e>task</span>, <span style=color:#a6e22e>ctx</span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TaskWorker</span>(<span style=color:#a6e22e>wg</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>, <span style=color:#a6e22e>queue</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>handler</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>queue</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>handler</span>.<span style=color:#a6e22e>task</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>handler</span>.<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then all we have to do from the application code is define and execute the task!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#a6e22e>tasks</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tasks</span>.<span style=color:#a6e22e>New</span>(<span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>task</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#ae81ff>1</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Minute</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>UpdateLastLogin</span>(<span style=color:#a6e22e>ctx</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Log the error so we know that this failed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>tasks</span>.<span style=color:#a6e22e>Queue</span>(<span style=color:#a6e22e>tasks</span>.<span style=color:#a6e22e>TaskFunc</span>(<span style=color:#a6e22e>task</span>))
</span></span></code></pre></div><p><em>Note: Passing in a context helps prevent tasks from running forever, assuming that the underlying code actually respects the context.</em></p><h2 id=if-at-first-you-dont-succeed>If at first you don&rsquo;t succeed&mldr;</h2><p>The above is functional, but sometimes we need a way to retry failing tasks. For example, sending an email is prone to intermittent failure, since it relies on external systems. We might want to retry it a few times to ensure that users actually receive the email. A good retry mechanism also supports backoffs. If we retry the task immediately there&rsquo;s a good chance it will fail again, but if we wait for a bit, there&rsquo;s a better chance that transient errors like network issues will be resolved (this is why you will see <code>CrashLoopBackoff</code> and <code>ImagePullBackoff</code> states for pods in k8s).</p><p>One solution is to have the workers be responsible for putting tasks back onto the queue if they need to be retried. Maybe we want something like the below revised architecture diagram?</p><div class=items-center><img src=https://rotational.io/img/blog/2023-06-01-async-or-swim/retries.png alt='Minimal Task Workflow' class="m-auto py-3 h-[100px]"></div><p>Getting warmer, but the fact that everything is writing back to the same queue is a red flag. Consider the case where the queue is already full with tasks from the application. Remember that buffered channels block on writes if the channel is full. If a worker needs to retry a task, it will be stuck trying to write to the queue. Even worse, if all workers are blocked then the application won&rsquo;t be able to queue new tasks and the system goes into full deadlock!</p><p>The solution is to introduce more control over the queue. We can create another go routine, a tick-based <code>TaskScheduler</code>, which is responsible for scheduling both new and retryable tasks, and will work hard to avoid the deadlock situation. The improved architecture looks something like this:</p><div class=items-center><img src=https://rotational.io/img/blog/2023-06-01-async-or-swim/scheduler.png alt='Minimal Task Workflow' class="m-auto py-3 h-[100px]"></div><p>Note that there are now <em>two</em> queues, which help us distinguish between brand new tasks and scheduled tasks. This allows us to further isolate the responsibilities of the task scheduler and the workers. Although there is still some recursive madness, the scheduler has the ability to ensure that both queues remain unblocked.</p><h2 id=task-scheduler>Task Scheduler</h2><p>The key to preventing deadlocks is to &ldquo;hold&rdquo; pending tasks in the scheduler. We don&rsquo;t want to put them on the queue if they aren&rsquo;t ready, since this creates the situation discussed previously. The pending tasks are actually another form of queue, but in this implementation it&rsquo;s unbounded to make sure the workers can make progress. <em>Note: This means we have to be <strong>really careful</strong> to avoid leaking memory.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TaskScheduler</span>(<span style=color:#a6e22e>wg</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>, <span style=color:#a6e22e>queue</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>, <span style=color:#a6e22e>tasks</span> <span style=color:#66d9ef>chan</span><span style=color:#f92672>&lt;-</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>, <span style=color:#a6e22e>stop</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}, <span style=color:#a6e22e>interval</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Hold tasks awaiting retry and queue them every tick if ready
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>pending</span> <span style=color:#f92672>:=</span> make([]<span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>64</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ticker</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>NewTicker</span>(<span style=color:#a6e22e>interval</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>ticker</span>.<span style=color:#a6e22e>Stop</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>task</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>queue</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Check if the task is a retry task that needs to be held
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>task</span>.<span style=color:#a6e22e>retryAt</span>.<span style=color:#a6e22e>IsZero</span>() <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Before</span>(<span style=color:#a6e22e>task</span>.<span style=color:#a6e22e>retryAt</span>) {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>pending</span> = append(<span style=color:#a6e22e>pending</span>, <span style=color:#a6e22e>task</span>)
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Otherwise send the task to the worker queue immediately
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>// Do not block the send; if no workers are available, append the task to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>// the pending data structure. This will reduce the backpressure on the
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>// queue but also prevent deadlocks where there are more retries than
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>// workers available and no one can make progress.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>tasks</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>task</span>:
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>pending</span> = append(<span style=color:#a6e22e>pending</span>, <span style=color:#a6e22e>task</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ticker</span>.<span style=color:#a6e22e>C</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Do not modify pending if it contains no tasks.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>pending</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Check all of the pending tasks to see if any are ready to be queued
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>task</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pending</span> {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>task</span>.<span style=color:#a6e22e>retryAt</span>.<span style=color:#a6e22e>IsZero</span>() <span style=color:#f92672>||</span> <span style=color:#a6e22e>task</span>.<span style=color:#a6e22e>retryAt</span>.<span style=color:#a6e22e>Before</span>(<span style=color:#a6e22e>now</span>) {
</span></span><span style=display:flex><span>					<span style=color:#75715e>// The task is ready to retry; queue it up and delete it from pending
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>					<span style=color:#75715e>// Note: this is a non-blocking write to tasks in case there are no
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>					<span style=color:#75715e>// workers available to handle the current task.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>					<span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>case</span> <span style=color:#a6e22e>tasks</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>task</span>:
</span></span><span style=display:flex><span>						<span style=color:#a6e22e>pending</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Prevent memory leaks by shifting tasks to deleted spots without allocation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>task</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pending</span> {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>task</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>pending</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>task</span>
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Compute the new capacity, shrinking it if necessary to prevent leaks.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>newcap</span> <span style=color:#f92672>:=</span> cap(<span style=color:#a6e22e>pending</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>64</span> &lt; <span style=color:#a6e22e>newcap</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>newcap</span> = <span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>pending</span> = <span style=color:#a6e22e>pending</span>[:<span style=color:#a6e22e>i</span>:<span style=color:#a6e22e>newcap</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>stop</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Flush remaining tasks to the workers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>task</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>pending</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>tasks</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>task</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			close(<span style=color:#a6e22e>tasks</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=workers>Workers</h2><p>Workers need only know how to execute a task and if a retry needs to be queued. We can put some state in the <code>TaskHandler</code> to ensure that we keep track of the number of attempts, etc. If a retry needs to be done, the worker just sends it back to the original queue for the scheduler to process.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TaskHandler</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>parent</span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskManager</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>task</span>      <span style=color:#a6e22e>Task</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>opts</span>      <span style=color:#f92672>*</span><span style=color:#a6e22e>options</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span>       <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span>       <span style=color:#f92672>*</span><span style=color:#a6e22e>Error</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>attempts</span>  <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>retryAt</span>   <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>scheduled</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TaskWorker</span>(<span style=color:#a6e22e>wg</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>, <span style=color:#a6e22e>tasks</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>handler</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tasks</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>handler</span>.<span style=color:#a6e22e>Exec</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Execute the wrapped task with the context. If the task fails, schedule the task to
</span></span></span><span style=display:flex><span><span style=color:#75715e>// be retried using the backoff specified in the options.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>) <span style=color:#a6e22e>Exec</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Attempt to execute the task
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>task</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>ctx</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Success!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Deal with the error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>attempts</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Append</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Check if we have retries left
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>attempts</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>retries</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Schedule the retry be added back to the queue
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>retryAt</span> = <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>backoff</span>.<span style=color:#a6e22e>NextBackOff</span>())
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>parent</span>.<span style=color:#a6e22e>queueTask</span>(<span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// At this point we&#39;ve exhausted all possible retries, so log the error.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>scheduled</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Log</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Logger</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Capture</span>(<span style=color:#a6e22e>sentry</span>.<span style=color:#a6e22e>GetHubFromContext</span>(<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>ctx</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>tm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskManager</span>) <span style=color:#a6e22e>queueTask</span>(<span style=color:#a6e22e>handler</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>TaskHandler</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// The read-lock allows us to check tm.stopped concurrently. If Stop() has been
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// called it holds a write lock that prevents this lock from being acquired until
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// the scheduler has closed the queue.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>tm</span>.<span style=color:#a6e22e>RLock</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>tm</span>.<span style=color:#a6e22e>RUnlock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tm</span>.<span style=color:#a6e22e>stopped</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Dropping the task because the task manager is not running
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Warn</span>().<span style=color:#a6e22e>Err</span>(<span style=color:#a6e22e>ErrTaskManagerStopped</span>).<span style=color:#a6e22e>Msg</span>(<span style=color:#e6db74>&#34;cannot queue async task when task manager is stopped&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ErrTaskManagerStopped</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Queue the handler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>tm</span>.<span style=color:#a6e22e>queue</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>handler</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=final-thoughts>Final Thoughts</h2><p>There&rsquo;s just no doubt about it — it&rsquo;s hard to reason about asynchronous processing! No matter how senior you get, concurrency is hard.</p><p>But being able to name your problem is most of the battle, and hopefully the example in this post helps illustrate some of the hazards to watch out for!</p><p>Want more? Check out the <a href=https://github.com/rotationalio/ensign/blob/main/pkg/utils/tasks>Ensign repo on GitHub</a>!</p><p><em>If you&rsquo;re looking to add more concurrency to your architecture, check out <a href=https://rotational.app/register/>Ensign</a>, a platform and community for developers building asynchronous apps.</em></p><p>Photo by <a href=https://unsplash.com/@usgs>USGS</a> on <a href=https://unsplash.com/photos/35Z2ylLRCO8>Unsplash</a></p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About</span>
This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">A technical dive into asynchronous processing in Go.</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/patrick-deziel><img src=img/team/patrick-deziel.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg"></a>
<span class="flex flex-wrap"><a href=/authors/patrick-deziel class="single-multi-author lg:w-[20ch] mx-2">Patrick Deziel</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span><b class=text-[#1D65A6]>Recent</b>
Rotations</span>
<img src=img/butterfly.png alt=butterfly class="ml-4 h-6 sm:h-8 relative top-1"></h2><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><div class="sm:grid grid-cols-3 gap-8 sm:mt-16"><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/reinforcement-learning-automation-and-tetris/><img src=https://rotational.io/img/blog/gameboy.jpg alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex whitespace-nowrap"><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/reinforcement-learning>Reinforcement Learning</a></li><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/ai>AI</a></li><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a></li></ul><h3 class="text-xl font-extrabold mt-3 pb-2"><a class="block h-24" href=https://rotational.io/blog/reinforcement-learning-automation-and-tetris/>Reinforcement Learning, Automation... and Tetris</a></h3><div class=art-s><p class="mt-8 text-base font-extralight"><p>Every time I&rsquo;m writing complex rules in my code, I remember there&rsquo;s a machine learning technique for this: Reinforcement Learning. RL models are able to learn the optimal rules given predefined rewards. Read on to learn how!</p></p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6"><div class="flex items-center"><a href=/authors/patrick-deziel class="flex items-center"><img src=img/team/patrick-deziel.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Patrick Deziel</span></a></div><div class=font-extralight>Nov 2, 2023</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/compression-vs-cryptography/><img src=https://rotational.io/img/blog/espresso-press.jpg alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex whitespace-nowrap"><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/compression>Compression</a></li><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/cryptography>Cryptography</a></li><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/benchmarks>Benchmarks</a></li></ul><h3 class="text-xl font-extrabold mt-3 pb-2"><a class="block h-24" href=https://rotational.io/blog/compression-vs-cryptography/>Compression vs Cryptography: What Comes First?</a></h3><div class=art-s><p class="mt-8 text-base font-extralight"><p>Data encryption and compression are heavyweight algorithms that must be used with care in performance intensive applications; but when applying both mechanics to the same data, which should come first?</p></p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6"><div class="flex items-center"><a href=/authors/benjamin-bengfort class="flex items-center"><img src=img/team/benjamin-bengfort.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Benjamin Bengfort</span></a></div><div class=font-extralight>Oct 31, 2023</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/welcome-to-ensign-u/><img src=https://rotational.io/img/blog/library.jpg alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex whitespace-nowrap"><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a></li><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/eventing>Eventing</a></li><li class="blog-tag text-base font-bold text-[#1D65A6]"><a href=/tags/ml>ML</a></li></ul><h3 class="text-xl font-extrabold mt-3 pb-2"><a class="block h-24" href=https://rotational.io/blog/welcome-to-ensign-u/>Welcome to Ensign U!</a></h3><div class=art-s><p class="mt-8 text-base font-extralight"><p>Like any new tool, Ensign takes a little time to learn. But take it from us (a bunch of seasoned data science experts) &ndash; it will open up a new world of data science applications for you. Check out this beginner-friendly introduction!</p></p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6"><div class="flex items-center"><a href=/authors/rotational-labs class="flex items-center"><img src=img/butterfly.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Rotational Labs</span></a></div><div class=font-extralight>Oct 20, 2023</div></div></div></div></div></div></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start"><input type=checkbox id=checkbox required class="w-6 h-6 block border-0">
<label for=checkbox><span class="ml-2 text-left">I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><div id=footerBackground><footer class="bg-hero-footer bg-cover"><div class="pt-[350px] font-extralight text-white"><div class="max-w-7xl mx-auto px-6"><div class="max-[650px]:text-center sm:grid grid-cols-3"><div class="my-10 sm:my-0"><h5 class=mb-3>PRODUCT</h5><ul><li class=pb-3><a href=https://rotational.app target=_blank class=font-bold>Ensign</a></li><li class=pb-3><a href=https://ensign.rotational.dev/getting-started/ target=_blank class=font-bold>Documentation</a></li><li class=pb-3><a href=https://ensign.rotational.dev/sdk/ target=_blank class=font-bold>SDKs</a></li></ul></div><div class="mb-10 sm:mb-0"><h5 class=mb-3>COMPANY</h5><ul><li class=pb-3><a href=/services class=font-bold>Services</a></li><li class=pb-3><a href=/blog class=font-bold>Blog</a></li><li class=pb-3><a href=/about class=font-bold>About</a></li></ul></div><div><h5 class=mb-3>COMMUNITY</h5><ul><li class=pb-3><a href=/data-playground class=font-bold>Data Playground</a></li><li class=pb-3><a href=/opensource class=font-bold>Open Source</a></li></ul></div></div><div class="max-w-7xl sm:flex justify-between border-t py-6 mt-12 sm:mt-32"><div class="mx-auto xl:ml-5 sm:mt-0 mt-8"><div><ul class="mx-auto grid grid-cols-2 gap-x-20 md:gap-x-32 lg:grid-cols-4"><li class="pb-8 mt-1"><a href=https://twitter.com/rotationalio class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/twitter.svg alt class=scale-75>
<span class=ml-4>Twitter</span></a></li><li class="pb-8 mt-1"><a href=https://github.com/rotationalio class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/github.svg alt class=scale-[.8]>
<span class=ml-4>GitHub</span></a></li><li class=pb-8><a href=https://www.linkedin.com/company/rotational class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/linkedin.svg alt class=scale-75>
<span class="mt-2 ml-4">LinkedIn</span></a></li><li class="pb-8 mt-2"><a href=mailto:info@rotational.io class="flex items-center p-2 hover:rounded-full hover:bg-icon-hover" target=_blank><img src=img/footer/email.svg alt class=scale-[.8]>
<span class=ml-4>Email</span></a></li></ul></div></div></div><div class="sm:flex justify-between py-6"><p>Copyright © Rotational Labs, Inc. 2021–2023 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex"><li class="border-r pr-4 mr-4"><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></div></footer></div><script src=https://rotational.io/js/app.js></script>
<script src=https://rotational.io/js/playground-search.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js></script>
<script src=https://unpkg.com/@highlightjs/cdn-assets/highlight.min.js></script></body></html>