<!doctype html><html lang=en-us><head><meta charset=UTF-8><title>Rotational Labs | Mocking the Universe: Two Techniques for Testing gRPC with Mocks</title>
<base href=https://rotational.io/ target=_self><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="Mocking can be an easy way to get around gRPC connections when testing."><meta name=keywords content="ai for companies,ai software,ai consulting,ai solutions,ai development,enterprise ai,ai services,ai platform,ai applications,ai for business,artificial intelligence solutions,artificial intelligence consulting"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="Mocking the Universe: Two Techniques for Testing gRPC with Mocks"><meta property="og:description" content="Mocking can be an easy way to get around gRPC connections when testing."><meta property="og:image" content="https://rotational.io/img/blog/2023-03-08-mocking-the-universe/monkey-in-mirror.jpg"><meta property="og:url" content="https://rotational.io/blog/mocking-the-universe/"><meta property="og:type" content="website"><meta name=twitter:title content="Mocking the Universe: Two Techniques for Testing gRPC with Mocks"><meta name=twitter:card content="summary"><meta name=twitter:description content="Mocking can be an easy way to get around gRPC connections when testing."><meta name=twitter:image content="https://rotational.io/img/blog/2023-03-08-mocking-the-universe/monkey-in-mirror.jpg"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("consent","default",{ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied",functionality_storage:"denied",personalization_storage:"denied"});const _hsp=window._hsp=window._hsp||[];_hsp.push(["addPrivacyConsentListener",function(e){const s=e&&(e.allowed||e.categories&&e.categories.analytics),t=e&&(e.allowed||e.categories&&e.categories.advertisement),n=e&&(e.allowed||e.categories&&e.categories.functionality);gtag("consent","update",{ad_storage:t?"granted":"denied",ad_user_data:t?"granted":"denied",ad_personalization:t?"granted":"denied",analytics_storage:s?"granted":"denied",functionality_storage:n?"granted":"denied",personalization_storage:n?"granted":"denied"})}])</script><script src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW" async defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script async defer src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script><script src=https://kit.fontawesome.com/fea17a4e21.js crossorigin=anonymous></script></head><body><div class="relative bg-[#1D65A6]"><nav class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-5" aria-label=Global><div class="relative max-w-7xl w-full flex flex-wrap lg:flex-nowrap items-center justify-between mx-auto"><a href=/><img src=/img/rototational-white-text-only_hu15583614935666962927.webp alt=Rotational class="h-6 w-auto">
</a><button data-collapse-toggle=navbar-dropdown type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls=navbar-dropdown aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="fa fa-bars text-xl text-white"></i></button><div class="hidden absolute z-[9999] lg:static top-16 w-[92%] md:w-[96%] lg:w-auto lg:block bg-white lg:bg-transparent text-[#192E5B] lg:text-[#F2F2F2] py-2 rounded-md" id=navbar-dropdown><ul class="flex flex-col lg:gap-2 xl:gap-4 md:flex-row font-semibold w-full md:justify-between"><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/about/>About</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><button id=dropdownNavbarLink data-dropdown-toggle=dropdownNavbar class="uppercase flex items-center justify-between gap-x-2 w-full px-3 rounded md:border-0 md:p-0 md:w-auto hover:text-black">
Services
<i class="fa fa-angle-down pt-1"></i></button><div id=dropdownNavbar class="z-10 hidden font-normal bg-[#192E5B] divide-y divide-[#192E5B] rounded-lg shadow w-44"><ul class="py-2 text-sm text-[#F2F2F2]" aria-labelledby=dropdownLargeButton><li><a href=/services/ai-assessments/ class="block px-3 py-2 hover:font-bold">AI Assessments</a></li><li><a href=/services/ai-product-development/ class="block px-3 py-2 hover:font-bold">AI Product Development</a></li><li><a href=/services/ai-ops-and-data-foundations/ class="block px-3 py-2 hover:font-bold">AI Ops & Data Foundations</a></li></ul></div></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/case-studies>Case Studies</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/blog/>Blog</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/learning/>Learning</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/endeavor/>Product</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/contact/>Contact</a></li></ul></div></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=/img/blog/2023-03-08-mocking-the-universe/monkey-in-mirror_hu14433624242230238302.webp alt="Mocking the Universe: Two Techniques for Testing gRPC with Mocks" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="Mocking the Universe: Two Techniques for Testing gRPC with Mocks"><b class=text-[#1D65A6]>Mocking </b>the Universe: Two Techniques for Testing gRPC with Mocks</h3><div class="flex flex-wrap justify-center items-center my-4"><a href=/authors/daniel-sollis><img src=img/team/daniel-sollis.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span><a href=/authors/daniel-sollis>Daniel Sollis</a> | Tuesday, Mar 28, 2023 |&nbsp;
</span><span><a href=/tags/golang>Golang</a>,&nbsp;
</span><a href=/tags/programming>Programming</a>,&nbsp;
</span><a href=/tags/testing>Testing</a>,&nbsp;
</span><a href=/tags/grpc>gRPC</a></span></div><article class="max-w-[800px] mx-auto prose"><p>At Rotational, <a href=https://rotational.io/blog/what-are-protocol-buffers/>we use gRPC</a> <a href=https://rotational.io/blog/documenting-grpc-with-openapi>quite a bit</a>. It&rsquo;s great for specifying network APIs, but can challenge us to find new ways to thoroughly test the code. Follow along with this post to learn two ways of using <a href=https://rotational.io/blog/fake-it-when-you-make-it/>mocking</a> to test gRPC services!</p><h2 id=why-mock>Why Mock?</h2><p>The main reason for using mocks is that they allow you to get around dependencies.</p><p>If you are testing a discrete piece of code, you want to test THAT piece of code, not every dependency it&rsquo;s using as well (hopefully you have separate tests that cover those dependencies ðŸ˜‰).</p><p>The same goes for code using gRPC. When a piece of code calls an RPC, you don&rsquo;t want to have to test the entire <strong>gRPC service</strong> as well as the network (which can be unreliable and <em>super</em> hard to test). But how can we avoid stepping into the implementation details when testing gRPC?</p><p>The easiest way to get around this is to avoid gRPC altogether, with what we at Rotational refer to as <strong>&ldquo;package mocks&rdquo;</strong>. The second technique, which we call <strong>&ldquo;universal mocks&rdquo;</strong>, allows us to directly test gRPC methods in a more structured way. Read on to learn more about both and see some examples.</p><h2 id=package-mocks>Package Mocks</h2><p>In many cases, different gRPC service calls can be isolated into their own packages that contain structs (likely a <strong>gRPC client</strong> or a struct containing the client) that implement the service&rsquo;s procedure calls. By mocking these structs, <strong>&ldquo;package mocks&rdquo;</strong> enable you to avoid not only the <strong>gRPC calls</strong>, but any other dependencies that might show up in the service&rsquo;s implementation.</p><p>Lets imagine we have the following service defined:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>service</span> Database {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>rpc</span> Get(GetRequest) <span style=color:#66d9ef>returns</span> (GetReply) {};<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>rpc</span> Put(PutRequest) <span style=color:#66d9ef>returns</span> (PutReply) {};<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>In our <code>database</code> package (let&rsquo;s imagine it&rsquo;s inside a file called <code>database/database.go</code>) we might have the following struct defined:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Database</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>conf</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>config</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client</span> <span style=color:#a6e22e>DatabaseNetworkClient</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This struct will take care of all of the service&rsquo;s RPC implementation and will also take care of any state (such as configuration or caching) that the service requires. If we add a new interface called <code>Store</code>, which the <code>Database</code> struct implements:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Store</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>GetRequest</span>) <span style=color:#a6e22e>GetReply</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>PutRequest</span>) <span style=color:#a6e22e>PutReply</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can now start defining a &ldquo;package mock&rdquo; that will allow us to circumvent calls to the <code>Database</code> service by creating a new struct that also implements <code>Store</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MockDBGet</span> = <span style=color:#e6db74>&#34;MockDB specified error on call to Get&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MockDBPut</span> = <span style=color:#e6db74>&#34;MockDB specified error on call to Put&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MockDB</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Calls</span>      <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ErrorOn</span>    <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewMockDB</span>(<span style=color:#a6e22e>conf</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>MockDB</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Calls</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span>) <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>GetRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>GetReply</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Calls</span>[<span style=color:#a6e22e>MockDBGet</span>]<span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>ErrorOn</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>MockPeersGet</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>ErrorOn</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>GetReply</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Success</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MockDB</span>) <span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>PutRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>PutReply</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Calls</span>[<span style=color:#a6e22e>MockDBPut</span>]<span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>ErrorOn</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>MockPeersGet</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>ErrorOn</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>PutReply</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Success</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The fields we&rsquo;ve added to the mock struct are particularly useful. By using the <code>Calls</code> map, you can verify that the number of calls you expect have actually happened. With the <code>ErrorOn</code> field, you can trigger any RPC call to fail when needed for testing purposes.</p><h2 id=universal-mocks>Universal Mocks</h2><p>Package mocks work perfectly for testing code that uses the package that we are mocking, but what about testing the package and it&rsquo;s RPC calls directly? This going to require a different technique, which we at Rotational refer to as <strong>&ldquo;universal mocks&rdquo;</strong>.</p><p>When testing a package that implements a <strong>gRPC service</strong> we seemingly won&rsquo;t be able to get around having to deal with RPC calls, which bring with them all of the complications of dealing with an unreliable network and whatever dependencies are part of the RPC handling code on the other side of the network.</p><p>Fortunately for us gRPC comes with a built in solution, the <a href=https://pkg.go.dev/google.golang.org/grpc/test/bufconn>Bufconn package</a>. Bufconn provides a way to get around the network dependency by creating an in-memory buffer that simulates a real <strong>gRPC connection</strong>.</p><p>What about the service at the other end of the connection though? Doesn&rsquo;t that still have dependencies that we don&rsquo;t want to deal with? Well, we can mock it with a <strong>&ldquo;universal mock&rdquo;</strong>.</p><p>Let&rsquo;s go back to our original <strong>Database</strong> definition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Store</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>GetRequest</span>) <span style=color:#a6e22e>GetReply</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>PutRequest</span>) <span style=color:#a6e22e>PutReply</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Database</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>conf</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>config</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>client</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>DatabaseNetworkClient</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In order to test this struct we&rsquo;ll need to create a mocked server with bufconn that this struct&rsquo;s client can connect to, this will be the &ldquo;universal mock&rdquo;, and will look something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>RemoteDB</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>conn</span>        <span style=color:#f92672>*</span><span style=color:#a6e22e>bufconn</span>.<span style=color:#a6e22e>Listener</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>srv</span>         <span style=color:#f92672>*</span><span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Server</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Calls</span>       <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OnGet</span>       <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>GetRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>GetReply</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OnPut</span>       <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>PutRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>PutRequest</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This looks a lot like the Package mock with a few modifications. We keep the <code>Calls</code> map to count specific RPC calls but add a bufconn and <code>grpc.Server</code> to serve with. The <code>OnGet</code> and <code>OnPut</code> field&rsquo;s type is a bit odd and we&rsquo;ll go over those later. Creating a new <code>RemoteDB</code> will be a bit different than with the package mock:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewRemoteDB</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>database</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>RemoteDB</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>conn</span>:  <span style=color:#a6e22e>bufconn</span>.<span style=color:#a6e22e>Listen</span>(<span style=color:#a6e22e>bufsize</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>srv</span>:   <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>NewServer</span>(),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Calls</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>RegisterDatabaseNetworkServer</span>(<span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>srv</span>, <span style=color:#a6e22e>database</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>Serve</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>database</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>Serve</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>srv</span>.<span style=color:#a6e22e>Serve</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conn</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>ClientOptions</span>() (<span style=color:#a6e22e>opts</span> []<span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>DialOption</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create the dialer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>dialer</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Conn</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conn</span>.<span style=color:#a6e22e>Dial</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>opts</span> = append(<span style=color:#a6e22e>opts</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithContextDialer</span>(<span style=color:#a6e22e>dialer</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Disable transport security
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>opts</span> = append(<span style=color:#a6e22e>opts</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithInsecure</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>opts</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In the <code>NewRemoteDB</code> function we have to instantiate a new <code>bufconn</code> and gRPC server that we need to register and serve. We also have an additional function for serving with the gRPC server and a method for returning the preferred <code>gRPC.DialOptions</code> to make connecting to the mocked server easier.</p><p>The final piece of the puzzle is the RPC implementations; this is where those odd field types from before come in:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>GetRequest</span>) (<span style=color:#a6e22e>out</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>GetReply</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Calls</span>[<span style=color:#a6e22e>GetRPC</span>]<span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>OnGet</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>in</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>PutRequest</span>) (<span style=color:#a6e22e>out</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PutRequest</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Calls</span>[<span style=color:#a6e22e>PutRPC</span>]<span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>OnPut</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>in</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The use of the <code>Calls</code> field is largely the same as with the package mock, but we are basically just calling the functions stored on the <code>OnGet</code> and <code>OnPut</code> fields. Because these reference stored functions (which can do arbitrary behavior), this allows us to specify whatever functionality we want the server to have for these RPCs!</p><p>For example if we want the server to simply return an empty reply:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#a6e22e>mock</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewRemoteDB</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>OnGet</span> = <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>GetRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>GetReply</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>GetReply</span>{}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>reply</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>Get</span>()
</span></span></code></pre></div><p>Putting all of this together we get the following universal mock:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>const</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetRPC</span>  = <span style=color:#e6db74>&#34;Database/Get&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>PutRPC</span>  = <span style=color:#e6db74>&#34;Database/Put&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>bufsize</span> = <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>RemoteDB</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>conn</span>        <span style=color:#f92672>*</span><span style=color:#a6e22e>bufconn</span>.<span style=color:#a6e22e>Listener</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>srv</span>         <span style=color:#f92672>*</span><span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Server</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Calls</span>       <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OnGet</span>       <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>GetRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>GetReply</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OnPut</span>       <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>PutRequest</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>PutRequest</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewRemoteDB</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>database</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>RemoteDB</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>conn</span>:  <span style=color:#a6e22e>bufconn</span>.<span style=color:#a6e22e>Listen</span>(<span style=color:#a6e22e>bufsize</span>),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>srv</span>:   <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>NewServer</span>(),
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Calls</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>int</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>RegisterDatabaseNetworkServer</span>(<span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>srv</span>, <span style=color:#a6e22e>database</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>Serve</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>database</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>Serve</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>srv</span>.<span style=color:#a6e22e>Serve</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conn</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>ClientOptions</span>() (<span style=color:#a6e22e>opts</span> []<span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>DialOption</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create the dialer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>dialer</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Conn</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>conn</span>.<span style=color:#a6e22e>Dial</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>opts</span> = append(<span style=color:#a6e22e>opts</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithContextDialer</span>(<span style=color:#a6e22e>dialer</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Disable transport security
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>opts</span> = append(<span style=color:#a6e22e>opts</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithInsecure</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>opts</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>GetRequest</span>) (<span style=color:#a6e22e>out</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>GetReply</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Calls</span>[<span style=color:#a6e22e>GetRPC</span>]<span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>OnGet</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>in</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RemoteDB</span>) <span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>PutRequest</span>) (<span style=color:#a6e22e>out</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PutRequest</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Calls</span>[<span style=color:#a6e22e>PutRPC</span>]<span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>OnPut</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>in</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=connecting-the-universal-mock>Connecting the Universal Mock</h3><p>The last step is to have the <code>Database</code> struct&rsquo;s client to the universal mock. We need to add a method to the struct that handles connecting to an RPC server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Database</span>) <span style=color:#a6e22e>Connect</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>DialOption</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>client</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>cc</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>ClientConn</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cc</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#e6db74>&#34;bufnet&#34;</span>, <span style=color:#a6e22e>opts</span><span style=color:#f92672>...</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not dial database service: %s&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>client</span> = <span style=color:#a6e22e>NewDatabaseNetworkClient</span>(<span style=color:#a6e22e>cc</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>With this method in place, creating and connecting to a universal mock becomes easy as can be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#a6e22e>mock</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewRemoteDB</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>Connect</span>(<span style=color:#a6e22e>mock</span>.<span style=color:#a6e22e>ClientOptions</span>()<span style=color:#f92672>...</span>)
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>At Rotational we frequently use both &ldquo;package mocks&rdquo; and &ldquo;universal mocks&rdquo;. The first allows us to test behavior that would normally engage external gRPC calls without actually having to make external calls. With the second type, we can also get around any gRPC calls by simulating gRPC connection and the expected or resultant behavior.</p><p>Together these techniques have enabled us to more easily test our gRPC services, including those for <a href=https://ensign.rotational.dev/getting-started/>Ensign</a>, our managed eventing platform that takes a lot of the stress out of building microservices. If you&rsquo;re interested in reading more on how we use mocks, check out <a href=https://rotational.io/blog/fake-it-when-you-make-it/>this post next</a>.</p><p>Happy mocking!</p><p><em>Want early access to a platform and community for developers building event-driven apps? Check out our <a href=https://rotational.app/register/>free beta of Ensign</a>.</em></p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About </span>This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">Mocking can be an easy way to get around gRPC connections when testing.</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/daniel-sollis><img src=img/team/daniel-sollis.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span class="flex flex-wrap"><a href=/authors/daniel-sollis class="lg:w-[20ch] mx-2">Daniel Sollis</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><div class="flex items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span class=text-[#1D65A6]>Recommended</span>
&nbsp;Rotations</h2></div><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:my-8"><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/ranges-of-integer-data-types/><img loading=lazy src=/img/blog/num215_hu17749557558912417782.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/ranges-of-integer-data-types/ class=block>Ranges of Integer Data Types</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">The data type choices we make when building data systems or metrics is critically important: as our systems run for long periods of time it can be easy to overflow the integers that we use (Y2K bug anyone?). As a result, I find myself â€¦</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>Sep 7, 2022</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/transparently-mocking-grpc-services/><img loading=lazy src=/img/blog/blue_laser_hu7583231517576374100.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/grpc>gRPC</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/mocks>Mocks</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/transparently-mocking-grpc-services/ class=block>Transparently Mocking gRPC Services</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">gRPC is an effective way of implementing service-to-service APIs. However, there are limited tools available for mocking and testing gRPC services out of the box. One option is to set up a live test server, although this comes with its own â€¦</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/patrick-deziel_hu8906543757154920962.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/patrick-deziel>Patrick Deziel</a></li></ul></div><div class=font-extralight>Jul 8, 2022</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/><img loading=lazy src=/img/blog/2021-02-12-grpc-openapi-docs/gateway_hu12922882535480469414.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/grpc>gRPC</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/ class=block>Documenting a gRPC API with OpenAPI</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">gRPC makes the specification and implementation of networked APIs a snap. But what is the simplest way to <em>document</em> a gRPC API? There seem to be some hosted providers by Google, e.g. <a href=https://cloud.google.com/endpoints/docs/grpc/dev-portal-update-ref-docs>SmartDocs</a>, but I have yet to find a gRPC-specific tool. â€¦</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>Feb 12, 2021</div></div></div></li></ul></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><input type=hidden id=newsletterFormID value=8aeeb77b-a5e0-4772-b726-44e1fc2eb6e1><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start gap-x-2"><input type=checkbox id=checkbox required name=consent class="mt-1 w-4 h-4 block border-0">
<label for=checkbox><span id=consentText>I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><footer class="relative mt-40 md:mt-56 bg-[#192E5B]"><div class="relative w-full pt-36 md:pt-16 lg:pt-24 2xl:pt-20 font-extralight text-white"><div class="-mt-52 w-full mx-auto max-w-screen-xl px-4"><section class="bg-[#72A2C0] w-full p-6 md:py-20 md:px-16"><h2 class="my-4 text-2xl sm:text-3xl md:text-5xl text-white font-extrabold">LET'S ENVISION & BUILD THE FUTURE TOGETHER.</h2><div class=py-6><a href=/contact class="p-3 md:p-4 md:px-6 bg-[#2F4858] font-bold md:text-lg text-white text-center hover:bg-[#2F4858]/80">CONTACT US</a></div></section></div><div class="max-w-7xl mx-auto px-6"><div class="mt-12 flex flex-col md:flex-row lg:justify-between gap-x-8"><div class="my-4 max-w-xs"><h5 class="mb-3 font-extrabold">OUR PRESENCE</h5><p>We share because we care, about topics, tools, and technologies that we believe impact the AI economy.</p><div class=py-4><ul class="flex justify-between items-center gap-x-8"><li><a href=https://twitter.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-x-twitter"></i><p class=sr-only>Twitter</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-linkedin"></i><p class=sr-only>LinkedIn</p></a></li><li><a href=https://github.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-github"></i><p class=sr-only>GitHub</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-youtube"></i><p class=sr-only>YouTube</p></a></li><li><a href=https://www.twitch.tv/rotationallabs target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-twitch"></i><p class=sr-only>Twitch</p></a></li></ul></div></div><div class=my-4><h5 class="mb-3 font-extrabold">COMPANY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/about>About Us</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/case-studies>Case Studies</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/endeavor>Endeavor</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/blog>Blog</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">COMMUNITY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/learning>Learning</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/opensource>Open Source</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">CONTACT US</h5><ul><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-map-marker-alt text-[#757575]"></i>
St. Paul, MN & Washington, DC</li><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-envelope text-[#757575]"></i>
info@rotational.io</li></ul><div class=py-8><a href=/contact class="p-3 bg-[#ECF6FF] font-bold text-black text-center hover:bg-[#ECF6FF]/80">CONTACT US</a></div></div></div><div class="sm:flex justify-between py-6 border-t mt-4"><p>Copyright Â© Rotational Labs, Inc. 2021â€“2025 Â· All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex gap-x-8"><li><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li><li><button id=hs_show_banner_button class=cookie-bttn type=button>
Manage Cookies</button></li></ul></div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/24168101.js></script><script src=https://rotational.io/js/blogSingle.js></script><script src=https://rotational.io/js/newsletterForm.js></script></body></html>