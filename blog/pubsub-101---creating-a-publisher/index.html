<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Rotational Labs | PubSub 101 - Creating a Publisher</title><base href=https://rotational.io/ target=_self><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="In this module you will create a real-time publisher that queries an API and publishes flight data to Ensign."><meta name=keywords content="Rotational Labs,Ensign,Cloud-native,Real-time data streaming platform,Data collaboration,Data automation,Rapid prototyping,Real-time machine learning,Real-time data analytics,Real-time applications,Data streams,Event streams,Event-sourcing databaseEvent log"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="PubSub 101 - Creating a Publisher"><meta property="og:description" content="In this module you will create a real-time publisher that queries an API and publishes flight data to Ensign."><meta property="og:image" content="https://rotational.io/img/blog/press.jpg"><meta property="og:url" content="https://rotational.io/blog/pubsub-101---creating-a-publisher/"><meta property="og:type" content="website"><meta name=twitter:title content="PubSub 101 - Creating a Publisher"><meta name=twitter:card content="summary"><meta name=twitter:description content="In this module you will create a real-time publisher that queries an API and publishes flight data to Ensign."><meta name=twitter:image content="https://rotational.io/img/blog/press.jpg"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css><link rel=stylesheet href=https://unpkg.com/@highlightjs/cdn-assets/styles/default.min.css><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script async src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script>
<script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script><script src=https://unpkg.com/lunr/lunr.js></script></head><body><div class="relative bg-[#1D65A6]"><nav class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-5" aria-label=Global><div class="relative max-w-7xl w-full flex flex-wrap lg:flex-nowrap items-center justify-between mx-auto p-4"><a href=/><img src=img/rototational-white-text-only.png alt=Rotational class="h-6 w-auto"></a>
<button data-collapse-toggle=navbar-dropdown type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls=navbar-dropdown aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="fa fa-bars text-xl text-white"></i></button><div class="hidden absolute z-[9999] lg:static top-16 w-[92%] md:w-[96%] lg:w-auto lg:block bg-white lg:bg-transparent text-[#192E5B] lg:text-[#F2F2F2] py-4 rounded-md" id=navbar-dropdown><ul class="flex flex-col gap-4 md:flex-row font-semibold w-full md:justify-between"><li class="uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-4 py-3.5 hover:text-black" href=/about/>About</a></li><li class="uppercase text-sm lg:text-[15px] xl:text-[17px]"><button id=dropdownNavbarLink data-dropdown-toggle=dropdownNavbar class="uppercase flex items-center justify-between gap-x-2 w-full py-2 px-3 rounded md:border-0 md:p-0 md:w-auto hover:text-black">
Services
<i class="fa fa-angle-down pt-1"></i></button><div id=dropdownNavbar class="z-10 hidden font-normal bg-[#192E5B] divide-y divide-[#192E5B] rounded-lg shadow w-44"><ul class="py-2 text-sm text-[#F2F2F2]" aria-labelledby=dropdownLargeButton><li><a href=/services/ai-assessments/ class="block px-4 py-2 hover:font-bold">AI Assessments</a></li><li><a href class="block px-4 py-2 hover:font-bold">AI Product Development</a></li><li><a href class="block px-4 py-2 hover:font-bold">AI Ops & Data Foundations</a></li></ul></div></li><li class="uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-4 py-3.5 hover:text-black" href=/case-studies>Case Studies</a></li><li class="uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-4 py-3.5 hover:text-black" href=/blog/>Blog</a></li><li class="uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-4 py-3.5 hover:text-black" href=/resources>Learning</a></li><li class="uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-4 py-3.5 hover:text-black" href=/products/>Product</a></li></ul></div></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=https://rotational.io/img/blog/press.jpg alt="PubSub 101 - Creating a Publisher" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="PubSub 101 - Creating a Publisher"><b class=text-[#1D65A6]>PubSub</b>
101 - Creating a Publisher</h3><div class="flex flex-wrap justify-center items-center my-4"><a href=/authors/patrick-deziel><img src=img/team/patrick-deziel.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg"></a>
<span><a href=/authors/patrick-deziel>Patrick Deziel</a> | Tuesday, Nov 28, 2023 |&nbsp;</span>
<span><a href=/tags/ensign>Ensign</a>,&nbsp;</span>
<a href=/tags/ingestion>Ingestion</a>,&nbsp;</span>
<a href=/tags/pubsub-101>PubSub 101</a></span></div><article class="max-w-[800px] mx-auto prose"><p>One of the first steps in every data science or machine learning project is data ingestion. In this module, you will use Python to create a publisher to ingest real-time data into Ensign.</p><p>Check out the previous modules in this series if you haven&rsquo;t already! <a href=https://rotational.io/blog/pubsub-101---creating-your-project/>Module 1</a> shows how to set up your Ensign project, <a href=https://rotational.io/blog/pubsub-101---using-the-python-sdk/>Module 2</a> gets you started with the PyEnsign SDK, and <a href=https://rotational.io/blog/pubsub-101---creating-data-flows-with-topics/>Module 3</a> helps you create your first topic.</p><p>Want to skip to the full code example for this module? You can find it <a href=https://github.com/rotationalio/ensign-examples/tree/main/courses/pubsub_101/module_4_creating_a_publisher>here</a>.</p><h2 id=what-is-a-publisher>What is a Publisher?</h2><p>In Ensign, a publisher is a little piece of code that writes data as a series of <code>events</code> to one or more <code>topics</code>. If you followed along with <a href=https://rotational.io/blog/pubsub-101---using-the-python-sdk/>Module 2</a>, congrats! You&rsquo;ve already written your first publisher. In practice, publishers can do a lot of ingestion-related work on your behalf for a variety of purposes. Here are a few examples of the different types of publishers that you could write for Ensign:</p><ol><li>Poll a REST API of weather data every 5 minutes and publish JSON weather updates to a topic.</li><li>Subscribe to a websocket API for stock trades and publish real-time ticker prices to a topic for data visualization.</li><li>Publish web requests and errors from your backend server(s) so you can monitor user activity on your web application.</li><li>Process video frames from a security camera feed and publish an event when a figure is detected.</li><li>Subscribe to an Ensign topic containing user reviews and publish sentiment scores to another topic.</li></ol><p>Let&rsquo;s return to our flight tracker example that we&rsquo;ve been working on through the last few modules and write some code to publish real-time flight updates.</p><h2 id=creating-a-flights-publisher>Creating a Flights Publisher</h2><p>Recall the data flows design we created in <a href=https://rotational.io/blog/pubsub-101---creating-data-flows-with-topics/>Module 3</a>. In this module we will write the Python code that reads from the flights API and publishes updates to the <code>flight-updates</code> topic.</p><p><img src=/img/blog/2023-11-20-pubsub-101---creating-data-flows-with-topics/topics.png alt="&ldquo;Data Flows&rdquo;"></p><p>⚠️ WARNING: To obtain access to real-time flight data, you will need to create an OpenSky network account (at the time of writing it&rsquo;s free) by registering <a href="https://opensky-network.org/index.php?option=com_users&amp;view=registration">here</a>. Please do that first before moving on to the next section!</p><p>Now that you&rsquo;ve registered for your OpenSky username and password, we&rsquo;re ready to proceed. We could write the HTTP requests directly, but to make our lives easier we&rsquo;ll use the <a href=https://github.com/joostlek/python-opensky>python-opensky</a> library, so go ahead and install that now.</p><pre tabindex=0><code>$ pip install async-timeout
$ pip install python-opensky
</code></pre><p><em>Note: You can also install OpenSky&rsquo;s official <a href=https://github.com/openskynetwork/opensky-api>python implementation</a> but it might not be compatible with the code in this module.</em></p><h3 id=publisher-class>Publisher Class</h3><p>In Python, classes are a helpful way to organize code, especially if this will eventually run in production. So let&rsquo;s create a <code>publisher.py</code> with a <code>FlightsPublisher</code> class.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> asyncio
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyensign.events <span style=color:#f92672>import</span> Event
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pyensign.ensign <span style=color:#f92672>import</span> Ensign
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> aiohttp <span style=color:#f92672>import</span> ClientSession, BasicAuth
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> python_opensky <span style=color:#f92672>import</span> OpenSky, BoundingBox
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FlightsPublisher</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(
</span></span><span style=display:flex><span>        self,
</span></span><span style=display:flex><span>        topic<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flight-positions&#34;</span>,
</span></span><span style=display:flex><span>        min_latitude<span style=color:#f92672>=-</span><span style=color:#ae81ff>66</span>,
</span></span><span style=display:flex><span>        max_latitude<span style=color:#f92672>=</span><span style=color:#ae81ff>49</span>,
</span></span><span style=display:flex><span>        min_longitude<span style=color:#f92672>=-</span><span style=color:#ae81ff>124</span>,
</span></span><span style=display:flex><span>        max_longitude<span style=color:#f92672>=</span><span style=color:#ae81ff>24</span>,
</span></span><span style=display:flex><span>        interval<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>,
</span></span><span style=display:flex><span>    ):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>topic <span style=color:#f92672>=</span> topic
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>bounding_box <span style=color:#f92672>=</span> BoundingBox(
</span></span><span style=display:flex><span>            min_latitude<span style=color:#f92672>=</span>min_latitude,
</span></span><span style=display:flex><span>            max_latitude<span style=color:#f92672>=</span>max_latitude,
</span></span><span style=display:flex><span>            min_longitude<span style=color:#f92672>=</span>min_longitude,
</span></span><span style=display:flex><span>            max_longitude<span style=color:#f92672>=</span>max_longitude,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>interval <span style=color:#f92672>=</span> interval
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>ensign <span style=color:#f92672>=</span> Ensign()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>opensky_creds <span style=color:#f92672>=</span> BasicAuth(
</span></span><span style=display:flex><span>            login<span style=color:#f92672>=</span>os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#39;OPENSKY_USERNAME&#39;</span>],
</span></span><span style=display:flex><span>            password<span style=color:#f92672>=</span>os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#39;OPENSKY_PASSWORD&#39;</span>]
</span></span><span style=display:flex><span>        )
</span></span></code></pre></div><p>Here we setup a few class variables:</p><ol><li><code>topic</code>: The topic our publisher will publish to</li><li><code>bounding_box</code>: The bounding box coordinates for querying the OpenSky API (what area to query for flights over)</li><li><code>interval</code>: The interval to wait in between polling for flight updates</li><li><code>ensign</code>: The Ensign client configured with API credentials from the environment</li><li><code>opensky_creds</code>: OpenSky API credentials obtained from the environment</li></ol><h3 id=creating-events>Creating Events</h3><p>The OpenSky API returns multiple flight &ldquo;vectors&rdquo; per response, so it will be helpful to write a function to turn the vectors into serializable <code>events</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>vectors_to_events</span>(self, vectors):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> vector <span style=color:#f92672>in</span> vectors:
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;icao24&#34;</span>: vector<span style=color:#f92672>.</span>icao24,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;callsign&#34;</span>: vector<span style=color:#f92672>.</span>callsign,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;origin_country&#34;</span>: vector<span style=color:#f92672>.</span>origin_country,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;time_position&#34;</span>: vector<span style=color:#f92672>.</span>time_position,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;last_contact&#34;</span>: vector<span style=color:#f92672>.</span>last_contact,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;longitude&#34;</span>: vector<span style=color:#f92672>.</span>longitude,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;latitude&#34;</span>: vector<span style=color:#f92672>.</span>latitude,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;geo_altitude&#34;</span>: vector<span style=color:#f92672>.</span>geo_altitude,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;on_ground&#34;</span>: vector<span style=color:#f92672>.</span>on_ground,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;velocity&#34;</span>: vector<span style=color:#f92672>.</span>velocity,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;true_track&#34;</span>: vector<span style=color:#f92672>.</span>true_track,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;vertical_rate&#34;</span>: vector<span style=color:#f92672>.</span>vertical_rate,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;sensors&#34;</span>: vector<span style=color:#f92672>.</span>sensors,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;barometric_altitude&#34;</span>: vector<span style=color:#f92672>.</span>barometric_altitude,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;transponder_code&#34;</span>: vector<span style=color:#f92672>.</span>transponder_code,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;special_purpose_indicator&#34;</span>: vector<span style=color:#f92672>.</span>special_purpose_indicator,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;position_source&#34;</span>: vector<span style=color:#f92672>.</span>position_source,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;category&#34;</span>: vector<span style=color:#f92672>.</span>category,
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>yield</span> Event(
</span></span><span style=display:flex><span>                data<span style=color:#f92672>=</span>json<span style=color:#f92672>.</span>dumps(data)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#34;utf-8&#34;</span>),
</span></span><span style=display:flex><span>                mimetype<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>                schema_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;FlightVector&#34;</span>,
</span></span><span style=display:flex><span>                schema_version<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0.1.0&#34;</span>,
</span></span><span style=display:flex><span>            )
</span></span></code></pre></div><p>This function takes an iterable of vectors and returns a generator of JSON-encoded flight updates. It&rsquo;s best practice to include a <code>schema_name</code> and <code>schema_version</code> (as a <a href=https://semver.org/>semantic version</a>) if possible; it will be useful later on if the API changes or you decide that you want to include more metadata, so subscribers know what to expect in each <code>event</code>.</p><p><em>Pro Tip: For data streaming, it&rsquo;s often more efficient to use generator patterns with <code>yield</code> rather than collecting all the events in a list in memory. Your RAM will thank you!</em></p><h3 id=the-publish-loop>The Publish Loop</h3><p>In each iteration of the main loop we will call the API, publish all the flight vectors as <code>events</code> to Ensign, then wait for a bit to stay under the API rate limits.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>recv_and_publish</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># Create topic if it doesn&#39;t exist</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> self<span style=color:#f92672>.</span>ensign<span style=color:#f92672>.</span>ensure_topic_exists(self<span style=color:#f92672>.</span>topic)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>with</span> ClientSession() <span style=color:#66d9ef>as</span> session:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>with</span> OpenSky(session<span style=color:#f92672>=</span>session) <span style=color:#66d9ef>as</span> opensky:
</span></span><span style=display:flex><span>                opensky<span style=color:#f92672>.</span>authenticate(self<span style=color:#f92672>.</span>opensky_creds)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>                    <span style=color:#75715e># Call the OpenSky API to get flight vectors in the bounding box</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                        response <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> opensky<span style=color:#f92672>.</span>get_states(
</span></span><span style=display:flex><span>                            bounding_box<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>bounding_box
</span></span><span style=display:flex><span>                        )
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>                        print(e)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>await</span> asyncio<span style=color:#f92672>.</span>sleep(self<span style=color:#f92672>.</span>interval)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#75715e># Publish each flight vector to Ensign</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> event <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>vectors_to_events(response<span style=color:#f92672>.</span>states):
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>await</span> self<span style=color:#f92672>.</span>ensign<span style=color:#f92672>.</span>publish(
</span></span><span style=display:flex><span>                            self<span style=color:#f92672>.</span>topic,
</span></span><span style=display:flex><span>                            event,
</span></span><span style=display:flex><span>                            on_ack<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>print_ack,
</span></span><span style=display:flex><span>                            on_nack<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>print_nack
</span></span><span style=display:flex><span>                        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>await</span> asyncio<span style=color:#f92672>.</span>sleep(self<span style=color:#f92672>.</span>interval)
</span></span></code></pre></div><p>Note the <code>on_ack</code> and <code>on_nack</code> arguments on the <code>publish</code> function. These are optional but allow you to specify callbacks when Ensign acknowledges an <code>event</code>, meaning it has been committed to the topic, and when Ensign fails to commit an <code>event</code> (a negative acknowledgement). Here we&rsquo;ll define some callbacks that just print out the <code>acks</code> and <code>nacks</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_ack</span>(self, ack):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Event committed with ack: </span><span style=color:#e6db74>{</span>ack<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>print_nack</span>(self, nack):
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Event was not committed with error </span><span style=color:#e6db74>{</span>nack<span style=color:#f92672>.</span>code<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>nack<span style=color:#f92672>.</span>error<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><h3 id=finishing-up-the-publisher>Finishing up the Publisher</h3><p>Finally we need some <code>asyncio</code> boilerplate so we can execute the publish loop from the command line.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run</span>(self):
</span></span><span style=display:flex><span>        asyncio<span style=color:#f92672>.</span>run(self<span style=color:#f92672>.</span>recv_and_publish())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    publisher <span style=color:#f92672>=</span> FlightsPublisher()
</span></span><span style=display:flex><span>    publisher<span style=color:#f92672>.</span>run()
</span></span></code></pre></div><p>If you need to look at the complete code, it&rsquo;s available <a href=https://github.com/rotationalio/ensign-examples/tree/main/courses/pubsub_101/module_4_creating_a_publisher>here</a>.</p><h2 id=running-the-publisher>Running the Publisher</h2><p>Before running the publisher, make sure you have the following environment variables configured!</p><pre tabindex=0><code>$ export ENSIGN_CLIENT_ID=&lt;my-client-id&gt;
$ export ENSIGN_CLIENT_SECRET=&lt;my-client-secret&gt;
$ export OPENSKY_USERNAME=&lt;my-opensky-username&gt;
$ export OPENSKY_PASSWORD=&lt;my-opensky-password&gt;
</code></pre><p>Now run the publisher to start publishing <code>events</code>!</p><pre tabindex=0><code>$ python publisher.py
</code></pre><p>If everything worked, you should see several events being committed (remember the output is coming from the <code>print_ack</code> handler).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Event committed <span style=color:#66d9ef>with</span> ack: id: <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\001\214\035\004</span><span style=color:#e6db74>ju</span><span style=color:#ae81ff>\267\335</span><span style=color:#e6db74>&lt;</span><span style=color:#ae81ff>\204</span><span style=color:#e6db74>G</span><span style=color:#ae81ff>\014</span><span style=color:#e6db74>-</span><span style=color:#ae81ff>\234\030</span><span style=color:#e6db74>V&#34;</span>
</span></span><span style=display:flex><span>committed {
</span></span><span style=display:flex><span>  seconds: <span style=color:#ae81ff>1701293878</span>
</span></span><span style=display:flex><span>  nanos: <span style=color:#ae81ff>211286609</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Event committed <span style=color:#66d9ef>with</span> ack: id: <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\001\214\035\004</span><span style=color:#e6db74>ju</span><span style=color:#ae81ff>\200\232\357</span><span style=color:#e6db74>M</span><span style=color:#ae81ff>\313\345\320\366\007\324</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>committed {
</span></span><span style=display:flex><span>  seconds: <span style=color:#ae81ff>1701293878</span>
</span></span><span style=display:flex><span>  nanos: <span style=color:#ae81ff>213323032</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Event committed <span style=color:#66d9ef>with</span> ack: id: <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\001\214\035\004</span><span style=color:#e6db74>jv</span><span style=color:#ae81ff>\251\035</span><span style=color:#e6db74>]u</span><span style=color:#ae81ff>\034</span><span style=color:#e6db74>i7.</span><span style=color:#ae81ff>\033</span><span style=color:#e6db74>k&#34;</span>
</span></span><span style=display:flex><span>committed {
</span></span><span style=display:flex><span>  seconds: <span style=color:#ae81ff>1701293878</span>
</span></span><span style=display:flex><span>  nanos: <span style=color:#ae81ff>215672990</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>How do we know if it worked? The easiest way is to open the <a href=https://rotational.app/app/projects>project dashboard</a> and navigate to your project, and then the <code>flight-positions</code> topic. On this page you can see how many events were published to the topic and run a query to view the actual events.</p><p><img src=/img/blog/2023-11-28-pubsub-101---creating-a-publisher/topic_dashboard.png alt="&ldquo;Topic Dashboard&rdquo;"></p><h2 id=to-be-continued>To be continued&mldr;</h2><p>Now that you have a flights publisher, in the <a href=/blog/pubsub-101---creating-a-subscriber/>next module</a> you&rsquo;ll write a subscriber to consume the flight updates in real time!</p><div class="border-t my-12"></div><p>Photo by Bank Phrom on Unsplash</p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About</span>
This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">In this module you will create a real-time publisher that queries an API and publishes flight data to Ensign.</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/patrick-deziel><img src=img/team/patrick-deziel.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg"></a>
<span class="flex flex-wrap"><a href=/authors/patrick-deziel class="lg:w-[20ch] mx-2">Patrick Deziel</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><div class="flex items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span class=text-[#1D65A6]>Recommended</span>
&nbsp;Rotations</h2><img src=img/butterfly.png alt=butterfly class="ml-4 h-6 sm:h-8"></div><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><div class="grid lg:grid-cols-2 xl:grid-cols-3 gap-8 sm:mt-16"><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/pubsub-101---querying-topics/><img src=https://rotational.io/img/blog/otter_investigator.png alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ensign>Ensign</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ensql>enSQL</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/pubsub-101>PubSub 101</a></li></ul><h3 class="text-xl font-extrabold mt-3 md:mt-4 pb-2"><a class="block h-auto lg:h-24" href=https://rotational.io/blog/pubsub-101---querying-topics/>PubSub 101 - Querying Topics with SQL</a></h3><div class='h-auto lg:h-36'><p class="mt-3 md:mt-4 text-base">Real-time data streams are powerful, but sometimes you need to convert the stream into a batch or replay parts of the stream. Here&rsquo;s how to write customized SQL to more deeply understand and interact with your historic data.</p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6 xl:mt-8"><div class="flex items-center"><img src=img/team/patrick-deziel.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/patrick-deziel>Patrick Deziel</a></li></ul></div><div class=font-extralight>Dec 8, 2023</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/pubsub-101---creating-a-subscriber/><img src=https://rotational.io/img/blog/newspaper.jpg alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ensign>Ensign</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/online-learning>Online Learning</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/pubsub-101>PubSub 101</a></li></ul><h3 class="text-xl font-extrabold mt-3 md:mt-4 pb-2"><a class="block h-auto lg:h-24" href=https://rotational.io/blog/pubsub-101---creating-a-subscriber/>PubSub 101 - Creating a Subscriber</a></h3><div class='h-auto lg:h-36'><p class="mt-3 md:mt-4 text-base">With the rise of LLMs and Retrieval Augmented Generation (RAG), online models have never been more relevant. Here&rsquo;s how to write some Python code to interpret real-time data and build your own adaptive online model.</p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6 xl:mt-8"><div class="flex items-center"><img src=img/team/patrick-deziel.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/patrick-deziel>Patrick Deziel</a></li></ul></div><div class=font-extralight>Dec 5, 2023</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/pubsub-101---creating-data-flows-with-topics/><img src=https://rotational.io/img/blog/waterfall.jpg alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ensign>Ensign</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/data-streaming>Data Streaming</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/pubsub-101>PubSub 101</a></li></ul><h3 class="text-xl font-extrabold mt-3 md:mt-4 pb-2"><a class="block h-auto lg:h-24" href=https://rotational.io/blog/pubsub-101---creating-data-flows-with-topics/>PubSub 101 - Creating Data Flows With Topics</a></h3><div class='h-auto lg:h-36'><p class="mt-3 md:mt-4 text-base">If you struggle to build analytics and models that keep up with changing data, it might be because you haven&rsquo;t yet learned to think about data in terms of <code>topics</code>. In this module, learn how by solving a real-world, real-time problem!</p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6 xl:mt-8"><div class="flex items-center"><img src=img/team/patrick-deziel.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/patrick-deziel>Patrick Deziel</a></li></ul></div><div class=font-extralight>Nov 22, 2023</div></div></div></div></div></div></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start gap-x-2"><input type=checkbox id=checkbox required class="mt-1 w-4 h-4 block border-0">
<label for=checkbox><span>I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><footer class="relative mt-40 md:mt-56 bg-[#192E5B]"><div class="relative w-full pt-36 md:pt-16 lg:pt-24 2xl:pt-20 font-extralight text-white"><div class="-mt-52 w-full mx-auto max-w-screen-xl px-4"><section class="bg-[#72A2C0] w-full p-6 md:py-20 md:px-16"><h2 class="my-4 text-2xl sm:text-3xl md:text-5xl text-white font-extrabold">LET'S ENVISION & BUILD THE FUTURE TOGETHER.</h2><div class=py-6><a href=mailto:hello@rotational.ai class="p-3 md:p-4 md:px-6 bg-[#2F4858] font-bold md:text-lg text-white text-center hover:bg-[#2F4858]/80">CONTACT US</a></div></section></div><div class="max-w-7xl mx-auto px-6"><div class="mt-12 flex flex-col md:flex-row lg:justify-between gap-x-8"><div class="my-4 max-w-xs"><h5 class="mb-3 font-extrabold">OUR PRESENCE</h5><p>We share because we care, about topics, tools, and technologies that we believe impact the AI economy.</p><div class=py-4><ul class="flex justify-between items-center gap-x-8"><li><a href=https://twitter.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-x-twitter"></i><p class=sr-only>Twitter</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-linkedin"></i><p class=sr-only>LinkedIn</p></a></li><li><a href=https://github.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-github"></i><p class=sr-only>GitHub</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-youtube"></i><p class=sr-only>YouTube</p></a></li><li><a href=https://www.twitch.tv/rotationallabs target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-twitch"></i><p class=sr-only>Twitch</p></a></li></ul></div></div><div class=my-4><h5 class="mb-3 font-extrabold">COMPANY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/about>About Us</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/services>Services</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/case-studies>Case Studies</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/products>Product</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/blog>Blog</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">COMMUNITY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/resources>Learning</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/opensource>Open Source</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/ensign-u>Ensign U</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">CONTACT US</h5><ul><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-map-marker-alt text-[#757575]"></i>
St. Paul, MN & Washington, DC</li><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-envelope text-[#757575]"></i>
hello@rotational.ai</li></ul><div class=py-8><a href=mailto:hello@rotational.ai class="p-3 bg-[#ECF6FF] font-bold text-black text-center hover:bg-[#ECF6FF]/80">CONTACT US</a></div></div></div><div class="sm:flex justify-between py-6 border-t mt-4"><p>Copyright © Rotational Labs, Inc. 2021–2024 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex gap-x-8"><li><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></footer><script src=https://unpkg.com/embla-carousel/embla-carousel.umd.js></script>
<script src=https://rotational.io/js/app.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js></script>
<script src=https://unpkg.com/@highlightjs/cdn-assets/highlight.min.js></script></body></html>