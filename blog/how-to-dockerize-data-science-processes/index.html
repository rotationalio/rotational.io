<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Rotational Labs | How to Dockerize Python Data Science Processes</title><base href=https://rotational.io/ target=_self><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="Docker is good for containerizing jobs and services, but most tutorials focus on web apps and microservices. This post is for data scientists! It contains a Python Dockerfile to use as a reference when creating your containers with scientific and numeric computing dependencies for data transformations, ETLs, inferencing, and other statistical analyses."><meta name=keywords content="Rotational Labs,Ensign,Cloud-native,Real-time data streaming platform,Data collaboration,Data automation,Rapid prototyping,Real-time machine learning,Real-time data analytics,Real-time applications,Data streams,Event streams,Event-sourcing databaseEvent log"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="How to Dockerize Python Data Science Processes"><meta property="og:description" content="Docker is good for containerizing jobs and services, but most tutorials focus on web apps and microservices. This post is for data scientists! It contains a Python Dockerfile to use as a reference when creating your containers with scientific and numeric computing dependencies for data transformations, ETLs, inferencing, and other statistical analyses."><meta property="og:image" content="https://rotational.io/img/blog/2023-09-14-dockerize-data-science/container.webp"><meta property="og:url" content="https://rotational.io/blog/how-to-dockerize-data-science-processes/"><meta property="og:type" content="website"><meta name=twitter:title content="How to Dockerize Python Data Science Processes"><meta name=twitter:card content="summary"><meta name=twitter:description content="Docker is good for containerizing jobs and services, but most tutorials focus on web apps and microservices. This post is for data scientists! It contains a Python Dockerfile to use as a reference when creating your containers with scientific and numeric computing dependencies for data transformations, ETLs, inferencing, and other statistical analyses."><meta name=twitter:image content="https://rotational.io/img/blog/2023-09-14-dockerize-data-science/container.webp"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css><link rel=stylesheet href=https://unpkg.com/@highlightjs/cdn-assets/styles/default.min.css><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script async src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script>
<script>grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute("6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk",{action:"homepage"}).then(function(){})})</script><script src=https://kit.fontawesome.com/2c36e9b7b1.js crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr/lunr.js></script></head><body class="bg-hexagon bg-center bg-contain"><div class="relative bg-[#1D65A6]"><nav class="relative max-w-7xl mx-auto flex items-center justify-between text-white px-4 sm:px-6 z-[9999] py-5" aria-label=Global><a href=/><img src=img/logo.png alt="Rotational Lab logo" class="h-14 w-auto sm:h-14"></a><ul class=topnav id=myTopnav><li><a href=/services/>Services</a></li><li><a href=/products/>Products</a></li><li><a href=/blog/>Blog</a></li><li><a href=/about/>About</a></li><li><a href=/contact/>Contact Us</a></li><a class=icon onclick=openMobNav()><i class="fa fa-bars"></i></a></ul></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=https://rotational.io/img/blog/2023-09-14-dockerize-data-science/container.webp alt="How to Dockerize Python Data Science Processes" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="How to Dockerize Python Data Science Processes"><b class=text-[#1D65A6]>How</b>
to Dockerize Python Data Science Processes</h3><div class="flex flex-wrap justify-center items-center my-4"><a href=/authors/benjamin-bengfort><img src=img/team/benjamin-bengfort.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg"></a>
<span><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a> | Thursday, Sep 14, 2023 |&nbsp;</span>
<span><a href=/tags/docker>Docker</a>,&nbsp;</span>
<a href=/tags/data-science>Data Science</a>,&nbsp;</span>
<a href=/tags/python>Python</a></span></div><article class="max-w-[800px] mx-auto prose"><p>Docker is great, but most tutorials are geared toward devOps users, not data scientists. If you&rsquo;re building long-running processes for NLP, ML, or generative AI, here&rsquo;s a blueprint for Python Docker containers for data science!</p><p>But before we get any further, if you&rsquo;re using this as a reference to get a Python <code>Dockerfile</code>, here are the code snippets you&rsquo;re looking for:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> python:3.11-slim</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Do not prompt during apt-get commands</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> DEBIAN_FRONTEND<span style=color:#f92672>=</span>noninteractive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ensure output to stdout and stderr are written to the terminal without a buffer</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> PYTHONUNBUFFERED <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Add library dependencies for compiling data science python packages</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\\</span>
</span></span><span style=display:flex><span>    apt-get install --no-install-recommends -y gcc libc-dev build-essential python3-dev<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Create a user so that we don&#39;t run as root</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> groupadd -r myuser <span style=color:#f92672>&amp;&amp;</span> useradd -m -r -g myuser myuser<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> myuser</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set the working directory where Python code will be stored</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir /home/myuser/app<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /home/myuser/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Install Python dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./requirements.txt /requirements.txt<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip3 install --no-cache-dir wheel<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip3 install --no-cache-dir -r /requirements.txt<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Switch back to root to clean up after the build process</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> root</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get clean autoclean <span style=color:#f92672>&amp;&amp;</span> apt-get autoremove --yes <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\\</span>
</span></span><span style=display:flex><span>    rm -rf /var/lib/apt/lists/*<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Switch back to non-root user and copy Python code</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> myuser</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./ ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Default command is a python3 interpreter</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;python3&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>By default, this Dockerfile will open a python interpreter when run, but you can run override the <code>CMD</code> by specifying a different command as an argument to <code>docker run</code>. For example, if you build this image and tag it as <code>myapp:latest</code> you could run your <code>main.py</code> file as follows:</p><pre tabindex=0><code>$ docker run myapp:latest python3 main.py
</code></pre><p>Note that we routinely update this Dockerfile for best practices as we learn them. If you would like to comment on the code or otherwise edit it, you can find the <a href=https://gist.github.com/bbengfort/28a82540c4af38fe9d8aed56c913aebe>Dockerfile on this gist</a>.</p><h3 id=docker-ignore>Docker Ignore</h3><p>The <code>.dockerignore</code> file is an essential part of Python containerization because it reduces the number of files that are copied to the image, thus reducing the overall image size. In particular, it&rsquo;s a good idea to ignore the <code>.git</code> folder since the image will not contain <code>git</code> or run any <code>git</code> commands. An example <code>.dockerignore</code> file for Python data science applications is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># Ignore docker specific files</span>
</span></span><span style=display:flex><span>.dockerignore
</span></span><span style=display:flex><span>docker-compose.yml
</span></span><span style=display:flex><span>Dockerfile
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ignore git directory and files</span>
</span></span><span style=display:flex><span>.gitignore
</span></span><span style=display:flex><span>.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ignore text files at the root of the project (optional)</span>
</span></span><span style=display:flex><span>LICENSE
</span></span><span style=display:flex><span>README.md
</span></span><span style=display:flex><span>DESCRIPTION.md
</span></span><span style=display:flex><span>CONTRIBUTING.md
</span></span><span style=display:flex><span>SECURITY.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ignore local environment and secrets</span>
</span></span><span style=display:flex><span>.python-version
</span></span><span style=display:flex><span>.env
</span></span><span style=display:flex><span>.env.template
</span></span><span style=display:flex><span>.secret
</span></span></code></pre></div><h3 id=docker-compose>Docker Compose</h3><p>Docker Compose is an excellent tool for running multi-container applications; for example if you have a database that you&rsquo;d like to containerize to test locally. A <code>docker-compose.yml</code> file allows you to define services to build and run. Below is an example of a <code>docker-compose.yml</code> file that has a configuration for our app defined in the <code>Dockerfile</code> above.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>app</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>.:/home/myuser/app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: &gt;<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      sh -c &#34;python3 main.py&#34;</span>      
</span></span></code></pre></div><p>Note that this file runs the <code>python3 main.py</code> command in order to override the image command and also links a the local directory to the working directory of the app with the <code>volumes</code> directive. This linking allows changes in your local directory to be detected by the app if you have a reloader in your program such as with Flask or Django applications.</p><h2 id=docker-for-data-science>Docker for Data Science</h2><p>Docker containers are lightweight, infrastructure-agnostic, standalone, executable packages (images) that include everything needed to run a piece of software including the code, runtime, libraries, and dependencies. Containers are a form of virtualization technology that ensure code can be run in an isolated environment so that dependencies and operating system considerations can be abstracted away such that multiple applications can run in isolated environments on the same hardware.</p><p>Because of these properties, containers are an easy and flexible way to deploy and run applications on a compute cluster, particularly Kubernetes clusters. Note that Docker and and Kubernetes are not the only containerization techologies that exist, but are the most popular at the time of this writing.</p><p>For data scientists, containers can be used to:</p><ol><li>Periodically ingest data from external data sources</li><li>Run data transformation jobs and ETLs</li><li>Synchronize databases and datasets</li><li>Scale model training and hyperparameter tuning</li><li>Create inferencing services for machine learning models</li></ol><p>The defining characteristic of these types of jobs? They probably need to be run in a production location outside of a Jupyter notebook!</p><h3 id=scheduled-jobs>Scheduled Jobs</h3><p>Consider the following Python program in <code>main.py</code> that runs a series of jobs at a pre-defined schedule using the <a href=https://schedule.readthedocs.io/en/stable/>schedule</a> library:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> schedule
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> myapp <span style=color:#f92672>import</span> report, ingest, health_check
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>  schedule<span style=color:#f92672>.</span>every()<span style=color:#f92672>.</span>hour<span style=color:#f92672>.</span>do(ingest)
</span></span><span style=display:flex><span>  schedule<span style=color:#f92672>.</span>every(<span style=color:#ae81ff>5</span>)<span style=color:#f92672>.</span>minutes<span style=color:#f92672>.</span>do(health_check)
</span></span><span style=display:flex><span>  schedule<span style=color:#f92672>.</span>every()<span style=color:#f92672>.</span>day<span style=color:#f92672>.</span>at(<span style=color:#e6db74>&#34;9:15&#34;</span>, <span style=color:#e6db74>&#34;America/New_York&#34;</span>)<span style=color:#f92672>.</span>do(report)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    schedule<span style=color:#f92672>.</span>run_pending()
</span></span><span style=display:flex><span>    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>15</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>  main()
</span></span></code></pre></div><p>This script is a long-running process that every 15 seconds checks to see if one of the scheduled jobs should be run. The example shows that data should be ingested every hour, a health check run every 5 minutes, and a report run every day at 9:15am ET. A long running task like this is meant to be run forever on a stable computer and restarted when it fails &ndash; Docker containers make it easy to deploy these types of processes.</p><p><strong>NOTE:</strong> This script is an example only; there are many ways to schedule jobs to be executed using Docker containers, such as <a href=https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/><code>CronJob</code></a> on a Kubernetes cluster.</p><h3 id=challenges>Challenges</h3><p>The primary issue with data science code and Docker containers is compiling and building scientific and numeric computing dependencies. Most of the <code>scipy</code> and <code>numpy</code> based tools that we use have CPython dependencies that depend on the presence of a C compiler and <code>libpython</code>. Machine learning libraries have dependencies on other C libraries such as <code>libsvm</code> and <code>libblas</code> or <code>lapack</code> for linear algebra computation.</p><p>The good news is that Docker containers allow for reusability and operating-system agnostic compilation. If your team is having trouble installing dependencies then Docker containers can be a good way to share code for development. The bad news is that you have to figure out how to create a container that supports these dependencies, and that is where this blog post comes in!</p><h2 id=dockerfile-step-by-step>Dockerfile, Step-By-Step</h2><p>In this section, I&rsquo;ll go over how we made the choices for our <code>Dockerfile</code> and discuss ways that you can adapt the above <code>Dockerfile</code> to your specific usage.</p><p><strong>1. Base Image</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> python:3.11-slim</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>The base image we selected was <code>python:3.11-slim</code>. When selecting a base image there is a trade-off between how much setup work is done for you and the size of the final image. Smaller image sizes are generally better because images often have to be stored in the cloud (which has volume based processing) and smaller images are generally loaded and run more quickly.</p><p>The <code>python:3.11-slim</code> image is a Debian-based image, which allows us to use <code>apt-get</code> commands to install the C dependencies we need, but the <code>slim</code> version keeps it lightweight. This image also already has Python installed, which reduces the amount of work we need to do. You can change the <a href=https://hub.docker.com/_/python>version of Python used in the image</a>, but we recommend using <code>slim</code> or a Debian-specific variant of slim such as <code>bookworm-slim</code>.</p><p><strong>2. Environment</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#75715e># Do not prompt during apt-get commands</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> DEBIAN_FRONTEND<span style=color:#f92672>=</span>noninteractive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ensure output to stdout and stderr are written to the terminal without a buffer</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> PYTHONUNBUFFERED <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>I try to put <a href=https://docs.docker.com/build/guide/build-args/>build arguments</a> and environment variables at the top of Dockerfiles since they influence not just the runtime but also the buildtime of the Docker container.</p><p>The <code>DEBIAN_FRONTEND</code> variable ensures that we are not prompted to continue when using <code>apt-get</code> commands; though this can also be achieved with the <code>--yes</code> flag.</p><p>The <code>PYTHONUNBUFFERED</code> environment variable ensures that Python writes directly to <code>stdout</code> and <code>stderr</code> without buffering the output in memory. Buffers are usually good idea for environments where multiple processes are running and to ensure efficiencies of writes. However, Docker containers are isolated and immediately writing ensures that no output is lost when a container crashes or restarts.</p><p><strong>3. Install external, non-Python dependencies</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#75715e># Add library dependencies for compiling data science python packages</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\\</span>
</span></span><span style=display:flex><span>    apt-get install --no-install-recommends -y gcc libc-dev build-essential python3-dev<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>This is the section where we can install the C dependencies we need to compile our code effectively. I&rsquo;ve included some basic dependencies but you can add others here as necessary. For example, if you&rsquo;ll be compiling <code>psycopg2</code> for PostgreSQL database access, you will likely want to add <code>libpq</code> to the list of dependencies.</p><p>Note that this step has to be run as root so don&rsquo;t switch to a different user before executing this step!</p><p><strong>4. Don&rsquo;t run as root</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#75715e># Create a user so that we don&#39;t run as root</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> groupadd -r myuser <span style=color:#f92672>&amp;&amp;</span> useradd -m -r -g myuser myuser<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> myuser</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set the working directory where Python code will be stored</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir /home/myuser/app<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /home/myuser/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>For security purposes, you should avoid running your Python applications as the root user, following the <a href=https://en.wikipedia.org/wiki/Principle_of_least_privilege>principle of least privilege</a>. This will make your production environments much safer since an attack on your program cannot leak to the outside host.</p><p>In this snippet we&rsquo;re creating a user and group called <code>myuser</code> (which you can change to whatever makes sense for your app) and creating our workspace in that user&rsquo;s home directory in a subdirectory called <code>app</code>.</p><p><strong>5. Install Python dependencies</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#75715e># Install Python dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./requirements.txt /requirements.txt<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip3 install --no-cache-dir wheel<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip3 install --no-cache-dir -r /requirements.txt<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>The next step is to install the dependencies from our <code>requirements.txt</code> file. First we install the <a href=https://realpython.com/python-wheels/><code>wheel</code> package</a> to ensure that we simplify and speed up the installation of our dependencies that were distributed with wheels. Note that we use the <code>--no-cache-dir</code> directive here to ensure that we do not save the downloaded packages locally, thus reducing the size of our Python image.</p><p><strong>6. Cleanup installation</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#75715e># Switch back to root to clean up after the build process</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> root</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get clean autoclean <span style=color:#f92672>&amp;&amp;</span> apt-get autoremove --yes <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\\</span>
</span></span><span style=display:flex><span>    rm -rf /var/lib/apt/lists/*<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Now that we&rsquo;re done installing and compiling our Python resources, we can clean up our Debian environment, again to reduce our image size as much as possible. These <code>apt-get</code> commands need to be run s root, so we will briefly switch back to the <code>root</code> user before continuing with the user we created.</p><p><strong>7. Finalize Build</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#75715e># Switch back to non-root user and copy Python code</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> myuser</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./ ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Default command is a python3 interpreter</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;python3&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>The last step is to switch back to our local user and to copy all of our Python files and modules from our project. This <code>Dockerfile</code> has a default command of running a Python interpreter, which is good for development, but you probably want to change your <code>CMD</code> to something more specific for your long running process.</p><h2 id=faq>FAQ</h2><p>Some common questions that I&rsquo;ve received will be added to this section. If you have a question, please don&rsquo;t hesitate to <a href=https://rotational.io/contact/>contact us</a> and we&rsquo;ll add your question to the FAQ!</p><h3 id=why-not-use-multi-stage-builds>Why not use multi-stage builds?</h3><p><a href=https://docs.docker.com/build/building/multi-stage/>Multi-stage builds</a> are another technique to optimize Dockerfiles and reduce image size. They allow you add build-time dependencies that are not present in the final image.</p><p>We could create a Python multi-stage image where we use a build step to install everything into a virtual environment, then copy the virtual environment into our final step. However, many data science dependencies that require C compilation load shared objects at runtime from linked-libraries. Since these shared objects would have to be copied as well, we stuck with a single stage build.</p><div class="border-t my-12"></div><p>Photo by Venti Views on Unsplash</p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About</span>
This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">Docker is good for containerizing jobs and services, but most tutorials focus on web apps and microservices. This post is for data scientists! It contains a Python Dockerfile to use as a reference when creating your containers with scientific and numeric computing dependencies for data transformations, ETLs, inferencing, and other statistical analyses.</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/benjamin-bengfort><img src=img/team/benjamin-bengfort.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg"></a>
<span class="flex flex-wrap"><a href=/authors/benjamin-bengfort class="lg:w-[20ch] mx-2">Benjamin Bengfort</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span><b class=text-[#1D65A6]>Recent</b>
Rotations</span>
<img src=img/butterfly.png alt=butterfly class="ml-4 h-6 sm:h-8 relative top-1"></h2><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><div class="grid lg:grid-cols-2 xl:grid-cols-3 gap-8 sm:mt-16"><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/5-javascript-libraries-to-use-for-machine-learning/><img src=https://rotational.io/img/blog/2024-03-11-javascript-libraries-to-use-for-machine-learning/5-javascript-libraries-to-use-for-machine-learning.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/ml>ML</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/nlp>NLP</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/neural-networks>Neural Networks</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/javascript>JavaScript</a></li></ul><h3 class="text-xl font-extrabold mt-3 md:mt-4 pb-2"><a class="block h-auto lg:h-24" href=https://rotational.io/blog/5-javascript-libraries-to-use-for-machine-learning/>5 Javascript Libraries to Use for Machine Learning</a></h3><div class='h-auto lg:h-36'><p class="mt-3 md:mt-4 text-base">Over the years, several JavaScript libraries have been created for machine learning. Let&rsquo;s sort through the ones that can help you get started quickly, even if you don&rsquo;t have much experience with machine learning or data …</p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6 xl:mt-8"><div class="flex items-center"><a href=/authors/danielle-maxwell class="flex items-center"><img src=img/team/danielle-maxwell.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Danielle Maxwell</span></a></div><div class=font-extralight>Mar 11, 2024</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/predicting-the-oscars-with-llms/><img src=https://rotational.io/img/blog/trophies.jpg alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/llms>LLMs</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/semantic-similarity>Semantic Similarity</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/python>Python</a></li></ul><h3 class="text-xl font-extrabold mt-3 md:mt-4 pb-2"><a class="block h-auto lg:h-24" href=https://rotational.io/blog/predicting-the-oscars-with-llms/>Predicting the Oscars With LLMs</a></h3><div class='h-auto lg:h-36'><p class="mt-3 md:mt-4 text-base">Looking for a middle ground between custom LLMs and traditional ML? Please welcome semantic search to the stage! Let&rsquo;s use semantic search to predict which film will take home the &ldquo;Best Picture&rdquo; Oscar this year 🤩</p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6 xl:mt-8"><div class="flex items-center"><a href=/authors/patrick-deziel class="flex items-center"><img src=img/team/patrick-deziel.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Patrick Deziel</span></a></div><div class=font-extralight>Mar 8, 2024</div></div></div></div></div><div class=mt-6><div class=article><a class=block href=https://rotational.io/blog/how-to-manage-overwhelm/><img src=https://rotational.io/img/blog/2024-02-13-how-to-manage-overwhelm/how-to-manage-overwhelm.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="bg-[#ECF6FF] rounded-b-xl"><div class="px-6 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/career>Career</a></li></ul><h3 class="text-xl font-extrabold mt-3 md:mt-4 pb-2"><a class="block h-auto lg:h-24" href=https://rotational.io/blog/how-to-manage-overwhelm/>How to Manage Overwhelm</a></h3><div class='h-auto lg:h-36'><p class="mt-3 md:mt-4 text-base">Each morning, I make the mistake of checking social media before getting out of bed. As I catch up on what’s happening in the world, I often find myself thinking “This too much” all before 8 AM.</p></div></div><div class="flex justify-between items-center px-6 py-3 border-t mt-6 xl:mt-8"><div class="flex items-center"><a href=/authors/danielle-maxwell class="flex items-center"><img src=img/team/danielle-maxwell.png alt class="rounded-full h-10 w-10">
<span class="ml-4 font-extralight">Danielle Maxwell</span></a></div><div class=font-extralight>Feb 13, 2024</div></div></div></div></div></div></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start"><input type=checkbox id=checkbox required class="w-6 h-6 block border-0">
<label for=checkbox><span class="ml-2 text-left">I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><div id=footerBackground><footer class="bg-hero-footer bg-cover"><div class="pt-[350px] font-extralight text-white"><div class="max-w-7xl mx-auto px-6"><div class="max-[650px]:text-center sm:grid grid-cols-3"><div class="my-10 sm:my-0"><h5 class=mb-3>PRODUCT</h5><ul><li class=pb-3><a href=https://rotational.app target=_blank class=font-bold>Ensign</a></li><li class=pb-3><a href=/ensign-pricing target=_blank class=font-bold>Pricing</a></li><li class=pb-3><a href=https://ensign.rotational.dev/getting-started/ target=_blank class=font-bold>Docs</a></li><li class=pb-3><a href=https://ensign.rotational.dev/sdk/ target=_blank class=font-bold>SDKs</a></li><li class=pb-3><a href=https://status.rotational.dev/ target=_blank class=font-bold>Status</a></li></ul></div><div class="mb-10 sm:mb-0"><h5 class=mb-3>COMPANY</h5><ul><li class=pb-3><a href=/services class=font-bold>Services</a></li><li class=pb-3><a href=/blog class=font-bold>Blog</a></li><li class=pb-3><a href=/about class=font-bold>About</a></li></ul></div><div><h5 class=mb-3>COMMUNITY</h5><ul><li class=pb-3><a href=/ensign-u class=font-bold>Ensign U</a></li><li class=pb-3><a href=/data-playground class=font-bold>Data Playground</a></li><li class=pb-3><a href=/opensource class=font-bold>Open Source</a></li><li class=pb-3><a href=/resources class=font-bold>Resources</a></li></ul></div></div><div class="max-w-7xl sm:flex justify-center border-t py-6 mt-12 sm:mt-32"><div class="mx-auto xl:ml-5"><div><ul class="grid gap-8 sm:flex justify-center lg:gap-28 xl:gap-36"><li><a href=https://twitter.com/rotationalio target=_blank class="flex items-center gap-2 hover:text-[#1D65A6]"><i class="text-2xl fa fa-twitter"></i><p>Twitter</p></a></li><li><a href=https://github.com/rotationalio target=_blank class="flex items-center gap-2 hover:text-[#1D65A6]"><i class="text-2xl fa fa-github"></i><p>GitHub</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class="flex items-center gap-2 hover:text-[#1D65A6]"><i class="text-2xl fa fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class="flex items-center gap-2 hover:text-[#1D65A6]"><i class="text-2xl fa fa-youtube"></i><p>YouTube</p></a></li><li><a href=mailto:info@rotational.io target=_blank class="flex items-center gap-2 hover:text-[#1D65A6]"><i class="text-2xl fa fa-envelope"></i><p>Email</p></a></li></ul></div></div></div><div class="sm:flex justify-between py-6"><p>Copyright © Rotational Labs, Inc. 2021–2024 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex"><li class="border-r pr-4 mr-4"><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></div></footer></div><script src=https://rotational.io/js/app.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js></script>
<script src=https://unpkg.com/@highlightjs/cdn-assets/highlight.min.js></script></body></html>