<!doctype html><html lang=en-us><head><meta charset=UTF-8><title>Rotational Labs | What Are Protocol Buffers?</title>
<base href=https://rotational.io/ target=_self><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="Protocol buffers are a method for serializing data to efficiently send between programs. In this post, we'll explore some use cases for protobufs and learn the syntax."><meta name=keywords content="ai for companies,ai software,ai consulting,ai solutions,ai development,enterprise ai,ai services,ai platform,ai applications,ai for business,artificial intelligence solutions,artificial intelligence consulting"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="What Are Protocol Buffers?"><meta property="og:description" content="Protocol buffers are a method for serializing data to efficiently send between programs. In this post, we'll explore some use cases for protobufs and learn the syntax."><meta property="og:image" content="https://rotational.io/img/blog/2021-05-19-what-are-protocol-buffers/migration.jpg"><meta property="og:url" content="https://rotational.io/blog/what-are-protocol-buffers/"><meta property="og:type" content="website"><meta name=twitter:title content="What Are Protocol Buffers?"><meta name=twitter:card content="summary"><meta name=twitter:description content="Protocol buffers are a method for serializing data to efficiently send between programs. In this post, we'll explore some use cases for protobufs and learn the syntax."><meta name=twitter:image content="https://rotational.io/img/blog/2021-05-19-what-are-protocol-buffers/migration.jpg"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/24168101.js></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("consent","default",{ad_storage:"denied",ad_user_data:"denied",ad_personalization:"denied",analytics_storage:"denied",functionality_storage:"denied",personalization_storage:"denied"});const hspConsent=window._hsp=window._hsp||[];hspConsent.push(["addPrivacyConsentListener",function(e){const s=e&&(e.allowed||e.categories&&e.categories.analytics),t=e&&(e.allowed||e.categories&&e.categories.advertisement),n=e&&(e.allowed||e.categories&&e.categories.functionality);gtag("consent","update",{ad_storage:t?"granted":"denied",ad_user_data:t?"granted":"denied",ad_personalization:t?"granted":"denied",analytics_storage:s?"granted":"denied",functionality_storage:n?"granted":"denied",personalization_storage:n?"granted":"denied"})}])</script><script src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW" async defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2FKX6CWJHW")</script><script async defer src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script><script src=https://kit.fontawesome.com/fea17a4e21.js crossorigin=anonymous></script></head><body><div class="relative bg-[#1D65A6]"><nav class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-5" aria-label=Global><div class="relative max-w-7xl w-full flex flex-wrap lg:flex-nowrap items-center justify-between mx-auto"><a href=/><img src=/img/rototational-white-text-only_hu15583614935666962927.webp alt=Rotational class="h-6 w-auto">
</a><button data-collapse-toggle=navbar-dropdown type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls=navbar-dropdown aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="fa fa-bars text-xl text-white"></i></button><div class="hidden absolute z-[9999] lg:static top-16 w-[92%] md:w-[96%] lg:w-auto lg:block bg-white lg:bg-transparent text-[#192E5B] lg:text-[#F2F2F2] py-2 rounded-md" id=navbar-dropdown><ul class="flex flex-col lg:gap-2 xl:gap-4 md:flex-row font-semibold w-full md:justify-between"><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/about/>About</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><button id=dropdownNavbarLink data-dropdown-toggle=dropdownNavbar class="uppercase flex items-center justify-between gap-x-2 w-full px-3 rounded md:border-0 md:p-0 md:w-auto hover:text-black">
Services
<i class="fa fa-angle-down pt-1"></i></button><div id=dropdownNavbar class="z-10 hidden font-normal bg-[#192E5B] divide-y divide-[#192E5B] rounded-lg shadow w-44"><ul class="py-2 text-sm text-[#F2F2F2]" aria-labelledby=dropdownLargeButton><li><a href=/services/ai-assessments/ class="block px-3 py-2 hover:font-bold">AI Assessments</a></li><li><a href=/services/ai-product-development/ class="block px-3 py-2 hover:font-bold">AI Product Development</a></li><li><a href=/services/ai-ops-and-data-foundations/ class="block px-3 py-2 hover:font-bold">AI Ops & Data Foundations</a></li></ul></div></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/case-studies>Case Studies</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/blog/>Blog</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/learning/>Learning</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/endeavor/>Product</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/contact/>Contact</a></li></ul></div></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=/img/blog/2021-05-19-what-are-protocol-buffers/migration_hu11094036574015628543.webp alt="What Are Protocol Buffers?" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="What Are Protocol Buffers?"><b class=text-[#1D65A6]>What </b>Are Protocol Buffers?</h3><div class="flex flex-wrap justify-center items-center my-6"><a href=/authors/rebecca-bilbro><img src=img/team/rebecca-bilbro.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span><a href=/authors/rebecca-bilbro>Rebecca Bilbro</a> | Wednesday, May 19, 2021 |&nbsp;
</span><span><a href=/tags/grpc>gRPC</a></span></div><article class="max-w-[800px] mx-auto prose mt-12"><p>Protocol buffers are a method for serializing data to efficiently send between programs. The structure is reminiscent of XML or JSON, but unlike these more commonly used text-based serialization methods, protocol buffers are designed to produce extremely compact messages using a binary format. The main tradeoff is that protocol buffers aren&rsquo;t human-readable, so when developing APIs, it&rsquo;s always important to consider the use case. In this post, we&rsquo;ll explore some of the use cases for protobufs and get to know the syntax.</p><h2 id=from-data-to-bytes>From Data to Bytes</h2><p>When we serialize, we&rsquo;re converting from an in-memory representation of data that&rsquo;s good for analysis and/or computation into a form that&rsquo;s better for storage and/or transmission.</p><p>Serialization is used to send data between processes. For example, if you&rsquo;ve ever called <code>.fit()</code> (or <code>.train()</code>) on a scikit-learn pipeline or neural network model inside of a Jupyter notebook, you can save (aka marshal or dump) that model into a <a href=http://scikit-learn.org/stable/modules/model_persistence.html>pickle</a> or <a href=https://support.hdfgroup.org/HDF5/>HDF5</a> file. When you do that, you&rsquo;re serializing the data structures (matrices, graphs, etc.) of the models along with their hyperparameters, weights, and state into a format that can be saved on disk.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pickle<span style=color:#f92672>.</span>dump(open(<span style=color:#e6db74>&#34;clf.pkl&#34;</span>, <span style=color:#e6db74>&#34;wb&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>joblib<span style=color:#f92672>.</span>dump(<span style=color:#e6db74>&#34;kmeans.pkl&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>save_model(<span style=color:#e6db74>&#34;rnn.h5&#34;</span>)
</span></span></code></pre></div><p>The opposite process is deserializing (unmarshalling or loading) the data structure from the on-disk representation into memory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pickle<span style=color:#f92672>.</span>load(open(<span style=color:#e6db74>&#34;clf.pkl&#34;</span>, <span style=color:#e6db74>&#34;rb&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>joblib<span style=color:#f92672>.</span>load(<span style=color:#e6db74>&#34;kmeans.pkl&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># or</span>
</span></span><span style=display:flex><span>load_model(<span style=color:#e6db74>&#34;rnn.h5&#34;</span>)
</span></span></code></pre></div><p>This is particularly useful if we&rsquo;re loading the model in a different process e.g. a different notebook or even a server that is going to use the model in an API.</p><h2 id=serialization-methods-and-use-cases>Serialization Methods and Use Cases</h2><p>There are many ways to serialize data:</p><ul><li><strong>Semi-structured data</strong> (<a href=https://en.wikipedia.org/wiki/XML_Schema_(W3C)>XML</a>, <a href=https://en.wikipedia.org/wiki/JSON>JSON</a>) are meant to balance human readability with machine readability. XML has schemas and can represent complex, hierarchical data, but is more verbose; JSON is often the default choice for Python programmers because Python <code>dicts</code> can be mapped directly to JSON, and vice versa.</li><li><strong>Configuration formats</strong> (<a href=https://yaml.org/>YAML</a>, <a href=https://toml.io/en/>TOML</a>) are geared towards human readability and are used to represent simple structures like strings, integers, boolean values, lists, maps, etc. While YAML uses whitespace to delineate fields for parsing, TOML trades some flexibility to offer unambiguous mapping from fields to dictionaries and hash tables.</li><li><strong>Binary formats</strong> (<a href=https://avro.apache.org/>Avro</a>, <a href=https://parquet.apache.org/>Parquet</a>) err on the side of machine readability and speed.</li></ul><p>There is a tendency to falsely infer competition between different serialization standards. The choice is less about selecting a &ldquo;correct&rdquo; one-size-fits-all technique and more about thoughtfully designing around the use case and the user. For example:</p><h5 id=use-case-1-building-a-public-data-api>Use Case 1: Building a Public Data API</h5><p><em>Preferred serialization technique: JSON or XML</em></p><p>JSON and XML don&rsquo;t require a robust contract between the data provider backend and the data consumers on the other end. For the data providers, that means you can change the schema by adding new fields without necessarily having to deprecate older versions of the API. Likewise, data consumers can get away with not having the schema (or not having the most recent version of it), because the schema can be inferred from the human-readable results that come back from their API calls. For analysts and data scientists who interact with public APIs, this is a key feature.</p><h5 id=use-case-2-cloud-configuration>Use Case 2: Cloud Configuration</h5><p><em>Preferred serialization technique: YAML or TOML</em></p><p>YAML and TOML frequently get used in cloud configuration, deployment, and devops tools like Kubernetes and Heroku. They&rsquo;re convenient because they end up having a lot of boilerplate that can be reused across deployments, and support documentation features like adding comments and notes that you can&rsquo;t do with JSON.</p><h5 id=use-case-3-computing-on-massive-datasets>Use Case 3: Computing on Massive Datasets</h5><p><em>Preferred serialization technique: Avro or Parquet</em></p><p>Avro and Parquet are used for large datasets intended for distributed computing where the schema can be self-contained with the data.</p><h3 id=downsides-of-human-readability>Downsides of Human-Readability</h3><p>On the other hand, human-readability has costs. For one thing, the serialization techniques described above are not very compact. And how would you validate and verify that your data is in the correct form, or if a service or an API has changed enough to break your system? How long does it take to serialize and deserialize messages?</p><p>Perhaps most importantly, if the messages are not going to be used for <em>communication between people</em>, these costs might not be worth paying, particularly if the serialization method is slowing down throughput or complicating data security.</p><p>Here&rsquo;s where protocol buffers come in!</p><h2 id=anatomy-of-a-protobuf>Anatomy of a Protobuf</h2><p>Of the serialization methods described earlier in this post, <a href=https://developers.google.com/protocol-buffers>protocol buffers</a> (&ldquo;protobufs&rdquo;) fall into the binary format category. They were originally developed for internal use at Google to serialize data into a dense binary format. Protobufs start with a strictly defined structure, which is then compiled into code that can be used to write to and read from that structure. This compact method is ideal for sending data between programs.</p><p>Let&rsquo;s consider an example of how protocol buffers might play a role in a machine learning (ML) application. Imagine that our application functions as a sort of &ldquo;conductor&rdquo; for the end-to-end ML application: it trains models, compares the results, and stores the best ones for downstream use. We need a protocol buffer file that defines a generic model message for the system to pass around internally.</p><h5 id=1-define-the-schema>1. Define the Schema</h5><p>First, we need to define the schema for the data, which we&rsquo;ll do in a file called <code>conductor.proto</code>. This schema will map data types with field names represented as integers. We start by specifying the syntax. At the time of this writing, protocol buffers are in version 3 (released in <a href="https://github.com/protocolbuffers/protobuf/releases?after=v3.0.0-beta-3.3">August of 2015</a>), so we&rsquo;ll write <code>syntax = "proto3";</code> at the top of our <code>.proto</code> file. We also specify the package where this schema will be used (in this case <code>conductor</code>).</p><p>The primary components of a protocol buffer are <code>messages</code>. For our ML Conductor, we&rsquo;ll define a <code>Model</code> message that contains fields that describe each of the key pieces of model metadata (the title, type of estimator, timestamp, etc.), together with the actual pickled <code>Estimator</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// The package specifies the version of the protocol buffers
</span></span></span><span style=display:flex><span><span style=color:#75715e>// and allows us to compare and validate changes in major
</span></span></span><span style=display:flex><span><span style=color:#75715e>// versions of the protobufs.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> conductor<span style=color:#f92672>.</span>v1;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// Imports allow you to include other protocol buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e>// definitions. In this case, we&#39;re using a Google definition
</span></span></span><span style=display:flex><span><span style=color:#75715e>// for a timestamp type that will be serialized into/from a
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Python datetime object or a Go time.Time struct.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;google/protobuf/timestamp.proto&#34;</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>// Messages define data types for serialization -
</span></span></span><span style=display:flex><span><span style=color:#75715e>// they&#39;ll be classes in Python or Java and structs in Go or C++.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Messages are composed of fields in the following form:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     type name = number;
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// When a message is serialized into binary format,
</span></span></span><span style=display:flex><span><span style=color:#75715e>// the fields are ordered by their number and the type
</span></span></span><span style=display:flex><span><span style=color:#75715e>// describes the size and encoding of the binary data;
</span></span></span><span style=display:flex><span><span style=color:#75715e>// the field numbers are therefore extremely important for
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ensuring a message is deserialized correctly!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>message</span> <span style=color:#a6e22e>Model</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>uint64</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;       <span style=color:#75715e>// unsigned integer of 64 bits
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>string</span> title <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;    <span style=color:#75715e>// inline comments describe fields ;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>string</span> notes <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#66d9ef>bytes</span>  pickle <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;   <span style=color:#75715e>// can hold arbitrary binary data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#75715e>// This is a nested message, meaning it is accessed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// via Model.Dataset. Nested messages are used when
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// only referenced inside a specific kind of message.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>message</span> <span style=color:#a6e22e>Dataset</span> {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        <span style=color:#66d9ef>string</span> snapshot <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;      <span style=color:#75715e>// field numbers are relative!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>repeated</span> <span style=color:#66d9ef>uint64</span> rows <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>; <span style=color:#75715e>// repeated means an array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#75715e>// Enums allow you to encode categorical values in a
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// schema-validatable way. This example is also nested
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// with the Model message, but doesn&#39;t have to be.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>enum</span> PredictorType {<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        UNKNOWN <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        REGRESSOR <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        CLASSIFIER <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>        CLUSTERER <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    }<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    Dataset dataset <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;          <span style=color:#75715e>// type is nested message above
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    PredictorType model_type <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>; <span style=color:#75715e>// type is nested enum above
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#75715e>// Timestamp is defined by the package.MessageName
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// from the imported proto file.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    google.protobuf.Timestamp fitted_on <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>;<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>}<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Note that with protocol buffer messages, fields are numbered to ensure the encoded data is unambiguously parseable. In other words, for the <code>Model</code> message, a field value of 1 means the <code>id</code> will always be in the first position in the series of bytes, the model&rsquo;s <code>title</code> will be in the second position, the training <code>notes</code> in the third, etc.</p><h5 id=2-compile-the-file>2. Compile the File</h5><p>Once you have downloaded and installed the protobuf compiler (e.g. using <code>brew</code>), you can compile the above file into the language of your choice. For instance:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>protoc --python_out<span style=color:#f92672>=</span>. conductor.proto
</span></span></code></pre></div><p>&mldr; will generate <code>conductor_pb2.py</code>, containing Python code that can be used to write to and read from the schema we defined in <code>conductor.proto</code>.</p><p>Protocol buffers are intended to be application language agnostic and are available in a large number of programming languages. For example, to generate Go code, we&rsquo;d do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>protoc --go_out<span style=color:#f92672>=</span>. conductor.proto
</span></span></code></pre></div><p>&mldr; which would generate <code>conductor.pb.go</code>.</p><h5 id=3-apply-generated-protobuf-code>3. Apply Generated Protobuf Code</h5><p>Now we can use the generated code inside our application, for instance to serialize and load a previously fitted baseline model to ensure subsequent models are showing improvement:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># To generate the conductor_pb2.py file run the following:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       protoc --python_out=. conductor.proto</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       pip install protobuf</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pickle
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> google.protobuf.timestamp_pb2 <span style=color:#f92672>import</span> Timestamp
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> conductor_pb2 <span style=color:#f92672>import</span> Model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clf <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;CoinFlipClassifier&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>model <span style=color:#f92672>=</span> Model(
</span></span><span style=display:flex><span>    id<span style=color:#f92672>=</span><span style=color:#ae81ff>42</span>,
</span></span><span style=display:flex><span>    title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;CoinFlip Classifier&#34;</span>,
</span></span><span style=display:flex><span>    notes<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Flipped a coin to set an initial system baseline&#34;</span>,
</span></span><span style=display:flex><span>    model_type<span style=color:#f92672>=</span>Model<span style=color:#f92672>.</span>PredictorType<span style=color:#f92672>.</span>CLASSIFIER,
</span></span><span style=display:flex><span>    fitted_on<span style=color:#f92672>=</span>Timestamp()<span style=color:#f92672>.</span>GetCurrentTime(),
</span></span><span style=display:flex><span>    pickle<span style=color:#f92672>=</span>pickle<span style=color:#f92672>.</span>dumps(clf),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create and add the dataset to the model</span>
</span></span><span style=display:flex><span>dataset <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>Dataset(
</span></span><span style=display:flex><span>    snapshot<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2014-04-09&#34;</span>,
</span></span><span style=display:flex><span>    rows<span style=color:#f92672>=</span>list(range(<span style=color:#ae81ff>100</span>))
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Protobuf objects are immutable, so copying and merging</span>
</span></span><span style=display:flex><span><span style=color:#75715e># is required to modify nested elements.</span>
</span></span><span style=display:flex><span>model<span style=color:#f92672>.</span>dataset<span style=color:#f92672>.</span>MergeFrom(dataset)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Serialize the model</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>SerializeToString()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Load the model</span>
</span></span><span style=display:flex><span>loaded <span style=color:#f92672>=</span> Model()
</span></span><span style=display:flex><span>loaded<span style=color:#f92672>.</span>ParseFromString(data)
</span></span><span style=display:flex><span>print(loaded)
</span></span></code></pre></div><h2 id=final-thoughts>Final Thoughts</h2><p>Beyond thinking about use cases, the choice of how to serialize often comes down to the tradeoff between structure and flexibility. It&rsquo;s easier to get started with JSON than with protocol buffers, but harder to maintain in the long run. And while protocol buffers are harder to change than YAML, they&rsquo;re a lot faster to parse and validate.</p><p>Using protocol buffers means more forethought is required to ensure backwards compatibility. Assigning the field numbers to a message in the <code>proto</code> file is tantamount to a commitment that these numbers will not change from version to version. Many seasoned gRPC developers even intentionally skip numbers in their message definitions to allow for flexibility while also providing backward and forward compatibility as RPCs grow and evolve.</p><p>If you&rsquo;re used to the <a href=https://restfulapi.net/>RESTful API paradigm</a>, protocol buffers may take some adjustment. However, they&rsquo;re definitely worth looking into as the use cases are becoming more common. As applications become more complex, data is continuously more distributed, and user experience increasingly hinges on intermediate data transmission, protobufs will only become more useful!</p><h2 id=further-readingwatching>Further Reading/Watching</h2><ul><li><a href=https://developers.google.com/protocol-buffers/>Protocol Buffers - Developer Docs</a></li><li><a href=https://github.com/protocolbuffers/protobuf/tree/master/examples>Protocol Buffer Examples in C++, Java, Python, and Go</a></li><li><a href=https://youtu.be/72mPlAfHIjs>An Introduction to Protobufs by Ten Loh</a></li><li><a href=https://youtu.be/_jQ3i_fyqGA>justforfunc #30: The Basics of Protocol Buffers</a></li><li><a href=https://medium.com/@erika_dike/installing-the-protobuf-compiler-on-a-mac-a0d397af46b8>Installing the Protobuf Compiler on a Mac by Erika Dike</a></li><li><a href=https://stackoverflow.com/questions/14028293/google-protocol-buffers-vs-json-vs-xml>JSON vs XML vs Protobufs on Stackoverflow</a></li></ul></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About </span>This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">Protocol buffers are a method for serializing data to efficiently send between programs. In this post, we'll explore some use cases for protobufs and learn the syntax.</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/rebecca-bilbro><img src=img/team/rebecca-bilbro.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span class="flex flex-wrap"><a href=/authors/rebecca-bilbro class="lg:w-[20ch] mx-2">Rebecca Bilbro</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><div class="flex items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span class=text-[#1D65A6]>Recommended</span>
&nbsp;Rotations</h2></div><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:my-8"><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/mocking-the-universe/><img loading=lazy src=/img/blog/2023-03-08-mocking-the-universe/monkey-in-mirror_hu14433624242230238302.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/testing>Testing</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/grpc>gRPC</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/mocking-the-universe/ class=block>Mocking the Universe: Two Techniques for Testing gRPC with Mocks</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">At Rotational, <a href=https://rotational.io/blog/what-are-protocol-buffers/>we use gRPC</a> <a href=https://rotational.io/blog/documenting-grpc-with-openapi>quite a bit</a>. It&rsquo;s great for specifying network APIs, but can challenge us to find new ways to thoroughly test the code. Follow along with this post to learn two ways of using <a href=https://rotational.io/blog/fake-it-when-you-make-it/>mocking</a> to test gRPC services!</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/daniel-sollis_hu3896032726577558792.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/daniel-sollis>Daniel Sollis</a></li></ul></div><div class=font-extralight>Mar 28, 2023</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/transparently-mocking-grpc-services/><img loading=lazy src=/img/blog/blue_laser_hu7583231517576374100.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/grpc>gRPC</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/mocks>Mocks</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/transparently-mocking-grpc-services/ class=block>Transparently Mocking gRPC Services</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">gRPC is an effective way of implementing service-to-service APIs. However, there are limited tools available for mocking and testing gRPC services out of the box. One option is to set up a live test server, although this comes with its own …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/patrick-deziel_hu8906543757154920962.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/patrick-deziel>Patrick Deziel</a></li></ul></div><div class=font-extralight>Jul 8, 2022</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/><img loading=lazy src=/img/blog/2021-02-12-grpc-openapi-docs/gateway_hu12922882535480469414.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/grpc>gRPC</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/ class=block>Documenting a gRPC API with OpenAPI</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">gRPC makes the specification and implementation of networked APIs a snap. But what is the simplest way to <em>document</em> a gRPC API? There seem to be some hosted providers by Google, e.g. <a href=https://cloud.google.com/endpoints/docs/grpc/dev-portal-update-ref-docs>SmartDocs</a>, but I have yet to find a gRPC-specific tool. …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>Feb 12, 2021</div></div></div></li></ul></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-8 px-12 md:px-16 text-white md:rounded-lg"><input type=hidden id=newsletterFormID value=8aeeb77b-a5e0-4772-b726-44e1fc2eb6e1><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><div class="bg-teal-100 border-t-4 border-teal-500 mt-3 rounded-b text-teal-900 p-4 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for joining the Rotational Labs newsletter!</p></div></div></div><div id=newsletter-error class="hidden mt-3 bg-red-200 border-t-4 border-red-600 text-red-900 rounded-b p-4 shadow-md" role=alert><div><p class=text-sm>Your request did not go through, please try again. If you need immediate assistance, please email support@rotational.io.</p></div></div><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start gap-x-2"><input type=checkbox id=checkbox required name=consent class="mt-1 w-4 h-4 block border-0">
<label for=checkbox><span id=consentText>I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-10 py-3 mt-8 rounded-lg text-sm text-white uppercase md:text-base hover:bg-[#192E5B]/80">
Submit</button></div></form></div></main><footer class="relative mt-40 md:mt-56 bg-[#192E5B]"><div class="relative w-full pt-36 md:pt-16 lg:pt-24 2xl:pt-20 font-extralight text-white"><div class="-mt-52 w-full mx-auto max-w-screen-xl px-4"><section class="bg-[#72A2C0] w-full p-6 md:py-20 md:px-16"><h2 class="my-4 text-2xl sm:text-3xl md:text-5xl text-white font-extrabold">LET'S ENVISION & BUILD THE FUTURE TOGETHER.</h2><div class=py-6><a href=/contact class="p-3 md:p-4 md:px-6 bg-[#2F4858] font-bold md:text-lg text-white text-center hover:bg-[#2F4858]/80">CONTACT US</a></div></section></div><div class="max-w-7xl mx-auto px-6"><div class="mt-12 flex flex-col md:flex-row lg:justify-between gap-x-8"><div class="my-4 max-w-xs"><h5 class="mb-3 font-extrabold">OUR PRESENCE</h5><p>We share because we care, about topics, tools, and technologies that we believe impact the AI economy.</p><div class=py-4><ul class="flex justify-between items-center gap-x-8"><li><a href=https://twitter.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-x-twitter"></i><p class=sr-only>Twitter</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-linkedin"></i><p class=sr-only>LinkedIn</p></a></li><li><a href=https://github.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-github"></i><p class=sr-only>GitHub</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-youtube"></i><p class=sr-only>YouTube</p></a></li><li><a href=https://www.twitch.tv/rotationallabs target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-twitch"></i><p class=sr-only>Twitch</p></a></li></ul></div></div><div class=my-4><h5 class="mb-3 font-extrabold">COMPANY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/about>About Us</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/case-studies>Case Studies</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/endeavor>Endeavor</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/blog>Blog</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">COMMUNITY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/learning>Learning</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/opensource>Open Source</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">CONTACT US</h5><ul><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-map-marker-alt text-[#757575]"></i>
St. Paul, MN & Washington, DC</li><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-envelope text-[#757575]"></i>
info@rotational.io</li></ul><div class=py-8><a href=/contact class="p-3 bg-[#ECF6FF] font-bold text-black text-center hover:bg-[#ECF6FF]/80">CONTACT US</a></div></div></div><div class="sm:flex justify-between py-6 border-t mt-4"><p>Copyright © Rotational Labs, Inc. 2021–2025 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex gap-x-8"><li><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js></script><script src=https://rotational.io/js/blogSingle.js></script><script type=module src=https://rotational.io/js/newsletterForm.js></script></body></html>