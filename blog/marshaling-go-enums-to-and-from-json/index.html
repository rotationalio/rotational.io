<!doctype html><html lang=en-us><head><meta charset=UTF-8><title>Rotational Labs | Marshaling Go Enums to and from JSON</title>
<base href=https://rotational.io/ target=_self><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Rotational Labs, Inc."><meta name=description content="How to customize JSON serialization for your data types while avoiding pointer and receiver problems -- a story in three parts."><meta name=keywords content="AI solutions for mid-market companies,AI-driven tools,Business automation solutions,AI-powered interfaces,Intelligent agents,Natural language processing (NLP),Computer vision AI,Streamline operations with AI,machine learning,Boost business performance with AI,AI for business growth,Tailored AI solutions,Trusted AI solutions,AI for operational efficiency,Secure AI tools,AI expertise for mid-market businesses,Endeavor"><link type=text/plain rel=author href=https://rotational.io/humans.txt><meta property="og:title" content="Marshaling Go Enums to and from JSON"><meta property="og:description" content="How to customize JSON serialization for your data types while avoiding pointer and receiver problems -- a story in three parts."><meta property="og:image" content="https://rotational.io/img/blog/fireworks_star.jpg"><meta property="og:url" content="https://rotational.io/blog/marshaling-go-enums-to-and-from-json/"><meta property="og:type" content="website"><meta name=twitter:title content="Marshaling Go Enums to and from JSON"><meta name=twitter:card content="summary"><meta name=twitter:description content="How to customize JSON serialization for your data types while avoiding pointer and receiver problems -- a story in three parts."><meta name=twitter:image content="https://rotational.io/img/blog/fireworks_star.jpg"><link rel="shortcut icon" href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=icon href=https://rotational.io/img/favicon.png type=image/x-icon><link rel=alternate type=application/rss+xml href=https://rotational.io//index.xml title="Recent Rotations of the Rotational Labs Blog"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel=stylesheet><link rel=stylesheet href=https://rotational.io/output.css media=screen><script src="https://www.googletagmanager.com/gtag/js?id=G-2FKX6CWJHW" async defer></script><script type=module>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-2FKX6CWJHW');
</script><script async defer src="https://www.google.com/recaptcha/enterprise.js?render=6Ld5O3kiAAAAAJU0z0h81X1RxEMHyoROe6KWe_vk"></script><script src=https://kit.fontawesome.com/fea17a4e21.js crossorigin=anonymous></script></head><body><div class="relative bg-[#1D65A6]"><nav class="w-full max-w-7xl mx-auto px-4 sm:px-6 py-5" aria-label=Global><div class="relative max-w-7xl w-full flex flex-wrap lg:flex-nowrap items-center justify-between mx-auto"><a href=/><img src=/img/rototational-white-text-only_hu15583614935666962927.webp alt=Rotational class="h-6 w-auto">
</a><button data-collapse-toggle=navbar-dropdown type=button class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls=navbar-dropdown aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="fa fa-bars text-xl text-white"></i></button><div class="hidden absolute z-[9999] lg:static top-16 w-[92%] md:w-[96%] lg:w-auto lg:block bg-white lg:bg-transparent text-[#192E5B] lg:text-[#F2F2F2] py-2 rounded-md" id=navbar-dropdown><ul class="flex flex-col lg:gap-2 xl:gap-4 md:flex-row font-semibold w-full md:justify-between"><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/about/>About</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><button id=dropdownNavbarLink data-dropdown-toggle=dropdownNavbar class="uppercase flex items-center justify-between gap-x-2 w-full px-3 rounded md:border-0 md:p-0 md:w-auto hover:text-black">
Services
<i class="fa fa-angle-down pt-1"></i></button><div id=dropdownNavbar class="z-10 hidden font-normal bg-[#192E5B] divide-y divide-[#192E5B] rounded-lg shadow w-44"><ul class="py-2 text-sm text-[#F2F2F2]" aria-labelledby=dropdownLargeButton><li><a href=/services/ai-assessments/ class="block px-3 py-2 hover:font-bold">AI Assessments</a></li><li><a href=/services/ai-product-development/ class="block px-3 py-2 hover:font-bold">AI Product Development</a></li><li><a href=/services/ai-ops-and-data-foundations/ class="block px-3 py-2 hover:font-bold">AI Ops & Data Foundations</a></li></ul></div></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/case-studies>Case Studies</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/blog/>Blog</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/learning/>Learning</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/endeavor/>Product</a></li><li class="py-2 uppercase text-sm lg:text-[15px] xl:text-[17px]"><a class="px-3 py-3.5 hover:text-black" href=/contact/>Contact</a></li></ul></div></div></nav></div><main><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class=mt-14><div class=blog-img><img src=/img/blog/fireworks_star_hu7528471189281910091.webp alt="Marshaling Go Enums to and from JSON" class="mx-auto object-cover"></div><div class=mt-8><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center" data-blog-title="Marshaling Go Enums to and from JSON"><b class=text-[#1D65A6]>Marshaling </b>Go Enums to and from JSON</h3><div class="flex flex-wrap justify-center items-center my-4"><a href=/authors/benjamin-bengfort><img src=img/team/benjamin-bengfort.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a> | Thursday, May 26, 2022 |&nbsp;
</span><span><a href=/tags/golang>Golang</a>,&nbsp;
</span><a href=/tags/programming>Programming</a></span></div><article class="max-w-[800px] mx-auto prose"><p>Customizing JSON serialization for your data types seems relatively straightforward on the surface, but it&rsquo;s easy to get turned around in receiver, value, pointer, and indirection confusion. Many of the patterns and rules-of-thumb you use in your normal Go code can lead you astray. In this post, we&rsquo;ll illustrate exactly how and why to handle these edge cases.</p><p>But before we get any further, if you&rsquo;re using this as a reference to determine how to implement JSON serialization for an enum type, here is the code snippet you&rsquo;re looking for:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Suit</span> <span style=color:#66d9ef>uint8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// MarshalJSON must be a *value receiver* to ensure that a Suit on a parent object
</span></span></span><span style=display:flex><span><span style=color:#75715e>// does not have to be a pointer in order to have it correctly marshaled.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>MarshalJSON</span>() ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// It is assumed Suit implements fmt.Stringer.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>String</span>())
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// UnmarshalJSON must be a *pointer receiver* to ensure that the indirect from the
</span></span></span><span style=display:flex><span><span style=color:#75715e>// parsed value can be set on the unmarshaling object. This means that the
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ParseSuit function must return a *value* and not a pointer.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>suits</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>suits</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ParseSuit</span>(<span style=color:#a6e22e>suits</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The complete, interactive, and runable code can be found <a href=https://go.dev/play/p/oMh1TDiwi_H>on the Go playground</a>.</p><h2 id=customizing-json-serialization-in-go>Customizing JSON Serialization in Go</h2><p>The German-American side of my family loves playing <a href=https://bicyclecards.com/how-to-play/euchre/>Euchre</a>, so I thought it might be an interesting idea to create an online multiplayer card game to stay connected during the pandemic. To describe decks and hands, I had to define cards, and in order to define cards, I had to implement a <code>Suit</code> type to describe the four possible card suits: hearts, diamonds, clubs, and spades. An <a href=https://en.wikipedia.org/wiki/Enumerated_type>Enum (short for enumerated type)</a> is an excellent choice to define suits, and in fact &ndash; the Wikipedia article about enumerated types uses card suits as an example!</p><p>Here is a classic definition of an enum in Go using <a href=https://www.gopherguides.com/articles/how-to-use-iota-in-golang><code>iota</code></a> to declare constant uint8 for our suits.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Hearts</span> <span style=color:#a6e22e>Suit</span> = <span style=color:#66d9ef>iota</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Diamonds</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Clubs</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Spades</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Suit</span> <span style=color:#66d9ef>uint8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Suit_name</span> = <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>uint8</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>1</span>: <span style=color:#e6db74>&#34;♥&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>2</span>: <span style=color:#e6db74>&#34;♦&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>3</span>: <span style=color:#e6db74>&#34;♣&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>4</span>: <span style=color:#e6db74>&#34;♠&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Suit_value</span> = <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>uint8</span>{
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;♥&#34;</span>:        <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;hearts&#34;</span>:   <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;♦&#34;</span>:        <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;diamonds&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;♣&#34;</span>:        <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;clubs&#34;</span>:    <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;♠&#34;</span>:        <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;spades&#34;</span>:   <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// String allows Suit to implement fmt.Stringer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Suit_name</span>[uint8(<span style=color:#a6e22e>s</span>)]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Convert a string to a Suit, returns an error if the string is unknown.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// NOTE: for JSON marshaling this must return a Suit value not a pointer, which is
</span></span></span><span style=display:flex><span><span style=color:#75715e>// common when using integer enumerations (or any primitive type alias).
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ParseSuit</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) (<span style=color:#a6e22e>Suit</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> = <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>TrimSpace</span>(<span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToLower</span>(<span style=color:#a6e22e>s</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Suit_value</span>[<span style=color:#a6e22e>s</span>]
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Suit</span>(<span style=color:#ae81ff>0</span>), <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;%q is not a valid card suit&#34;</span>, <span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Suit</span>(<span style=color:#a6e22e>value</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>Suit</code> enum uses 1 byte (a <code>uint8</code>) to define our constants in a small but still convenient package (technically all we need is 2 bits to represent our 4 values; a uint8 can represent up to 255 values but is far easier to work with). This is more compact than a string, but is not terribly human-friendly (e.g. you don&rsquo;t want to have to remember that <code>Hearts == 1</code>) so we implement the <a href=https://pkg.go.dev/fmt#Stringer><code>fmt.Stringer</code></a> interface so that we can print the suit as ♥, ♦, ♣, or ♠ and a <code>ParseSuit</code> function so we can easily convert a string to a <code>Suit</code>. We then get the best of both worlds: a compact enum that can be typechecked by the compiler and a string representation that we can read and understand.</p><p>All is well and we can implement our <code>Card</code> type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Card</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Value</span> <span style=color:#66d9ef>uint8</span> <span style=color:#e6db74>`json:&#34;value&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Suit</span>  <span style=color:#a6e22e>Suit</span>  <span style=color:#e6db74>`json:&#34;suit&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>But when we attempt to marshal our card as JSON:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>card</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Card</span>{<span style=color:#a6e22e>Value</span>: <span style=color:#ae81ff>7</span>, <span style=color:#a6e22e>Suit</span>: <span style=color:#a6e22e>Spades</span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>card</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>data</span>))
</span></span></code></pre></div><p>We get the following result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ <span style=color:#f92672>&#34;value&#34;</span>: <span style=color:#ae81ff>7</span>, <span style=color:#f92672>&#34;suit&#34;</span>: <span style=color:#ae81ff>4</span> }
</span></span></code></pre></div><p>We just did a bunch of work to be able to represent our <code>Suit</code> as a string, but the <code>encoding/json</code> package ignores it &ndash; this is because we need to customize how JSON is created from our type. To do so, we must implement the <a href=https://pkg.go.dev/encoding/json#Marshaler><code>json.Marshaler</code></a> interface:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>MarshalJSON</span>() ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>String</span>())
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>MarshalJSON</code> function converts the <code>Suit</code> into a string, then JSON-marshals the string so that the output is valid JSON: <code>[]byte("\"♠\"")</code> (quotation marks included). The most important thing to remember is that the method has a <em>value</em> receiver not a <em>pointer</em> receiver &ndash; more on this later. Implementing this method for our <code>Suit</code> object now marshals the following JSON data:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ <span style=color:#f92672>&#34;value&#34;</span>: <span style=color:#ae81ff>7</span>, <span style=color:#f92672>&#34;suit&#34;</span>: <span style=color:#e6db74>&#34;♠&#34;</span> }
</span></span></code></pre></div><p>Of course, if we try to Unmarshal this data, we will get an error &ldquo;json: cannot unmarshal string into Go value of type main.Suit&rdquo; because <code>"♠"</code> cannot be converted to a <code>uint8</code> and then to our <code>Suit</code> type. To deal with our custom marshaled JSON data, we&rsquo;ll also have to implement the <a href=https://pkg.go.dev/encoding/json#Unmarshaler><code>json.Unmarshaler</code></a> interface:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>suits</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>suits</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ParseSuit</span>(<span style=color:#a6e22e>suits</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This function is slightly more complicated, so we&rsquo;ll go through it step by step. First, we declare a string variable <code>suits</code> and unmarshal the data into the string &ndash; this is possible because we expect the data to be the JSON string <code>"♠"</code> (quotation marks included). Once we&rsquo;ve unmarshaled this intermediate type, we can then use the <code>ParseSuit</code> function to convert it into a <code>Suit</code> object &ndash; but then what do we do with it? The short answer is that we have to use <a href=https://go.dev/tour/methods/6>pointer indirection</a> to assign the method receiver variable the value returned from <code>ParseSuit</code>. The long answer follows.</p><h2 id=pointers-values-and-reflection-in-json-serialization>Pointers, Values, and Reflection in JSON Serialization</h2><p>The <code>*</code> operator in this context is the <a href=https://en.wikipedia.org/wiki/Dereference_operator>indirection operator (or dereference operator)</a>. It is an operator that works on <code>pointer</code> variables to get access to the value of the variable stored in the memory address (e.g. it is an indirect way to access the value). It is the opposite of the <code>&</code> operator, which is the &ldquo;address-of&rdquo; operator that returns the pointer to the given value. Besides what these operators do, it is also important to understand <a href=https://go.dev/tour/methods/4>method receivers</a> in Golang, which can be either pointer or value receivers depending on the type defined in the method signature.</p><p>The <code>UnmarshalJSON</code> function is a method, meaning it is a function that has an object receiver. Because <code>UnmarshalJSON</code> only returns an error &ndash; it is up to us to unmarshal the data into the receiver (e.g. modify the receiver value as the unmarshaled object). This means we have a choice, we can implement the <code>UnmarshalJSON</code> method with either a value receiver:</p><pre tabindex=0><code>func (s Suit) UnmarshalJSON(data []byte) error
</code></pre><p>or a pointer receiver:</p><pre tabindex=0><code>func (s *Suit) UnmarshalJSON(data []byte) error
</code></pre><p>Although these method signatures are different by one character, the receiver type has a large impact on how the code behaves. If you attempt to use the pointer indirection with a value receiver:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ParseSuit</span>(<span style=color:#a6e22e>suits</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The compiler will complain with the following error: &ldquo;invalid operation: cannot indirect s (variable of type Suit)&rdquo;. However, if you don&rsquo;t indirect:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ParseSuit</span>(<span style=color:#a6e22e>suits</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then a copy of the value is passed into the <code>UnmarshalJSON</code> method and the original variable is not modified. This means that the <code>Suit</code> on the card you&rsquo;re trying to unmarshal will remain zero-valued:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>card</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Card</span>{}
</span></span><span style=display:flex><span><span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>([]byte(<span style=color:#e6db74>`{&#34;value&#34;: 12, &#34;suit&#34;: &#34;♥&#34;}`</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>card</span>.<span style=color:#a6e22e>Suit</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Suit</span>(<span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><p>The <code>UnmarshalJSON</code> was called successfully but the <code>card.Suit</code> variable was never touched by the value receiver. This means that <strong>the <em>only</em> way to handle <code>UnmarshalJSON</code> is with a pointer receiver and indirection of the unmarshaled value</strong> (or direct modification of the values in the pointer).</p><p>The <a href=https://go.dev/tour/methods/8>rule of thumb</a> for implementing value or pointer receivers is as follows:</p><blockquote><p>In general, all methods on a given type should have either value or pointer receivers, but not a mixture of both.</p></blockquote><p>However, we implemented our <code>MarshalJSON</code> function as a value receiver &mldr; what gives?</p><p>This is where <a href=https://en.wikipedia.org/wiki/Reflective_programming>reflection</a> enters the picture. The <code>encoding/json</code> package makes heavy use of the <a href=https://pkg.go.dev/reflect><code>reflect</code></a> package to examine arbitrary types, determine if those types implement the interfaces we defined in the previous section, get access to struct tags, and more.</p><p>Remember that we defined our <code>Card</code> type as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Card</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Value</span> <span style=color:#66d9ef>uint8</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Suit</span> <span style=color:#a6e22e>Suit</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The property <code>Suit</code> on the <code>Card</code> is of type <code>Suit</code> &ndash; a value and not a pointer (<code>*Suit</code>). If we implemented our <code>MarshalJSON</code> method with a pointer receiver, you would notice something odd happen:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Suit</span>) <span style=color:#a6e22e>MarshalJSON</span>() ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	panic(<span style=color:#e6db74>&#34;this should not work&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>Spades</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>data</span>))
</span></span></code></pre></div><p>The output is <code>3</code> and the panic is never triggered. In order to trigger the panic you would have to do the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>spades</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Spades</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>spades</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>data</span>))
</span></span></code></pre></div><p>In the first case we&rsquo;re passing a value to the <code>json.Marshal</code> method and in the second case we&rsquo;re passing a pointer. (We have to assign the constant <code>Spades</code> to a variable <code>spades</code> because we cannot use <code>&</code> on a constant &ndash; this allows us to pass the address-of the pointer to the <code>json.Marshal</code> method.)</p><p>In order to use reflection to determine if a variable implements the <code>json.Marshaler</code> interface, it has to determine if the <code>MarshalJSON</code> is in the <a href=http://golang.org/ref/spec#Method_sets>method set</a> of the variable. When using the pointer receiver, it is in the method set of <code>*Suit</code> but not <code>Suit</code> and when using the value receiver, it is in the method set of <code>Suit</code> not <code>*Suit</code>.</p><p>Enums are usually treated as values since they are simple integers, e.g. it is preferable to use <code>Suit</code> rather than <code>*Suit</code> for the same reason it is preferable to use <code>int</code> rather than <code>*int</code>. Although the pointer receiver of <code>MarshalJSON</code> for the enum would work in 98% of cases, the 2% of cases it doesn&rsquo;t work would cause frustrating bugs that would be hard to diagnose, therefore I believe <strong>in the case of enum JSON serialization, mixing pointer and value method receivers is an exception to the normal rule of thumb</strong>.</p><h2 id=sidebar-marshaling-cards>Sidebar: Marshaling Cards</h2><p>To wrap up, I&rsquo;d like to discuss a couple of notes on the <code>Card</code> struct. First why did we add <code>UnmarshalJSON</code> and <code>MarshalJSON</code> to the enum <code>Suit</code> instead of to <code>Card</code>? Here I&rsquo;ll introduce another rule of thumb: <strong>implement the JSON Marshaler and Unmarshaler methods on the smallest possible type that needs custom serialization</strong>. JSON data is usually very nested data with lots of different types and subtypes. To make your custom types more flexible (e.g. using <code>Suit</code> in objects besides <code>Card</code>), you&rsquo;ll want each type to handle it&rsquo;s own marshaling and unmarshaling rather than requiring the parent type to do it.</p><p>Second, if you tried marshaling the <code>Card</code> in the case above where <code>Suit</code> had a pointer receiver to <code>MarshalJSON</code>, you may have noticed that the code worked. I mentioned that in 2% of the cases the pointer receiver would not work, one of those cases is if you add a <code>MarshalJSON</code> method to <code>Card</code> and you attempt to create an intermediate value for the representation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Card</span>) <span style=color:#a6e22e>MarshalJSON</span>() ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>middle</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>middle</span>[<span style=color:#e6db74>&#34;value&#34;</span>] = <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Value</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>middle</span>[<span style=color:#e6db74>&#34;suit&#34;</span>] = <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Suit</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>middle</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As discussed in the previous section, <code>c.Suit</code> is assigned to the type <code>interface{}</code>, so when the JSON reflection inspects its method set, it cannot find the pointer receiver of <code>MarshalJSON</code>. Without this method, the <code>c.Suit</code> type is <code>Suit</code>, so the JSON reflection can directly assert if the type implements <code>Marshaler</code>.</p><p>Finally - what about custom unmarshaling of a <code>struct</code>, are there any gotchas there? Consider if we want to do custom validation of our card during unmarshal and return an error if the card is not valid (not the best design pattern, but used to illustrate a point):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Card</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>c</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Value</span> &lt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Value</span> &gt; <span style=color:#ae81ff>13</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;not a valid card value&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This code will return a stack overflow because of the infinite recursive call to <code>UnmarshalJSON</code> - e.g. calling <code>json.Unmarshal(data, card)</code> will call <code>c.UnmarshalJSON(data)</code>, which will call <code>json.Unmarshal(data, c)</code> which will call <code>c.UnmarshalJSON(data)</code> and so on until the maximum recursion depth is reached and a stack overflow occurs. To solve this problem, an <a href=https://talks.golang.org/2012/10things.slide#2><em>anonymous struct</em></a> is required:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Card</span>) <span style=color:#a6e22e>UnmarshalJSON</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cs</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>struct</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Value</span> <span style=color:#66d9ef>uint8</span> <span style=color:#e6db74>`json:&#34;value&#34;`</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Suit</span>  <span style=color:#a6e22e>Suit</span>  <span style=color:#e6db74>`json:&#34;suit&#34;`</span>
</span></span><span style=display:flex><span>    }{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cs</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cs</span>.<span style=color:#a6e22e>Value</span> &lt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>cs</span>.<span style=color:#a6e22e>Value</span> &gt; <span style=color:#ae81ff>13</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;not a valid card value&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Value</span> = <span style=color:#a6e22e>cs</span>.<span style=color:#a6e22e>Value</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Suit</span> = <span style=color:#a6e22e>cs</span>.<span style=color:#a6e22e>Suit</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Duplicating struct definitions will often make maintenance harder, but this is sometimes necessary, particularly in the case of generated code that does not allow you to implement your own <code>json</code> struct tags (e.g. protocol buffers).</p><h2 id=conclusion>Conclusion</h2><p>When you define your own types in Go and you want control over how those types are serialized and deserialized into JSON - the <code>Marshaler</code> and <code>Unmarshaler</code> interfaces give you a lot of flexibility. However, knowing and understanding pointers, values, indirection, and receivers is essential to correctly implementing these interfaces &ndash; and common wisdom can sometimes lead to tripping hazards. In particular, when dealing with enumerations or other primitive type aliases, the rule of thumb to use all pointer or all value receivers does not hold, and instead mixed receiver types are your best bet.</p></article></div></div><div class="bg-[#E8EFF6] max-w-[800px] mx-auto mt-9 p-8 rounded-lg"><h3 class="font-bold text-xl sm:text-2xl lg:text-3xl text-center mb-3"><span class="text-[#1D65A6] font-bold">About </span>This Post</h3><p class="text-base mx-auto px-2 text-center lg:text-base">How to customize JSON serialization for your data types while avoiding pointer and receiver problems -- a story in three parts.</p><div class="flex flex-col md:flex-row text-center mx-auto border-t pt-6 mt-6 align-center justify-between gap-10"><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Written by:</h2><div class="flex items-center"><a href=/authors/benjamin-bengfort><img src=img/team/benjamin-bengfort.png alt class="mr-3 border-4 border-white rounded-full h-11 drop-shadow-lg">
</a><span class="flex flex-wrap"><a href=/authors/benjamin-bengfort class="lg:w-[20ch] mx-2">Benjamin Bengfort</a></span></div></div><div class=lg:w-1/2><h2 class="text-lg text-[#1D65A6] font-bold mb-3">Share this post:</h2><ul class="flex items-center justify-center gap-6 mt-4"><li><a onclick=shareByEmail() class=cursor-pointer><img src=img/email.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnTwitterWithTitle() class=cursor-pointer><img src=img/twitter.png alt class="rounded-lg bg-white p-3"></a></li><li><a onclick=shareOnLinkedIn() class=cursor-pointer><img src=img/linkedin.png alt class="rounded-lg bg-white p-3"></a></li></ul></div></div></div><div class="relative max-w-7xl mx-auto px-4 sm:px-6"><div class="flex justify-between mt-12 sm:mt-24 items-center"><div class="flex items-center"><h2 class="font-bold text-2xl sm:text-4xl flex"><span class=text-[#1D65A6]>Recommended</span>
&nbsp;Rotations</h2></div><div><a href=/blog class="flex text-base sm:text-lg items-center font-bold text-[#1D65A6]"><span>View all</span>
<img src=img/arr-right.png alt class="h-4 ml-2"></a></div></div><div><ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:my-8"><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/ranges-of-integer-data-types/><img loading=lazy src=/img/blog/num215_hu17749557558912417782.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/ranges-of-integer-data-types/ class=block>Ranges of Integer Data Types</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">The data type choices we make when building data systems or metrics is critically important: as our systems run for long periods of time it can be easy to overflow the integers that we use (Y2K bug anyone?). As a result, I find myself …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>Sep 7, 2022</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/contexts-in-go-microservice-chains/><img loading=lazy src=/img/blog/2021-05-02-contexts-in-go-microservice-chains/arboreal_hu13970464913307738074.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/microservices>Microservices</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/contexts-in-go-microservice-chains/ class=block>Contexts in Go Microservice Chains</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">Contexts are a critical part of services implemented in Golang. Although we see them often in server interfaces, they can be mysterious to developers implementing request handlers. In this post, we&rsquo;ll discuss what contexts are and …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>May 2, 2021</div></div></div></li><li class="mt-6 bg-[#ECF6FF] rounded-xl"><div class="flex flex-col h-full"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/><img loading=lazy src=/img/blog/2021-02-12-grpc-openapi-docs/gateway_hu12922882535480469414.webp alt class="rounded-t-xl object-cover" style=height:212px;width:100%></a><div class="px-4 pt-4"><ul class="flex flex-wrap"><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/grpc>gRPC</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/programming>Programming</a>,&nbsp;</li><li class="text-base font-bold text-[#1D65A6]"><a href=/tags/golang>Golang</a></li></ul><div class="flex flex-col mt-4 h-full"><h3 class="text-xl font-extrabold sm:h-36"><a href=https://rotational.io/blog/documenting-grpc-with-openapi/ class=block>Documenting a gRPC API with OpenAPI</a></h3><div class=mb-4><p class="my-4 sm:mt-auto">gRPC makes the specification and implementation of networked APIs a snap. But what is the simplest way to <em>document</em> a gRPC API? There seem to be some hosted providers by Google, e.g. <a href=https://cloud.google.com/endpoints/docs/grpc/dev-portal-update-ref-docs>SmartDocs</a>, but I have yet to find a gRPC-specific tool. …</p></div></div></div><div class="flex justify-between mt-auto items-center border-t px-4 py-3 h-16"><div class="flex items-center"><img loading=lazy src=/img/team/benjamin-bengfort_hu17822499508975549251.png alt class="rounded-full h-10 w-10"><ul class="flex flex-wrap ml-4"><li class=font-extralight><a href=/authors/benjamin-bengfort>Benjamin Bengfort</a></li></ul></div><div class=font-extralight>Feb 12, 2021</div></div></div></li></ul></div></div></div><div class="bg-[#1D65A6] max-w-[800px] mx-auto mt-20 py-14 px-12 md:px-16 text-white md:rounded-lg"><input type=hidden id=newsletterFormID value=8aeeb77b-a5e0-4772-b726-44e1fc2eb6e1><form action=blog method=post id=newsletterForm><h6 class="font-bold text-center">Enter Your Email To Subscribe</h6><label for=email class=hidden>Email</label>
<input type=text name=email id=email required placeholder class="w-full px-4 py-2.5 rounded-lg mt-6 text-black" style=color:#000><div class="flex mt-6 items-start gap-x-2"><input type=checkbox id=checkbox required name=consent class="mt-1 w-4 h-4 block border-0">
<label for=checkbox><span id=consentText>I want to receive the monthly newsletter and other updates from Rotational. You agree to our Privacy Policy. You may unsubscribe at any time.*</span></label></div><div class="bg-teal-100 border-t-4 border-teal-500 mt-10 rounded-b text-teal-900 px-4 py-3 shadow-md hidden" id=newsletter-alert role=alert><div class=flex><div><p class=text-sm>Thank you for your interest!</p></div></div></div><div class="flex justify-center"><button type=submit class="bg-[#192E5B] px-14 py-4 mt-10 rounded-lg text-sm text-white uppercase md:text-base">
Submit</button></div></form></div></main><footer class="relative mt-40 md:mt-56 bg-[#192E5B]"><div class="relative w-full pt-36 md:pt-16 lg:pt-24 2xl:pt-20 font-extralight text-white"><div class="-mt-52 w-full mx-auto max-w-screen-xl px-4"><section class="bg-[#72A2C0] w-full p-6 md:py-20 md:px-16"><h2 class="my-4 text-2xl sm:text-3xl md:text-5xl text-white font-extrabold">LET'S ENVISION & BUILD THE FUTURE TOGETHER.</h2><div class=py-6><a href=/contact class="p-3 md:p-4 md:px-6 bg-[#2F4858] font-bold md:text-lg text-white text-center hover:bg-[#2F4858]/80">CONTACT US</a></div></section></div><div class="max-w-7xl mx-auto px-6"><div class="mt-12 flex flex-col md:flex-row lg:justify-between gap-x-8"><div class="my-4 max-w-xs"><h5 class="mb-3 font-extrabold">OUR PRESENCE</h5><p>We share because we care, about topics, tools, and technologies that we believe impact the AI economy.</p><div class=py-4><ul class="flex justify-between items-center gap-x-8"><li><a href=https://twitter.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-x-twitter"></i><p class=sr-only>Twitter</p></a></li><li><a href=https://www.linkedin.com/company/rotational target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-linkedin"></i><p class=sr-only>LinkedIn</p></a></li><li><a href=https://github.com/rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-github"></i><p class=sr-only>GitHub</p></a></li><li><a href=https://www.youtube.com/@rotationalio target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-youtube"></i><p class=sr-only>YouTube</p></a></li><li><a href=https://www.twitch.tv/rotationallabs target=_blank class=hover:text-[#1D65A6]><i class="text-2xl fa-brands fa-twitch"></i><p class=sr-only>Twitch</p></a></li></ul></div></div><div class=my-4><h5 class="mb-3 font-extrabold">COMPANY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/about>About Us</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/case-studies>Case Studies</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/endeavor>Endeavor</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/blog>Blog</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">COMMUNITY</h5><ul><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/learning>Learning</a></li><li class="pb-3 flex items-center gap-x-2"><i class="fa-solid fa-chevron-right text-[#757575] text-xs"></i>
<a href=/opensource>Open Source</a></li></ul></div><div class=my-4><h5 class="mb-3 font-extrabold">CONTACT US</h5><ul><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-map-marker-alt text-[#757575]"></i>
St. Paul, MN & Washington, DC</li><li class="flex items-baseline lg:items-center gap-x-2"><i class="fa-solid fa-envelope text-[#757575]"></i>
info@rotational.io</li></ul><div class=py-8><a href=/contact class="p-3 bg-[#ECF6FF] font-bold text-black text-center hover:bg-[#ECF6FF]/80">CONTACT US</a></div></div></div><div class="sm:flex justify-between py-6 border-t mt-4"><p>Copyright © Rotational Labs, Inc. 2021–2025 · All Rights Reserved</p><div><ul class="sm:mt-0 mt-4 flex gap-x-8"><li><a href=/privacy/>Privacy Policy</a></li><li><a href=/terms/>Terms of Use</a></li></ul></div></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js></script><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/24168101.js></script><script src=https://rotational.io/js/blogSingle.js></script><script src=https://rotational.io/js/newsletterForm.js></script></body></html>